(lp0
S'http://www.blogjava.net/sunzhong/articles/297435.html'
p1
aS'Linux \xe8\xbf\x9b\xe7\xa8\x8b\xe9\x97\xb4\xe9\x80\x9a\xe4\xbf\xa1 - \xe5\x85\xb1\xe4\xba\xab\xe5\x86\x85\xe5\xad\x98shmget\xe6\x96\xb9\xe5\xbc\x8f(\xe8\xbd\xac) - \xe6\x9c\x88\xe5\x85\x89\xe8\xae\xb0\xe5\xbf\x86 - BlogJava'
p2
aI0
aV<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">\u000a<html>\u000a<head id="Head"><title>\u000a	Linux \u8fdb\u7a0b\u95f4\u901a\u4fe1 - \u5171\u4eab\u5185\u5b58shmget\u65b9\u5f0f(\u8f6c) - \u6708\u5149\u8bb0\u5fc6 - BlogJava\u000a</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta id="metaKeywords" name="keywords" content="Linux \u8fdb\u7a0b\u95f4\u901a\u4fe1 - \u5171\u4eab\u5185\u5b58shmget\u65b9\u5f0f(\u8f6c)" /><link type="text/css" rel="stylesheet" href="/css/common.css" /><link id="MainCss" type="text/css" rel="stylesheet" href="http://www.blogjava.net/Skins/rivercast/style.css" /><link id="RSSLink" title="RSS" type="application/rss+xml" rel="alternate" href="http://www.blogjava.net/sunzhong/rss.aspx" /></head>\u000a<body>\u000a    <form name="Form1" method="post" action="297435.html" id="Form1">\u000a<div>\u000a<input type="hidden" name="__EVENTTARGET" id="__EVENTTARGET" value="" />\u000a<input type="hidden" name="__EVENTARGUMENT" id="__EVENTARGUMENT" value="" />\u000a<input type="hidden" name="__VIEWSTATE" id="\u000a__VIEWSTATE" value="" />\u000a</div>\u000a\u000a<script type="text/javascript">\u000a//<![CDATA[\u000avar theForm = document.forms['Form1'];\u000aif (!theForm) {\u000a    theForm = document.Form1;\u000a}\u000afunction __doPostBack(eventTarget, eventArgument) {\u000a    if (!theForm.onsubmit || (theForm.onsubmit() != false)) {\u000a        theForm.__EVENTTARGET.value = eventTarget;\u000a        theForm.__EVENTARGUMENT.value = eventArgument;\u000a        theForm.submit();\u000a    }\u000a}\u000a//]]>\u000a</script>\u000a\u000a\u000a<script src="/WebResource.axd?d=hCqqcDq62xC48aLO1-oizzph91mftTcpBQYAMmX9y1_MEKckib0uai68YudFFqahbIRj8ZaZB19FpMr30&amp;t=635295382417495136" type="text/javascript"></script>\u000a\u000a<script language=JavaScript>\u000a									function ctlent(evt,id)\u000a											{\u000a												if(evt.ctrlKey && evt.keyCode == 13)\u000a												{	\u000a													try\u000a													{\u000a														TempSave(id);\u000a													}\u000a													catch(ex)\u000a													{\u000a													}\u000a													finally\u000a													{\u000a													    __doPostBack('AjaxHolder$PostComment$btnSubmit','')\u000a													}\u000a												}\u000a		\u000a												}</script>\u000a												<script language=JavaScript>function SetReplyAuhor(author){document.getElementById('AjaxHolder_PostComment_tbComment').value+="@"+author+"\u005cn";document.getElementById('AjaxHolder_PostComment_tbComment').focus();return false}</script>\u000a<script src="/ScriptResource.axd?d=-BecoVNwDVCZ4TW3gB_ZzPWfgjCQ_C64O4hNc3pweA4UGq0B-lWFnUMMAtqURN0AZF_f7fxk9s5U1gsq0foUhwHdXezBbn_OgCN5EL300MOu7Jb-c7WU_a2OCK01&amp;t=634979389729873750" type="text/javascript"></script>\u000a<script src="/ScriptResource.axd?d=4npu1eCN6HUVuTPPO5YDuuBNC2hrBvTsGEVYQhhAo9CX_hfoT2Mz1UGnoo5C32pPXZvBizBLMnY0_szRgrGRkyv7-BsG0CvEejE8Vl3Xt8nd-D_58kXSDmaBFOFFj7w3EMKivQ2&amp;t=634979389729873750" type="text/javascript"></script>\u000a        \u000a<!--done-->\u000a<div id="centerbody" align="center">\u000a<div id="header">\u000a	\u000a<!--done-->\u000a<div class="header">\u000a	<div class="headerText">\u000a		<a id="Header1_HeaderTitle" class="headermaintitle" href="http://www.blogjava.net/sunzhong/">\u6708\u5149\u8bb0\u5fc6</a><br>\u000a		\u6e05\u6cc9\u54cd\u9732\u000a	</div>\u000a</div>\u000a\u000a</div>\u000a<div id="main">\u000a<div id="mytopmenu">\u000a	\u000a	<div id="mylinks">\u000a<!--done-->\u000a<a id="MyLinks1_HomeLink" class="menu" href="http://www.blogjava.net/">BlogJava</a>&nbsp;&nbsp;&nbsp;\u000a<a id="MyLinks1_MyHomeLink" class="menu" href="http://www.blogjava.net/sunzhong/">\u9996\u9875</a>&nbsp;&nbsp;&nbsp;\u000a<a id="MyLinks1_NewPostLink" class="menu" href="http://www.blogjava.net/sunzhong/admin/EditPosts.aspx?opt=1">\u65b0\u968f\u7b14</a>&nbsp;&nbsp;&nbsp;\u000a<a id="MyLinks1_ContactLink" accesskey="9" class="menu" href="http://www.blogjava.net/sunzhong/contact.aspx?id=1">\u8054\u7cfb</a>&nbsp;&nbsp;&nbsp;\u000a<a id="MyLinks1_Syndication" class="menu" href="http://www.blogjava.net/sunzhong/rss">\u805a\u5408</a><a id="MyLinks1_XMLLink" href="http://www.blogjava.net/sunzhong/rss"><img src="http://www.blogjava.net/images/xml.gif" style="border-width:0px;" /></a>&nbsp;&nbsp;&nbsp;\u000a<a id="MyLinks1_Admin" class="menu" href="http://www.blogjava.net/sunzhong/admin/EditPosts.aspx">\u7ba1\u7406</a>\u000a</div>\u000a		<DIV id="mystats">\u000a			\u000a<!--done-->\u000a<div class="blogStats">\u000aposts - 0,&nbsp;\u000acomments - 3,&nbsp;\u000atrackbacks - 0\u000a\u000a</div></DIV>\u000a	\u000a</div>\u000a<div id="centercontent">\u000a	\u000a					\u000a<!--done-->\u000a<div class = "post">\u000a	<div class = "postTitle">\u000a		<a id="viewpost1_TitleUrl" class="postTitle2" href="http://www.blogjava.net/sunzhong/articles/297435.html">Linux \u8fdb\u7a0b\u95f4\u901a\u4fe1 - \u5171\u4eab\u5185\u5b58shmget\u65b9\u5f0f(\u8f6c)</a>\u000a	</div>\u000a	<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5171\u4eab\u5185\u5b58\u533a\u57df\u662f\u88ab\u591a\u4e2a\u8fdb\u7a0b\u5171\u4eab\u7684\u4e00\u90e8\u5206\u7269\u7406\u5185\u5b58\u3002\u5982\u679c\u591a\u4e2a\u8fdb\u7a0b\u90fd\u628a\u8be5\u5185\u5b58\u533a\u57df\u6620\u5c04\u5230\u81ea\u5df1\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u5219\u8fd9\u4e9b\u8fdb\u7a0b\u5c31\u90fd\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u8be5\u5171\u4eab\u5185\u5b58\u533a\u57df\uff0c\u4ece\u800c\u53ef\u4ee5\u901a\u8fc7\u8be5\u533a\u57df\u8fdb\u884c\u901a\u4fe1\u3002\u5171\u4eab\u5185\u5b58\u662f\u8fdb\u7a0b\u95f4\u5171\u4eab\u6570\u636e\u7684\u4e00\u79cd\u6700\u5feb\u7684\u65b9\u6cd5\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u5411\u5171\u4eab\u5185\u5b58\u533a\u57df\u5199\u5165\u4e86\u6570\u636e\uff0c\u5171\u4eab\u8fd9\u4e2a\u5185\u5b58\u533a\u57df\u7684\u6240\u6709\u8fdb\u7a0b\u5c31\u53ef\u4ee5\u7acb\u523b\u770b\u5230\u5176\u4e2d\u7684\u5185\u5bb9\u3002\u8fd9\u5757\u5171\u4eab\u865a\u62df\u5185\u5b58\u7684\u9875\u9762\uff0c\u51fa\u73b0\u5728\u6bcf\u4e00\u4e2a\u5171\u4eab\u8be5\u9875\u9762\u7684\u8fdb\u7a0b\u7684\u9875\u8868\u4e2d\u3002\u4f46\u662f\u5b83\u4e0d\u9700\u8981\u5728\u6240\u6709\u8fdb\u7a0b\u7684\u865a\u62df\u5185\u5b58\u4e2d\u90fd\u6709\u76f8\u540c\u7684\u865a\u62df\u5730\u5740\u3002 <br />\u000a&nbsp; <br />\u000a&nbsp;<br />\u000a\u56fe \u5171\u4eab\u5185\u5b58\u6620\u5c04\u56fe&nbsp;&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <img height="176" alt="" src="/images/blogjava_net/sunzhong/200802171203246536364.gif" width="532" border="0" /><br />\u000a</p>\u000a<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8c61\u6240\u6709\u7684 System V IPC\u5bf9\u8c61\u4e00\u6837\uff0c\u5bf9\u4e8e\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u7684\u83b7\u53d6\u662f\u7531key\u63a7\u5236\u3002\u5185\u5b58\u5171\u4eab\u4e4b\u540e\uff0c\u5bf9\u8fdb\u7a0b\u5982\u4f55\u4f7f\u7528\u8fd9\u5757\u5185\u5b58\u5c31\u4e0d\u518d\u505a\u68c0\u67e5\u3002\u5b83\u4eec\u5fc5\u987b\u4f9d\u8d56\u4e8e\u5176\u5b83\u673a\u5236\uff0c\u6bd4\u5982System V\u7684\u4fe1\u53f7\u706f\u6765\u540c\u6b65\u5bf9\u4e8e\u5171\u4eab\u5185\u5b58\u533a\u57df\u7684\u8bbf\u95ee(\u4fe1\u53f7\u706f\u5982\u4f55\u63a7\u5236\u5bf9\u4e34\u754c\u4ee3\u7801\u7684\u8bbf\u95ee\u53e6\u8d77\u4e00\u7bc7\u8bf4\u8bdd)\u3002<br />\u000a&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u6bcf\u4e00\u4e2a\u65b0\u521b\u5efa\u7684\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u90fd\u7528\u4e00\u4e2ashmid_kernel\u6570\u636e\u7ed3\u6784\u6765\u8868\u8fbe\u3002\u7cfb\u7edf\u4e2d\u6240\u6709\u7684shmid_kernel\u6570\u636e\u7ed3\u6784\u90fd\u4fdd\u5b58\u5728shm_segs\u5411\u91cf\u8868\u4e2d\uff0c\u8be5\u5411\u91cf\u8868\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u90fd\u662f\u4e00\u4e2a\u6307\u5411shmid_kernel\u6570\u636e\u7ed3\u6784\u7684\u6307\u9488\u3002<br />\u000a<span style="color: #ff6600">shm_segs\u5411\u91cf\u8868\u7684\u5b9a\u4e49\u5982\u4e0b\uff1a<br />\u000astruct shmid_kernel *shm_segs[SHMMNI];</span><br />\u000a&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp; SHMMNI\u4e3a128\uff0c\u8868\u793a\u7cfb\u7edf\u4e2d\u6700\u591a\u53ef\u4ee5\u6709128\u4e2a\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u3002<br />\u000a&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp; <span style="color: #ff6600">\u6570\u636e\u7ed3\u6784shmid_kernel\u7684\u5b9a\u4e49\u5982\u4e0b\uff1a<br />\u000a</span><span style="color: #ff6600">&nbsp;&nbsp;&nbsp;&nbsp;struct shmid_kernel<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct shmid_ds u;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* the following are private */<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned long shm_npages;&nbsp; /* size of segment (pages) */<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned long *shm_pages;&nbsp; /* array of ptrs to frames -&gt; SHMMAX */&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct vm_area_struct *attaches;&nbsp; /* descriptors for attaches */<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;};</span><br />\u000a&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp; \u5176\u4e2d\uff1a<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;shm_pages\u4ee3\u8868\u8be5\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u7684\u6240\u5360\u636e\u7684\u5185\u5b58\u9875\u9762\u6570\u7ec4\uff0c\u6570\u7ec4\u91cc\u9762\u7684\u6bcf\u4e2a\u5143\u7d20\u5f53\u7136\u662f\u6bcf\u4e2a\u5185\u5b58\u9875\u9762\u7684\u8d77\u59cb\u5730\u5740.<br />\u000a&nbsp;&nbsp;&nbsp; shm_npages\u5219\u662f\u8be5\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u5360\u7528\u5185\u5b58\u9875\u9762\u7684\u4e2a\u6570\uff0c\u4ee5\u9875\u4e3a\u5355\u4f4d\u3002\u8fd9\u4e2a\u6570\u91cf\u5f53\u7136\u6db5\u76d6\u4e86\u7533\u8bf7\u7a7a\u95f4\u7684\u6700\u5c0f\u6574\u6570\u500d.<br />\u000a&nbsp;&nbsp;&nbsp;<span style="color: #00ff00">&nbsp;(A new shared memory segment,&nbsp; with size&nbsp; equal to the value of size rounded up to a multiple of PAGE_SIZE)</span><br />\u000a&nbsp;&nbsp;&nbsp; shmid_ds\u662f\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u5b83\u63cf\u8ff0\u4e86\u8fd9\u4e2a\u5171\u4eab\u5185\u5b58\u533a\u7684\u8ba4\u8bc1\u4fe1\u606f\uff0c\u5b57\u8282\u5927\u5c0f\uff0c\u6700\u540e\u4e00\u6b21\u7c98\u9644\u65f6\u95f4\u3001\u5206\u79bb\u65f6\u95f4\u3001\u6539\u53d8\u65f6\u95f4\uff0c\u521b\u5efa\u8be5\u5171\u4eab\u533a\u57df\u7684\u8fdb\u7a0b\uff0c\u6700\u540e\u4e00\u6b21\u5bf9\u5b83\u64cd\u4f5c\u7684\u8fdb\u7a0b\uff0c\u5f53\u524d\u6709\u591a\u5c11\u4e2a\u8fdb\u7a0b\u5728\u4f7f\u7528\u5b83\u7b49\u4fe1\u606f\u3002<br />\u000a<span style="color: #ff6600">&nbsp;&nbsp;&nbsp;&nbsp;\u5176\u5b9a\u4e49\u5982\u4e0b\uff1a<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;struct shmid_ds {<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct ipc_perm shm_perm;&nbsp;&nbsp; /* operation perms */<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int shm_segsz;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* size of segment (bytes) */<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__kernel_time_t shm_atime;&nbsp; /* last attach time */<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__kernel_time_t shm_dtime;&nbsp; /* last detach time */<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__kernel_time_t shm_ctime;&nbsp; /* last change time */<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__kernel_ipc_pid_t shm_cpid; /* pid of creator */<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__kernel_ipc_pid_t shm_lpid; /* pid of last operator */<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned short shm_nattch;&nbsp;&nbsp; /* no. of current attaches */<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned short shm_unused;&nbsp;&nbsp; /* compatibility */<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void *shm_unused2;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* ditto - used by DIPC */<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void *shm_unused3;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* unused */<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;};</span><br />\u000a&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; attaches\u63cf\u8ff0\u88ab\u5171\u4eab\u7684\u7269\u7406\u5185\u5b58\u5bf9\u8c61\u6240\u6620\u5c04\u7684\u5404\u8fdb\u7a0b\u7684\u865a\u62df\u5185\u5b58\u533a\u57df\u3002\u6bcf\u4e00\u4e2a\u5e0c\u671b\u5171\u4eab\u8fd9\u5757\u5185\u5b58\u7684\u8fdb\u7a0b\u90fd\u5fc5\u987b\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u5c06\u5176\u5173\u8054\uff08attach\uff09\u5230\u5b83\u7684\u865a\u62df\u5185\u5b58\u4e2d\u3002\u8fd9\u4e00\u8fc7\u7a0b\u5c06\u4e3a\u8be5\u8fdb\u7a0b\u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7684\u63cf\u8ff0\u8fd9\u5757\u5171\u4eab\u5185\u5b58\u7684vm_area_struct\u6570\u636e\u7ed3\u6784\u3002\u521b\u5efa\u65f6\u53ef\u4ee5\u6307\u5b9a\u5171\u4eab\u5185\u5b58\u5728\u5b83\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u7684\u4f4d\u7f6e\uff0c\u4e5f\u53ef\u4ee5\u8ba9Linux\u81ea\u5df1\u4e3a\u5b83\u9009\u62e9\u4e00\u5757\u8db3\u591f\u7684\u7a7a\u95f2\u533a\u57df\u3002<br />\u000a&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8fd9\u4e2a\u65b0\u7684vm_area_struct\u7ed3\u6784\u662f\u7ef4\u7cfb\u5171\u4eab\u5185\u5b58\u548c\u4f7f\u7528\u5b83\u7684\u8fdb\u7a0b\u4e4b\u95f4\u7684\u5173\u7cfb\u7684,\u6240\u4ee5\u9664\u4e86\u8981\u5173\u8054\u8fdb\u7a0b\u4fe1\u606f\u5916\uff0c\u8fd8\u8981\u6307\u660e\u8fd9\u4e2a\u5171\u4eab\u5185\u5b58\u6570\u636e\u7ed3\u6784shmid_kernel\u6240\u5728\u4f4d\u7f6e; \u53e6\u5916,\u4fbf\u4e8e\u7ba1\u7406\u8fd9\u4e9b\u7ecf\u5e38\u53d8\u5316\u7684vm_area_struct,\u6240\u4ee5\u91c7\u53d6\u4e86\u94fe\u8868\u5f62\u5f0f\u7ec4\u7ec7\u8fd9\u4e9b\u6570\u636e\u7ed3\u6784,\u94fe\u8868\u7531attaches\u6307\u5411,\u540c\u65f6 vm_area_struct\u6570\u636e\u7ed3\u6784\u4e2d\u4e13\u95e8\u63d0\u4f9b\u4e86\u4e24\u4e2a\u6307\u9488\uff1avm_next_shared\u548c vm_prev_shared\uff0c\u7528\u4e8e\u8fde\u63a5\u8be5\u5171\u4eab\u533a\u57df\u5728\u4f7f\u7528\u5b83\u7684\u5404\u8fdb\u7a0b\u4e2d\u6240\u5bf9\u5e94\u7684vm_area_struct\u6570\u636e\u7ed3\u6784\u3002&nbsp;<br />\u000a<br />\u000a\u56fe System V IPC \u673a\u5236 - \u5171\u4eab\u5185\u5b58&nbsp;<br />\u000a<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; <img style="width: 489px; height: 305px" height="305" alt="" src="/images/blogjava_net/sunzhong/200802171203246581068.gif" width="489" border="0" /></p>\u000a<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Linux\u4e3a\u5171\u4eab\u5185\u5b58\u63d0\u4f9b\u4e86\u56db\u79cd\u64cd\u4f5c\u3002<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. \u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u7684\u521b\u5efa\u6216\u83b7\u5f97\u3002\u4e0e\u5176\u5b83\u4e24\u79cdIPC\u673a\u5236\u4e00\u6837\uff0c\u8fdb\u7a0b\u5728\u4f7f\u7528\u5171\u4eab\u5185\u5b58\u533a\u57df\u4ee5\u524d\uff0c\u5fc5\u987b\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528sys_ipc \uff08call\u503c\u4e3aSHMGET\uff09\u521b\u5efa\u4e00\u4e2a\u952e\u503c\u4e3akey\u7684\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\uff0c\u6216\u83b7\u5f97\u5df2\u7ecf\u5b58\u5728\u7684\u952e\u503c\u4e3akey\u7684\u67d0\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u7684\u5f15\u7528\u6807\u8bc6\u7b26\u3002\u4ee5\u540e\u5bf9\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u7684\u8bbf\u95ee\u90fd\u901a\u8fc7\u8be5\u5f15\u7528\u6807\u8bc6\u7b26\u8fdb\u884c\u3002\u5bf9\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u7684\u521b\u5efa\u6216\u83b7\u5f97\u7531\u51fd\u6570sys_shmget\u5b8c\u6210\uff0c\u5176\u5b9a\u4e49\u5982\u4e0b\uff1a<br />\u000aint sys_shmget (key_t key, int size, int shmflg)<br />\u000a&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp; \u8fd9\u91cckey\u662f\u8868\u793a\u8be5\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u7684\u952e\u503c\uff0csize\u662f\u8be5\u5171\u4eab\u5185\u5b58\u533a\u57df\u7684\u5927\u5c0f\uff08\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\uff09\uff0cshmflg\u662f\u6807\u5fd7\uff08\u5bf9\u8be5\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u7684\u7279\u6b8a\u8981\u6c42\uff09\u3002<br />\u000a&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp; \u5b83\u6240\u505a\u7684\u5de5\u4f5c\u5982\u4e0b\uff1a<br />\u000a&nbsp;&nbsp;&nbsp; 1) \u5982\u679ckey == IPC_PRIVATE\uff0c\u5219\u603b\u662f\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u3002<br />\u000a&nbsp;<span style="color: #00ff00">\u4f46\u662f&nbsp; (The name choice IPC_PRIVATE was perhaps unfortunate, IPC_NEW would more&nbsp;clearly show its function)<br />\u000a</span>&nbsp;&nbsp;&nbsp; * \u7b97\u51fasize\u8981\u5360\u7528\u7684\u9875\u6570\uff0c\u68c0\u67e5\u5176\u5408\u6cd5\u6027\u3002<br />\u000a&nbsp;&nbsp;&nbsp; * \u7533\u8bf7\u4e00\u5757\u5185\u5b58\u7528\u4e8e\u5efa\u7acbshmid_kernel\u6570\u636e\u7ed3\u6784\uff0c\u6ce8\u610f\u8fd9\u91cc\u7533\u8bf7\u7684\u5185\u5b58\u533a\u57df\u5927\u5c0f\u4e0d\u5305\u62ec\u771f\u6b63\u7684\u5171\u4eab\u5185\u5b58\u533a\uff0c\u5b9e\u9645\u4e0a\uff0c\u8981\u7b49\u5230\u7b2c\u4e00\u4e2a\u8fdb\u7a0b\u8bd5\u56fe\u8bbf\u95ee\u5b83\u7684\u65f6\u5019\u624d\u771f\u6b63\u521b\u5efa\u5171\u4eab\u5185\u5b58\u533a\u3002<br />\u000a&nbsp;&nbsp;&nbsp; * \u6839\u636e\u8be5\u5171\u4eab\u5185\u5b58\u533a\u6240\u5360\u7528\u7684\u9875\u6570\uff0c\u4e3a\u5176\u7533\u8bf7\u4e00\u5757\u7a7a\u95f4\u7528\u4e8e\u5efa\u7acb\u9875\u8868\uff08\u6bcf\u98754\u4e2a\u5b57\u8282\uff09\uff0c\u5c06\u9875\u8868\u6e050\u3002<br />\u000a&nbsp;&nbsp;&nbsp; * \u641c\u7d22\u5411\u91cf\u8868shm_segs\uff0c\u4e3a\u65b0\u521b\u5efa\u7684\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u627e\u4e00\u4e2a\u7a7a\u4f4d\u7f6e\u3002<br />\u000a&nbsp;&nbsp;&nbsp; * \u586b\u5199shmid_kernel\u6570\u636e\u7ed3\u6784\uff0c\u5c06\u5176\u52a0\u5165\u5230\u5411\u91cf\u8868shm_segs\u4e2d\u4e3a\u5176\u627e\u5230\u7684\u7a7a\u4f4d\u7f6e\u3002<br />\u000a&nbsp;&nbsp;&nbsp; * \u8fd4\u56de\u8be5\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u7684\u5f15\u7528\u6807\u8bc6\u7b26\u3002<br />\u000a&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp; 2) \u5728\u5411\u91cf\u8868shm_segs\u4e2d\u67e5\u627e\u952e\u503c\u4e3akey\u7684\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\uff0c\u7ed3\u679c\u6709\u4e09\uff1a<br />\u000a&nbsp;&nbsp;&nbsp; * \u5982\u679c\u6ca1\u6709\u627e\u5230\uff0c\u800c\u4e14\u5728\u64cd\u4f5c\u6807\u5fd7shmflg\u4e2d\u6ca1\u6709\u6307\u660e\u8981\u521b\u5efa\u65b0\u5171\u4eab\u5185\u5b58\uff0c\u5219\u9519\u8bef\u8fd4\u56de\uff0c\u5426\u5219\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u3002<br />\u000a&nbsp;&nbsp;&nbsp; * \u5982\u679c\u627e\u5230\u4e86\uff0c\u4f46\u8be5\u6b21\u64cd\u4f5c\u8981\u6c42\u5fc5\u987b\u521b\u5efa\u4e00\u4e2a\u952e\u503c\u4e3akey\u7684\u65b0\u5bf9\u8c61\uff0c\u90a3\u4e48\u9519\u8bef\u8fd4\u56de\u3002<br />\u000a&nbsp;&nbsp;&nbsp; * \u5426\u5219\uff0c\u5408\u6cd5\u6027\u3001\u8ba4\u8bc1\u68c0\u67e5\uff0c\u5982\u6709\u9519\uff0c\u5219\u9519\u8bef\u8fd4\u56de\uff1b\u5426\u5219\uff0c\u8fd4\u56de\u8be5\u5185\u5b58\u5bf9\u8c61\u7684\u5f15\u7528\u6807\u8bc6\u7b26\u3002<br />\u000a&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp; \u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u7684\u521b\u5efa\u8005\u53ef\u4ee5\u63a7\u5236\u5bf9\u4e8e\u8fd9\u5757\u5185\u5b58\u7684\u8bbf\u95ee\u6743\u9650\u548c\u5b83\u7684key\u662f\u516c\u5f00\u8fd8\u662f\u79c1\u6709\u3002\u5982\u679c\u6709\u8db3\u591f\u7684\u6743\u9650\uff0c\u5b83\u4e5f\u53ef\u4ee5\u628a\u5171\u4eab\u5185\u5b58\u9501\u5b9a\u5728\u7269\u7406\u5185\u5b58\u4e2d\u3002<br />\u000a&nbsp;&nbsp;&nbsp; \u53c2\u89c1include/linux/shm.h<br />\u000a&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp; 2. \u5173\u8054\u3002\u5728\u521b\u5efa\u6216\u83b7\u5f97\u67d0\u4e2a\u5171\u4eab\u5185\u5b58\u533a\u57df\u7684\u5f15\u7528\u6807\u8bc6\u7b26\u540e\uff0c\u8fd8\u5fc5\u987b\u5c06\u5171\u4eab\u5185\u5b58\u533a\u57df\u6620\u5c04\uff08\u7c98\u9644\uff09\u5230\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u7136\u540e\u624d\u80fd\u4f7f\u7528\u8be5\u5171\u4eab\u5185\u5b58\u533a\u57df\u3002\u7cfb\u7edf\u8c03\u7528 sys_ipc\uff08call\u503c\u4e3aSHMAT\uff09\u7528\u4e8e\u5171\u4eab\u5185\u5b58\u533a\u5230\u8fdb\u7a0b\u865a\u62df\u5730\u5740\u7a7a\u95f4\u7684\u6620\u5c04\uff0c\u800c\u771f\u6b63\u5b8c\u6210\u7c98\u9644\u52a8\u4f5c\u7684\u662f\u51fd\u6570sys_shmat\uff0c<br />\u000a&nbsp;<br />\u000a<span style="color: #ff6600">\u5176\u5b9a\u4e49\u5982\u4e0b\uff1a&nbsp;&nbsp;&nbsp; </span></p>\u000a<p><span style="color: #ff6600">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#include &lt;sys/types.h&gt;<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #include &lt;sys/shm.h&gt;</span></p>\u000a<p><span style="color: #ff6600">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; void *shmat(int shmid, const void *shmaddr, int shmflg);</span><br />\u000a</p>\u000a<p><br />\u000a&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp; \u5176\u4e2d\uff1a<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp; shmid\u662fshmget\u8fd4\u56de\u7684\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u7684\u5f15\u7528\u6807\u8bc6\u7b26\uff1b<br />\u000a&nbsp;&nbsp;&nbsp; shmaddr\u7528\u6765\u6307\u5b9a\u8be5\u5171\u4eab\u5185\u5b58\u533a\u57df\u5728\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u5bf9\u5e94\u7684\u865a\u62df\u5730\u5740\uff1b<br />\u000a&nbsp;&nbsp;&nbsp; shmflg\u662f\u6620\u5c04\u6807\u5fd7\uff1b<br />\u000a&nbsp;&nbsp;&nbsp;&nbsp;\u8fd4\u56de\u7684\u662f \u5728\u8fdb\u7a0b\u4e2d\u7684\u865a\u62df\u5730\u5740<br />\u000a&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp; \u8be5\u51fd\u6570\u6240\u505a\u7684\u5de5\u4f5c\u5982\u4e0b\uff1a<br />\u000a&nbsp;&nbsp;&nbsp; 1) \u6839\u636eshmid\u627e\u5230\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u3002<br />\u000a&nbsp;&nbsp;&nbsp; 2) \u5982\u679cshmaddr\u4e3a0\uff0c\u5373\u7528\u6237\u6ca1\u6709\u6307\u5b9a\u8be5\u5171\u4eab\u5185\u5b58\u533a\u57df\u5728\u5b83\u7684\u865a\u62df\u7a7a\u95f4\u4e2d\u7684\u4f4d\u7f6e\uff0c\u5219\u7531\u7cfb\u7edf\u5728\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u4e3a\u5176\u627e\u4e00\u5757\u533a\u57df\uff08\u4ece1G\u5f00\u59cb\uff09\uff1b\u5426\u5219\uff0c\u5c31\u7528shmaddr\u4f5c\u4e3a\u6620\u5c04\u7684\u865a\u62df\u5730\u5740\u3002<br />\u000a&nbsp;&nbsp; <span style="color: #00ff00">(If&nbsp; shmaddr&nbsp; is NULL, the system chooses a suitable (unused) address a\u4ed6 which to attach the segment)</span><br />\u000a&nbsp;&nbsp;&nbsp; 3) \u68c0\u67e5\u865a\u62df\u5730\u5740\u7684\u5408\u6cd5\u6027\uff08\u4e0d\u80fd\u8d85\u8fc7\u8fdb\u7a0b\u7684\u6700\u5927\u865a\u62df\u7a7a\u95f4\u5927\u5c0f\u20143G\uff0c\u4e0d\u80fd\u592a\u63a5\u8fd1\u5806\u6808\u6808\u9876\uff09\u3002<br />\u000a&nbsp;&nbsp;&nbsp; 4) \u8ba4\u8bc1\u68c0\u67e5\u3002<br />\u000a&nbsp;&nbsp;&nbsp; 5) \u7533\u8bf7\u4e00\u5757\u5185\u5b58\u7528\u4e8e\u5efa\u7acb\u6570\u636e\u7ed3\u6784vm_area_struct\uff0c\u586b\u5199\u8be5\u7ed3\u6784\u3002<br />\u000a&nbsp;&nbsp;&nbsp; 6) \u68c0\u67e5\u8be5\u5185\u5b58\u533a\u57df\uff0c\u5c06\u5176\u52a0\u5165\u5230\u8fdb\u7a0b\u7684mm\u7ed3\u6784\u548c\u8be5\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u7684vm_area_struct\u961f\u5217\u4e2d\u3002<br />\u000a&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp; \u5171\u4eab\u5185\u5b58\u7684\u7c98\u9644\u53ea\u662f\u521b\u5efa\u4e00\u4e2avm_area_struct\u6570\u636e\u7ed3\u6784\uff0c\u5e76\u5c06\u5176\u52a0\u5165\u5230\u76f8\u5e94\u7684\u961f\u5217\u4e2d\uff0c\u6b64\u65f6\u5e76\u6ca1\u6709\u521b\u5efa\u771f\u6b63\u7684\u5171\u4eab\u5185\u5b58\u9875\u3002<br />\u000a&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp; \u5f53\u8fdb\u7a0b\u7b2c\u4e00\u6b21\u8bbf\u95ee\u5171\u4eab\u865a\u62df\u5185\u5b58\u7684\u67d0\u9875\u65f6\uff0c\u56e0\u4e3a\u6240\u6709\u7684\u5171\u4eab\u5185\u5b58\u9875\u8fd8\u90fd\u6ca1\u6709\u5206\u914d\uff0c\u6240\u4ee5\u4f1a\u53d1\u751f\u4e00\u4e2apage fault\u5f02\u5e38\u3002\u5f53Linux\u5904\u7406\u8fd9\u4e2apage fault\u7684\u65f6\u5019\uff0c\u5b83\u627e\u5230\u53d1\u751f\u5f02\u5e38\u7684\u865a\u62df\u5730\u5740\u6240\u5728\u7684vm_area_struct\u6570\u636e\u7ed3\u6784\u3002\u5728\u8be5\u6570\u636e\u7ed3\u6784\u4e2d\u5305\u542b\u6709\u8fd9\u7c7b\u5171\u4eab\u865a\u62df\u5185\u5b58\u7684\u4e00\u7ec4\u5904\u7406\u7a0b\u5e8f\uff0c\u5176\u4e2d\u7684 nopage\u64cd\u4f5c\u7528\u6765\u5904\u7406\u865a\u62df\u9875\u5bf9\u5e94\u7684\u7269\u7406\u9875\u4e0d\u5b58\u5728\u7684\u60c5\u51b5\u3002\u5bf9\u5171\u4eab\u5185\u5b58\uff0c\u8be5\u64cd\u4f5c\u662fshm_nopage\uff08\u5b9a\u4e49\u5728ipc/shm.c\u4e2d\uff09\u3002\u8be5\u64cd\u4f5c\u5728\u63cf\u8ff0\u8fd9\u4e2a\u5171\u4eab\u5185\u5b58\u7684shmid_kernel\u6570\u636e\u7ed3\u6784\u7684\u9875\u8868shm_pages\u4e2d\u67e5\u627e\u53d1\u751fpage fault\u5f02\u5e38\u7684\u865a\u62df\u5730\u5740\u6240\u5bf9\u5e94\u7684\u9875\u8868\u6761\u76ee\uff0c\u770b\u5171\u4eab\u9875\u662f\u5426\u5b58\u5728\uff08\u9875\u8868\u6761\u76ee\u4e3a0\uff0c\u8868\u793a\u5171\u4eab\u9875\u662f\u7b2c\u4e00\u6b21\u4f7f\u7528\uff09\u3002\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5b83\u5c31\u5206\u914d\u4e00\u4e2a\u7269\u7406\u9875\uff0c\u5e76\u4e3a\u5b83\u521b\u5efa\u4e00\u4e2a\u9875\u8868\u6761\u76ee\u3002\u8fd9\u4e2a\u6761\u76ee\u4e0d\u4f46\u8fdb\u5165\u5f53\u524d\u8fdb\u7a0b\u7684\u9875\u8868\uff0c\u540c\u65f6\u4e5f\u5b58\u5230shmid_kernel\u6570\u636e\u7ed3\u6784\u7684\u9875\u8868shm_pages\u4e2d\u3002<br />\u000a&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp; \u5f53\u4e0b\u4e00\u4e2a\u8fdb\u7a0b\u8bd5\u56fe\u8bbf\u95ee\u8fd9\u5757\u5185\u5b58\u5e76\u5f97\u5230\u4e00\u4e2apage fault\u7684\u65f6\u5019\uff0c\u7ecf\u8fc7\u540c\u6837\u7684\u8def\u5f84\uff0c\u4e5f\u4f1a\u8d70\u5230\u51fd\u6570shm_nopage\u3002\u6b64\u65f6\uff0c\u8be5\u51fd\u6570\u67e5\u770bshmid_kernel\u6570\u636e\u7ed3\u6784\u7684\u9875\u8868shm_pages\u65f6\uff0c\u53d1\u73b0\u5171\u4eab\u9875\u5df2\u7ecf\u5b58\u5728\uff0c\u5b83\u53ea\u9700\u628a\u8fd9\u91cc\u7684\u9875\u8868\u9879\u586b\u5230\u8fdb\u7a0b\u9875\u8868\u7684\u76f8\u5e94\u4f4d\u7f6e\u5373\u53ef\uff0c\u800c\u4e0d\u9700\u8981\u91cd\u65b0\u521b\u5efa\u7269\u7406\u9875\u3002\u6240\u4ee5\uff0c\u662f\u7b2c\u4e00\u4e2a\u8bbf\u95ee\u5171\u4eab\u5185\u5b58\u9875\u7684\u8fdb\u7a0b\u4f7f\u5f97\u8fd9\u4e00\u9875\u88ab\u521b\u5efa\uff0c\u800c\u968f\u540e\u8bbf\u95ee\u5b83\u7684\u5176\u5b83\u8fdb\u7a0b\u4ec5\u628a\u6b64\u9875\u52a0\u5230\u5b83\u4eec\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u3002<br />\u000a&nbsp; <br />\u000a&nbsp;&nbsp;&nbsp; 3. \u5206\u79bb\u3002\u5f53\u8fdb\u7a0b\u4e0d\u518d\u9700\u8981\u5171\u4eab\u865a\u62df\u5185\u5b58\u7684\u65f6\u5019\uff0c\u5b83\u4eec\u4e0e\u4e4b\u5206\u79bb\uff08detach\uff09\u3002\u53ea\u8981\u4ecd\u65e7\u6709\u5176\u5b83\u8fdb\u7a0b\u5728\u4f7f\u7528\u8fd9\u5757\u5185\u5b58\uff0c\u8fd9\u79cd\u5206\u79bb\u5c31\u53ea\u4f1a\u5f71\u54cd\u5f53\u524d\u7684\u8fdb\u7a0b\uff0c\u800c\u4e0d\u4f1a\u5f71\u54cd\u5176\u5b83\u8fdb\u7a0b\u3002\u5f53\u524d\u8fdb\u7a0b\u7684vm_area_struct\u6570\u636e\u7ed3\u6784\u88ab\u4eceshmid_ds\u4e2d\u5220\u9664\uff0c\u5e76\u88ab\u91ca\u653e\u3002\u5f53\u524d\u8fdb\u7a0b\u7684\u9875\u8868\u4e5f\u88ab\u66f4\u65b0\uff0c\u5171\u4eab\u5185\u5b58\u5bf9\u5e94\u7684\u865a\u62df\u5185\u5b58\u9875\u88ab\u6807\u8bb0\u4e3a\u65e0\u6548\u3002\u5f53\u5171\u4eab\u8fd9\u5757\u5185\u5b58\u7684\u6700\u540e\u4e00\u4e2a\u8fdb\u7a0b\u4e0e\u4e4b\u5206\u79bb\u65f6\uff0c\u5171\u4eab\u5185\u5b58\u9875\u88ab\u91ca\u653e\uff0c\u540c\u65f6\uff0c\u8fd9\u5757\u5171\u4eab\u5185\u5b58\u7684shmid_kernel\u6570\u636e\u7ed3\u6784\u4e5f\u88ab\u91ca\u653e\u3002<br />\u000a&nbsp;<br />\u000a&nbsp; \u7cfb\u7edf\u8c03\u7528sys_ipc (call\u503c\u4e3aSHMDT) \u7528\u4e8e\u5171\u4eab\u5185\u5b58\u533a\u4e0e\u8fdb\u7a0b\u865a\u62df\u5730\u5740\u7a7a\u95f4\u7684\u5206\u79bb\uff0c\u800c\u771f\u6b63\u5b8c\u6210\u5206\u79bb\u52a8\u4f5c\u7684\u662f\u51fd\u6570<span style="color: #ff6600">&nbsp;&nbsp;&nbsp;&nbsp;<br />\u000a<br />\u000a&nbsp;&nbsp;&nbsp; sys_shmdt\uff0c\u5176\u5b9a\u4e49\u5982\u4e0b\uff1a<br />\u000a&nbsp;&nbsp;&nbsp; int sys_shmdt (char *shmaddr)<br />\u000a</span>&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp; \u5176\u4e2dshmaddr\u662f\u8fdb\u7a0b\u8981\u5206\u79bb\u7684\u5171\u4eab\u9875\u7684\u5f00\u59cb\u865a\u62df\u5730\u5740\u3002<br />\u000a&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp; \u8be5\u51fd\u6570\u641c\u7d22\u8fdb\u7a0b\u7684\u5185\u5b58\u7ed3\u6784\u4e2d\u7684\u6240\u6709vm_area_struct\u6570\u636e\u7ed3\u6784\uff0c\u627e\u5230\u5730\u5740shmaddr\u5bf9\u5e94\u7684\u4e00\u4e2a\uff0c\u8c03\u7528\u51fd\u6570do_munmap\u5c06\u5176\u91ca\u653e\u3002<br />\u000a&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp; \u5728\u51fd\u6570do_munmap\u4e2d\uff0c\u5c06\u8981\u91ca\u653e\u7684vm_area_struct\u6570\u636e\u7ed3\u6784\u4ece\u8fdb\u7a0b\u7684\u865a\u62df\u5185\u5b58\u4e2d\u6458\u4e0b\uff0c\u6e05\u9664\u5b83\u5728\u8fdb\u7a0b\u9875\u8868\u4e2d\u5bf9\u5e94\u7684\u9875\u8868\u9879\uff08\u53ef\u80fd\u5360\u591a\u4e2a\u9875\u8868\u9879\uff09.&nbsp;<br />\u000a&nbsp;&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp; \u5982\u679c\u5171\u4eab\u7684\u865a\u62df\u5185\u5b58\u6ca1\u6709\u88ab\u9501\u5b9a\u5728\u7269\u7406\u5185\u5b58\u4e2d\uff0c\u5206\u79bb\u4f1a\u66f4\u52a0\u590d\u6742\u3002\u56e0\u4e3a\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5171\u4eab\u5185\u5b58\u7684\u9875\u53ef\u80fd\u5728\u7cfb\u7edf\u5927\u91cf\u4f7f\u7528\u5185\u5b58\u7684\u65f6\u5019\u88ab\u4ea4\u6362\u5230\u7cfb\u7edf\u7684\u4ea4\u6362\u78c1\u76d8\u3002\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u63a7\u5236\u64cd\u4f5c\uff0c\u5c06\u67d0\u5171\u4eab\u5185\u5b58\u9875\u9501\u5b9a\u5728\u7269\u7406\u5185\u5b58\u4e0d\u5141\u8bb8\u5411\u5916\u4ea4\u6362\u3002\u5171\u4eab\u5185\u5b58\u7684\u6362\u51fa\u548c\u6362\u5165\uff0c\u5df2\u5728\u7b2c3\u7ae0\u4e2d\u8ba8\u8bba\u3002<br />\u000a&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp; 4. \u63a7\u5236\u3002Linux\u5728\u5171\u4eab\u5185\u5b58\u4e0a\u5b9e\u73b0\u7684\u7b2c\u56db\u79cd\u64cd\u4f5c\u662f\u5171\u4eab\u5185\u5b58\u7684\u63a7\u5236\uff08call\u503c\u4e3aSHMCTL\u7684sys_ipc\u8c03\u7528\uff09\uff0c\u5b83\u7531\u51fd\u6570sys_shmctl\u5b9e\u73b0\u3002\u63a7\u5236\u64cd\u4f5c\u5305\u62ec\u83b7\u5f97\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u7684\u72b6\u6001\uff0c\u8bbe\u7f6e\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u7684\u53c2\u6570\uff08\u5982uid\u3001gid\u3001mode\u3001ctime\u7b49\uff09\uff0c\u5c06\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u5728\u5185\u5b58\u4e2d\u9501\u5b9a\u548c\u91ca\u653e\uff08\u5728\u5bf9\u8c61\u7684mode\u4e0a\u589e\u52a0\u6216\u53bb\u9664SHM_LOCKED\u6807\u5fd7\uff09\uff0c\u91ca\u653e\u5171\u4eab\u5185\u5b58\u5bf9\u8c61\u8d44\u6e90\u7b49\u3002<br />\u000a&nbsp;<br />\u000a&nbsp;&nbsp;&nbsp; \u5171\u4eab\u5185\u5b58\u63d0\u4f9b\u4e86\u4e00\u79cd\u5feb\u901f\u7075\u6d3b\u7684\u673a\u5236\uff0c\u5b83\u5141\u8bb8\u8fdb\u7a0b\u4e4b\u95f4\u76f4\u63a5\u5171\u4eab\u5927\u91cf\u7684\u6570\u636e\uff0c\u800c\u65e0\u987b\u4f7f\u7528\u62f7\u8d1d\u6216\u7cfb\u7edf\u8c03\u7528\u3002\u5171\u4eab\u5185\u5b58\u7684\u4e3b\u8981\u5c40\u9650\u6027\u662f\u5b83\u4e0d\u80fd\u63d0\u4f9b\u540c\u6b65\uff0c\u5982\u679c\u4e24\u4e2a\u8fdb\u7a0b\u4f01\u56fe\u4fee\u6539\u76f8\u540c\u7684\u5171\u4eab\u5185\u5b58\u533a\u57df\uff0c\u7531\u4e8e\u5185\u6838\u4e0d\u80fd\u4e32\u884c\u5316\u8fd9\u4e9b\u52a8\u4f5c\uff0c\u56e0\u6b64\u5199\u7684\u6570\u636e\u53ef\u80fd\u4efb\u610f\u5730\u4e92\u76f8\u6df7\u5408\u3002\u6240\u4ee5\u4f7f\u7528\u5171\u4eab\u5185\u5b58\u7684\u8fdb\u7a0b\u5fc5\u987b\u8bbe\u8ba1\u5b83\u4eec\u81ea\u5df1\u7684\u540c\u6b65\u534f\u8bae\uff0c\u5982\u7528\u4fe1\u53f7\u706f\u7b49\u3002 </p>\u000a<p><span style="color: #ff6600">\u4ee5\u4e0b\u662f\u4f7f\u7528\u5171\u4eab\u5185\u5b58\u673a\u5236\u8fdb\u884c\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u57fa\u672c\u64cd\u4f5c\uff1a</span></p>\u000a<p><span style="color: #ff6600">\u9700\u8981\u5305\u542b\u7684\u5934\u6587\u4ef6\uff1a</span></p>\u000a<p><span style="color: #ff6600">#include &lt;sys/types.h&gt;</span></p>\u000a<p><span style="color: #ff6600">#include &lt;sys/ipc.h&gt;</span></p>\u000a<p><span style="color: #ff6600">#include &lt;sys/shm.h&gt;</span></p>\u000a<p><span style="color: #ff6600">1.\u521b\u5efa\u5171\u4eab\u5185\u5b58\uff1a</span></p>\u000a<p><span style="color: #ff6600">&nbsp;int shmget(key_t key,int size,int shmflg);</span></p>\u000a<p><span style="color: #ff6600">\u53c2\u6570\u8bf4\u660e\uff1a</span></p>\u000a<p><span style="color: #ff6600">key:\u7528\u6765\u8868\u793a\u65b0\u5efa\u6216\u8005\u5df2\u7ecf\u5b58\u5728\u7684\u5171\u4eab\u5185\u5b58\u53bb\u7684\u5173\u952e\u5b57\u3002</span></p>\u000a<p><span style="color: #ff6600">size\uff1a\u521b\u5efa\u5171\u4eab\u5185\u5b58\u7684\u5927\u5c0f\u3002</span></p>\u000a<p><span style="color: #ff6600">shmflg\uff1a\u53ef\u4ee5\u6307\u5b9a\u7684\u7279\u6b8a\u6807\u5fd7\u3002IPC_CREATE,IPC_EXCL\u4ee5\u53ca\u4f4e\u4e5d\u4f4d\u7684\u6743\u9650\u3002</span></p>\u000a<p><span style="color: #ff6600">eg\uff1a</span></p>\u000a<p><span style="color: #ff6600">int shmid;</span></p>\u000a<p><span style="color: #ff6600">shmid=shmget(IPC_PRIVATE,4096,IPC_CREATE|IPC_EXCL|0660);</span></p>\u000a<p><span style="color: #ff6600">if(shmid==-1)</span></p>\u000a<p><span style="color: #ff6600">perror("shmget()");</span></p>\u000a<p><span style="color: #ff6600">&nbsp;</span></p>\u000a<p><span style="color: #ff6600">2.\u8fde\u63a5\u5171\u4eab\u5185\u5b58</span></p>\u000a<p><span style="color: #ff6600">char *shmat(int shmid,char *shmaddr,int shmflg);</span></p>\u000a<p><span style="color: #ff6600">\u53c2\u6570\u8bf4\u660e</span></p>\u000a<p><span style="color: #ff6600">shmid\uff1a\u5171\u4eab\u5185\u5b58\u7684\u5173\u952e\u5b57</span></p>\u000a<p><span style="color: #ff6600">shmaddr\uff1a\u6307\u5b9a\u5171\u4eab\u5185\u5b58\u51fa\u73b0\u5728\u8fdb\u7a0b\u5185\u5b58\u5730\u5740\u7684\u4ec0\u4e48\u4f4d\u7f6e\uff0c\u901a\u5e38\u6211\u4eec\u8ba9\u5185\u6838\u81ea\u5df1\u51b3\u5b9a\u4e00\u4e2a\u5408\u9002\u7684\u5730\u5740\u4f4d\u7f6e\uff0c\u7528\u7684\u65f6\u5019\u8bbe\u4e3a0\u3002</span></p>\u000a<p><span style="color: #ff6600">shmflg\uff1a\u5236\u5b9a\u7279\u6b8a\u7684\u6807\u5fd7\u4f4d\u3002</span></p>\u000a<p><span style="color: #ff6600">eg\uff1a</span></p>\u000a<p><span style="color: #ff6600">int shmid;</span></p>\u000a<p><span style="color: #ff6600">char *shmp;</span></p>\u000a<p><span style="color: #ff6600">shmp=shmat(shmid,0,0);</span></p>\u000a<p><span style="color: #ff6600">if(shmp==(char *)(-1))</span></p>\u000a<p><span style="color: #ff6600">perror("shmat()\u005cn");</span></p>\u000a<p><span style="color: #ff6600">3.\u4f7f\u7528\u5171\u4eab\u5185\u5b58</span></p>\u000a<p><span style="color: #ff6600">\u5728\u4f7f\u7528\u5171\u4eab\u5185\u5b58\u662f\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4e3a\u9632\u6b62\u5185\u5b58\u8bbf\u95ee\u51b2\u7a81\uff0c\u6211\u4eec\u4e00\u822c\u4e0e\u4fe1\u53f7\u91cf\u7ed3\u5408\u4f7f\u7528\u3002</span></p>\u000a<p><span style="color: #ff6600">4.\u5206\u79bb\u5171\u4eab\u5185\u5b58\uff1a\u5f53\u7a0b\u5e8f\u4e0d\u518d\u9700\u8981\u5171\u4eab\u5185\u540e\uff0c\u6211\u4eec\u9700\u8981\u5c06\u5171\u4eab\u5185\u5b58\u5206\u79bb\u4ee5\u4fbf\u5bf9\u5176\u8fdb\u884c\u91ca\u653e\uff0c\u5206\u79bb\u5171\u4eab\u5185\u5b58\u7684\u51fd\u6570\u539f\u5f62\u5982\u4e0b\uff1a</span></p>\u000a<p><span style="color: #ff6600">int shmdt(char *shmaddr);</span></p>\u000a<p><br />\u000a<span style="color: #ff6600">&nbsp;</span></p>\u000a<p><span style="color: #ff6600">5. \u91ca\u653e\u5171\u4eab\u5185\u5b58</span></p>\u000a<p><span style="color: #ff6600">int shmctl(int shmid,int cmd,struct shmid_ds *buf);</span></p>\u000a\u000a	<div class = "postDesc">posted on 2009-10-08 10:52 <a href='http://www.blogjava.net/sunzhong/'>\u6708\u5149\u8bb0\u5fc6</a> \u9605\u8bfb(8107) <a href='#Post'>\u8bc4\u8bba(2)</a> &nbsp;<a href="http://www.blogjava.net/sunzhong/admin/EditArticles.aspx?postid=297435">\u7f16\u8f91</a> &nbsp;<a href="http://www.blogjava.net/sunzhong/AddToFavorite.aspx?id=297435">\u6536\u85cf</a>  \u6240\u5c5e\u5206\u7c7b: <a href='http://www.blogjava.net/sunzhong/category/41975.html'>c\u8fdb\u7a0b\u95f4\u901a\u4fe1</a> </div>\u000a</div>\u000a<img src ="http://www.blogjava.net/sunzhong/aggbug/297435.html?webview=1" width = "1" height = "1" />\u000a\u000a<!--\u000a<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\u000axmlns:dc="http://purl.org/dc/elements/1.1/"\u000axmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">\u000a<rdf:Description\u000ardf:about="http://www.blogjava.net/sunzhong/articles/297435.html"\u000adc:identifier="http://www.blogjava.net/sunzhong/articles/297435.html"\u000adc:title="Linux \u8fdb\u7a0b\u95f4\u901a\u4fe1 - \u5171\u4eab\u5185\u5b58shmget\u65b9\u5f0f(\u8f6c)"\u000atrackback:ping="http://www.blogjava.net/sunzhong/services/trackbacks/297435.aspx" />\u000a</rdf:RDF>\u000a-->\u000a\u000a<script type="text/javascript">\u000a//<![CDATA[\u000aSys.WebForms.PageRequestManager._initialize('AjaxHolder$scriptmanager1', document.getElementById('Form1'));\u000aSys.WebForms.PageRequestManager.getInstance()._updateControls(['tAjaxHolder$UpdatePanel1'], [], [], 90);\u000a//]]>\u000a</script>\u000a\u000a<div id="AjaxHolder_UpdatePanel1">\u000a	    \u000a    <a name="pagedcomment"></a>\u000a<!--done-->\u000a<br>\u000a<b>FeedBack:</b>\u000a<div class="feedbackNoItems"></div>\u000a	\u000a\u000a		<div class="feedbackItem">\u000a			<div class = "feedbackListTitle"><a title="permalink: re: Linux \u8fdb\u7a0b\u95f4\u901a\u4fe1 - \u5171\u4eab\u5185\u5b58shmget\u65b9\u5f0f(\u8f6c)" href="/sunzhong/articles/297435.html#389123">#</a>&nbsp;<a name="389123"></a>re: Linux \u8fdb\u7a0b\u95f4\u901a\u4fe1 - \u5171\u4eab\u5185\u5b58shmget\u65b9\u5f0f(\u8f6c)</div>\u000a			<div class = "feedbackListSubtitle">\u000a				2012-10-07 14:10 | <a id="AjaxHolder_Comments_CommentList_ctl00_NameLink" target="_blank">\u5218\u5fb7\u670b</a><br>\u000a				<div align=left>\u5f88\u597d&nbsp;&nbsp;<a onclick="return SetReplyAuhor(&quot;\u5218\u5fb7\u670b&quot;)" href="/sunzhong/articles/297435.html#post">\u56de\u590d</a>&nbsp;&nbsp;<a title="\u67e5\u770b\u8be5\u4f5c\u8005\u53d1\u8868\u8fc7\u7684\u8bc4\u8bba" href="http://www.blogjava.net/comment?author=%e5%88%98%e5%be%b7%e6%9c%8b" target="_blank">\u66f4\u591a\u8bc4\u8bba</a><br><a id="AjaxHolder_Comments_CommentList_ctl00_DeleteLink" href="javascript:__doPostBack('AjaxHolder$Comments$CommentList$ctl00$DeleteLink','')"></a>&nbsp;&nbsp;<a id="AjaxHolder_Comments_CommentList_ctl00_EditLink"></a></div>\u000a			</div>\u000a			\u000a			\u000a		</div>\u000a	\u000a		<div class="feedbackItem">\u000a			<div class = "feedbackListTitle"><a title="permalink: re: Linux \u8fdb\u7a0b\u95f4\u901a\u4fe1 - \u5171\u4eab\u5185\u5b58shmget\u65b9\u5f0f(\u8f6c)" href="/sunzhong/articles/297435.html#396002">#</a>&nbsp;<a name="396002"></a>re: Linux \u8fdb\u7a0b\u95f4\u901a\u4fe1 - \u5171\u4eab\u5185\u5b58shmget\u65b9\u5f0f(\u8f6c)<a name="Post"></a></div>\u000a			<div class = "feedbackListSubtitle">\u000a				2013-03-03 16:41 | <a id="AjaxHolder_Comments_CommentList_ctl01_NameLink" target="_blank">\u8d3a\u4e91\u98de</a><br>\u000a				<div align=left>\u5206\u6790\u900f\u5f7b\uff0c\u5f3a&nbsp;&nbsp;<a onclick="return SetReplyAuhor(&quot;\u8d3a\u4e91\u98de&quot;)" href="/sunzhong/articles/297435.html#post">\u56de\u590d</a>&nbsp;&nbsp;<a title="\u67e5\u770b\u8be5\u4f5c\u8005\u53d1\u8868\u8fc7\u7684\u8bc4\u8bba" href="http://www.blogjava.net/comment?author=%e8%b4%ba%e4%ba%91%e9%a3%9e" target="_blank">\u66f4\u591a\u8bc4\u8bba</a><br><a id="AjaxHolder_Comments_CommentList_ctl01_DeleteLink" href="javascript:__doPostBack('AjaxHolder$Comments$CommentList$ctl01$DeleteLink','')"></a>&nbsp;&nbsp;<a id="AjaxHolder_Comments_CommentList_ctl01_EditLink"></a></div>\u000a			</div>\u000a			\u000a			\u000a		</div>\u000a	\u000a\u000a\u000a\u000a\u000a<style>\u000atd { font-size: 12px }\u000a.commentTextBox \u000a{ \u000a    font-family : Verdana; \u000a    font-size: 13px;\u000a }\u000a</style>\u000a<!--Beging Temp Save-->\u000a<STYLE>.userData { BEHAVIOR: url(#default#userdata) }\u000a	</STYLE>\u000a<DIV class="userData" id="CommentsPersistDiv"></DIV>\u000a\u000a<script type="text/javascript">\u000afunction pageLoad()\u000a{\u000a    Sys.WebForms.PageRequestManager.getInstance().add_initializeRequest(handleInitializeRequest);\u000a    //Sys.WebForms.PageRequestManager.getInstance().add_endRequest(handleEndRequest);\u000a}\u000a\u000afunction handleInitializeRequest(sender, args)\u000a{\u000a    var prm = Sys.WebForms.PageRequestManager.getInstance();\u000a    var eid = args.get_postBackElement().id;\u000a    if (eid.indexOf("DeleteLink")>0) \u000a    {\u000a       args.get_postBackElement().innerHTML = "<font color='red'>\u6b63\u5728\u5220\u9664...</font>";         \u000a    }    \u000a    else if (eid.indexOf("btnSubmit")>0) \u000a    {\u000a       document.getElementById("AjaxHolder_PostComment_ltSubmitMsg").innerHTML="\u6b63\u5728\u63d0\u4ea4...";\u000a       document.getElementById("AjaxHolder_PostComment_btnSubmit").disabled = true;       \u000a    }   \u000a    else if(eid.indexOf("refreshList")>0)\u000a    {\u000a        document.getElementById("AjaxHolder_PostComment_refreshList").innerHTML="<font color='red'>\u6b63\u5728\u5237\u65b0...</font>";\u000a    }\u000a   \u000a}	\u000a\u000afunction TempSave(ElementID)\u000a{\u000a	try\u000a	{\u000a	CommentsPersistDiv.setAttribute("CommentContent",document.getElementById(ElementID).value);\u000a	CommentsPersistDiv.save("CommentXMLStore");\u000a	}\u000a	catch(ex)\u000a	{\u000a	}\u000a	\u000a}\u000afunction Restore(ElementID)\u000a{\u000a	CommentsPersistDiv.load("CommentXMLStore");\u000a	document.getElementById(ElementID).value=CommentsPersistDiv.getAttribute("CommentContent");\u000a}	\u000a			\u000a			\u000a</script>\u000a<!--Ene TempSave-->\u000a<div id="divRefreshComments" style="text-align:right;margin-right:10px;margin-bottom:5px;font-size:12px"><a href="/RequireRegister.aspx">\u65b0\u7528\u6237\u6ce8\u518c</a>&nbsp;&nbsp;<a id="AjaxHolder_PostComment_refreshList" href="javascript:__doPostBack('AjaxHolder$PostComment$refreshList','')">\u5237\u65b0\u8bc4\u8bba\u5217\u8868</a>&nbsp;&nbsp;</div>\u000a<div class="commentform">\u000a<span id="AjaxHolder_PostComment_ltSubmitMsg" style="color:Red;"></span>\u000a<br />\u000a<a name="Feedback"></a>\u000a	<TABLE cellSpacing="1" cellPadding="1" border="0">\u000a		<tr>\u000a		<td id="AjaxHolder_PostComment_tdOnCommentForm" colspan="3" style="line-height:1.5">		\u000a		</td>\u000a	\u000a		</tr>\u000a		\u000a		<tr><td colSpan="3">\u53ea\u6709\u6ce8\u518c\u7528\u6237<a href='http://www.blogjava.net/login.aspx?ReturnUrl=/sunzhong/articles/297435.html'>\u767b\u5f55</a>\u540e\u624d\u80fd\u53d1\u8868\u8bc4\u8bba\u3002</td></tr>\u000a		<TR>\u000a			<TD colSpan="3"><!----></TD>\u000a		</TR>\u000a		<!--\u000a		<TR>\u000a			<TD colSpan="3" height="5"></TD>\u000a		</TR>	\u000a		-->	\u000a		<TR>\u000a		<TD colSpan="3">\u000a		<br/>\u000a		\u000a<script type='text/javascript'>\u000avar googletag = googletag || {};\u000agoogletag.cmd = googletag.cmd || [];\u000a(function() {\u000avar gads = document.createElement('script');\u000agads.async = true;\u000agads.type = 'text/javascript';\u000avar useSSL = 'https:' == document.location.protocol;\u000agads.src = (useSSL ? 'https:' : 'http:') + \u000a'//www.googletagservices.com/tag/js/gpt.js';\u000avar node = document.getElementsByTagName('script')[0];\u000anode.parentNode.insertBefore(gads, node);\u000a})();\u000a</script>\u000a\u000a<script type='text/javascript'>\u000agoogletag.cmd.push(function() {\u000agoogletag.defineSlot('/1090369/blogjava_blogpost_bottom', [300, 250], 'div-gpt-ad-1364133350381-0').addService(googletag.pubads());\u000agoogletag.pubads().enableSingleRequest();\u000agoogletag.enableServices();\u000a});\u000a</script>\u000a<!-- blogjava_blogpost_bottom -->\u000a<div id='div-gpt-ad-1364133350381-0' style='width:300px; height:250px;'>\u000a<script type='text/javascript'>\u000agoogletag.cmd.push(function() { googletag.display('div-gpt-ad-1364133350381-0'); });\u000a</script>\u000a</div>\u000a<br/>\u000a\u000a		</TD>\u000a		</TR>\u000a		<tr>			\u000a		<td colspan="3">\u000a		\u000a		</td>\u000a		</tr>\u000a		<TR>\u000a		<TD colSpan="3"></TD>\u000a		</TR>\u000a		<TR>\u000a			<TD colSpan="3" height="1">\u7f51\u7ad9\u5bfc\u822a:<div id="blogsite">\u000a			<a href="http://www.cnblogs.com" title="\u5f00\u53d1\u8005\u7684\u7f51\u4e0a\u5bb6\u56ed">\u535a\u5ba2\u56ed</a>&nbsp;&nbsp;\u000a			<a href="https://news.cnblogs.com">IT\u65b0\u95fb</a>&nbsp;&nbsp;\u000a			<a href="http://kb.cnblogs.com">\u77e5\u8bc6\u5e93</a>&nbsp;&nbsp;\u000a			<a href="http://www.cppblog.com">C++\u535a\u5ba2</a>&nbsp;&nbsp;\u000a			<a href="https://q.cnblogs.com">\u535a\u95ee</a>&nbsp;&nbsp;\u000a			<a href="/sunzhong/articles/297435.html?opt=admin">\u7ba1\u7406</a>\u000a			</div>\u000a		</TD>\u000a		</TR>\u000a		<TR>\u000a			<TD colSpan="3" height="5">\u000a<div id="divRelativePosts">\u000a\u76f8\u5173\u6587\u7ae0:\u000a	\u000a			<ul style="margin-top:0px;padding-left:0px;">\u000a		\u000a			<li style='list-style:none;'>\u000a				<a id="AjaxHolder_PostComment_ctl07_RelativePostsList_ctl01_Hyperlink1" href="http://www.blogjava.net/sunzhong/articles/297960.html">linux\u7cfb\u7edf\u8c03\u7528\u4e4bftok()</a>\u000a			</li>\u000a		\u000a			<li style='list-style:none;'>\u000a				<a id="AjaxHolder_PostComment_ctl07_RelativePostsList_ctl02_Hyperlink1" href="http://www.blogjava.net/sunzhong/articles/297444.html">\u8fdb\u7a0b\u95f4\u4fe1\u53f7\u91cf\u89e3\u6790(semaphore)</a>\u000a			</li>\u000a		\u000a			<li style='list-style:none;'>\u000a				<a id="AjaxHolder_PostComment_ctl07_RelativePostsList_ctl03_Hyperlink1" href="http://www.blogjava.net/sunzhong/articles/297436.html">\u4e00\u4e2a\u5305\u542b\u4e86\u4fe1\u53f7\u3001\u4fe1\u53f7\u91cf\u3001\u5171\u4eab\u5185\u5b58\u7684\u4f8b\u5b50(\u8f6c)</a>\u000a			</li>\u000a		\u000a			<li style='list-style:none;display:none'>\u000a				<a id="AjaxHolder_PostComment_ctl07_RelativePostsList_ctl04_Hyperlink1" href="http://www.blogjava.net/sunzhong/articles/297435.html">Linux \u8fdb\u7a0b\u95f4\u901a\u4fe1 - \u5171\u4eab\u5185\u5b58shmget\u65b9\u5f0f(\u8f6c)</a>\u000a			</li>\u000a		\u000a			<li style='list-style:none;'>\u000a				<a id="AjaxHolder_PostComment_ctl07_RelativePostsList_ctl05_Hyperlink1" href="http://www.blogjava.net/sunzhong/articles/297308.html">\u6587\u4ef6io\u7684\u539f\u5b50\u64cd\u4f5c(\u8f6c)</a>\u000a			</li>\u000a		\u000a			<li style='list-style:none;'>\u000a				<a id="AjaxHolder_PostComment_ctl07_RelativePostsList_ctl06_Hyperlink1" href="http://www.blogjava.net/sunzhong/articles/297303.html">\u5185\u6838\u7528\u4e8e\u6240\u6709I / O\u7684\u6570\u636e\u7ed3\u6784(\u8f6c)</a>\u000a			</li>\u000a		\u000a			</ul>\u000a		\u000a</div>\u000a</TD>\u000a		</TR>	\u000a		<TR>\u000a			<TD colSpan="3">&nbsp;</TD>\u000a		</TR>\u000a		<TR>\u000a			<TD colSpan="3" height="5"></TD>\u000a		</TR>\u000a		<TR>\u000a			<TD colSpan="3">\u000a				</TD>\u000a		</TR>		\u000a	</TABLE>	\u000a</div>\u000a<div id="AjaxHolder_PostComment_ValidationSummary1" style="color:Red;display:none;">\u000a\u000a	</div>\u000a\u000a</div>\u000a\u000a				\u000a	\u000a<!--done-->\u000a<div class="footer">\u000a	\u000a	Copyright &copy;2016  \u6708\u5149\u8bb0\u5fc6 Powered By: <a href="http://www.cnblogs.com">\u535a\u5ba2\u56ed</a> \u6a21\u677f\u63d0\u4f9b\uff1a<a href="http://blog.hjenglish.com">\u6caa\u6c5f\u535a\u5ba2</a>\u000a</div>\u000a</div>\u000a\u000a<div id="leftcontent">\u000a	\u000a		<DIV id="leftcontentcontainer">\u000a			<table id="Calendar1_entryCal" class="Cal" cellspacing="0" cellpadding="0" title="\u65e5\u5386" border="0" style="border-width:1px;border-style:solid;border-collapse:collapse;border:0px">\u000a	<tr><td colspan="7" style="background-color:Transparent;"><table class="CalTitle" cellspacing="0" border="0" style="width:100%;border-collapse:collapse;">\u000a		<tr><td class="CalNextPrev" style="width:15%;"><a href="javascript:__doPostBack('Calendar1$entryCal','V6149')" style="color:Black" title="\u8f6c\u5230\u4e0a\u4e00\u4e2a\u6708">&lt;</a></td><td align="center" style="width:70%;">2016\u5e7412\u6708</td><td class="CalNextPrev" align="right" style="width:15%;"><a href="javascript:__doPostBack('Calendar1$entryCal','V6210')" style="color:Black" title="\u8f6c\u5230\u4e0b\u4e00\u4e2a\u6708">&gt;</a></td></tr>\u000a	</table></td></tr><tr><th class="CalDayHeader" align="center" abbr="\u65e5" scope="col">\u65e5</th><th class="CalDayHeader" align="center" abbr="\u4e00" scope="col">\u4e00</th><th class="CalDayHeader" align="center" abbr="\u4e8c" scope="col">\u4e8c</th><th class="CalDayHeader" align="center" abbr="\u4e09" scope="col">\u4e09</th><th class="CalDayHeader" align="center" abbr="\u56db" scope="col">\u56db</th><th class="CalDayHeader" align="center" abbr="\u4e94" scope="col">\u4e94</th><th class="CalDayHeader" align="center" abbr="\u516d" scope="col">\u516d</th></tr><tr><td class="CalOtherMonthDay" align="center" style="width:14%;">27</td><td class="CalOtherMonthDay" align="center" style="width:14%;">28</td><td class="CalOtherMonthDay" align="center" style="width:14%;">29</td><td class="CalOtherMonthDay" align="center" style="width:14%;">30</td><td align="center" style="width:14%;">1</td><td align="center" style="width:14%;">2</td><td class="CalWeekendDay" align="center" style="width:14%;">3</td></tr><tr><td class="CalWeekendDay" align="center" style="width:14%;">4</td><td align="center" style="width:14%;">5</td><td align="center" style="width:14%;">6</td><td align="center" style="width:14%;">7</td><td align="center" style="width:14%;">8</td><td align="center" style="width:14%;">9</td><td class="CalWeekendDay" align="center" style="width:14%;">10</td></tr><tr><td class="CalWeekendDay" align="center" style="width:14%;">11</td><td align="center" style="width:14%;">12</td><td align="center" style="width:14%;">13</td><td align="center" style="width:14%;">14</td><td align="center" style="width:14%;">15</td><td align="center" style="width:14%;">16</td><td class="CalWeekendDay" align="center" style="width:14%;">17</td></tr><tr><td class="CalWeekendDay" align="center" style="width:14%;">18</td><td align="center" style="width:14%;">19</td><td align="center" style="width:14%;">20</td><td class="CalTodayDay" align="center" style="width:14%;">21</td><td align="center" style="width:14%;">22</td><td align="center" style="width:14%;">23</td><td class="CalWeekendDay" align="center" style="width:14%;">24</td></tr><tr><td class="CalWeekendDay" align="center" style="width:14%;">25</td><td align="center" style="width:14%;">26</td><td align="center" style="width:14%;">27</td><td align="center" style="width:14%;">28</td><td align="center" style="width:14%;">29</td><td align="center" style="width:14%;">30</td><td class="CalWeekendDay" align="center" style="width:14%;">31</td></tr><tr><td class="CalOtherMonthDay" align="center" style="width:14%;">1</td><td class="CalOtherMonthDay" align="center" style="width:14%;">2</td><td class="CalOtherMonthDay" align="center" style="width:14%;">3</td><td class="CalOtherMonthDay" align="center" style="width:14%;">4</td><td class="CalOtherMonthDay" align="center" style="width:14%;">5</td><td class="CalOtherMonthDay" align="center" style="width:14%;">6</td><td class="CalOtherMonthDay" align="center" style="width:14%;">7</td></tr>\u000a</table>\u000a<br>\u000a			\u000a			\u000a<H3>\u7559\u8a00\u7c3f<span style="font-size:11px;font-weight:normal;">(2)</span></H3>\u000a<ul>\u000a	<li>\u000a		<a id="SingleColumn1_ctl01_lnkMessages" href="http://www.blogjava.net/sunzhong/Contact.aspx?id=1">\u7ed9\u6211\u7559\u8a00</a>\u000a	<li>\u000a		<a id="SingleColumn1_ctl01_lnkPublicMsgView" href="http://www.blogjava.net/sunzhong/default.aspx?opt=msg">\u67e5\u770b\u516c\u5f00\u7559\u8a00</a>\u000a	<li>\u000a		<a id="SingleColumn1_ctl01_lnkPrivateMsgView" href="http://www.blogjava.net/sunzhong/admin/MyMessages.aspx">\u67e5\u770b\u79c1\u4eba\u7559\u8a00</a>\u000a	</li>\u000a</ul>\u000a\u000a<!--done-->\u000a\u000a		<h1 class = "catListTitle">\u968f\u7b14\u5206\u7c7b</h1>\u000a		\u000a				<ul class = "catList">\u000a			\u000a				<li class = "catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl01_Link" class="listitem" href="http://www.blogjava.net/sunzhong/category/44369.html">j2me</a><a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl01_RssLink" title="Subscribe to j2me" class="listitem" href="http://www.blogjava.net/sunzhong/category/44369.html/rss"><img title="Subscribe to j2me" src="/Skins/rivercast/Images/xml.gif" style="border-width:0px;" /></a></li>\u000a			\u000a				<li class = "catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl02_Link" class="listitem" href="http://www.blogjava.net/sunzhong/category/40530.html">linux</a><a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl02_RssLink" title="Subscribe to linux" class="listitem" href="http://www.blogjava.net/sunzhong/category/40530.html/rss"><img title="Subscribe to linux" src="/Skins/rivercast/Images/xml.gif" style="border-width:0px;" /></a></li>\u000a			\u000a				</ul>\u000a			\u000a	\u000a		<h1 class = "catListTitle">\u6587\u7ae0\u5206\u7c7b</h1>\u000a		\u000a				<ul class = "catList">\u000a			\u000a				<li class = "catListItem"> <a id="SingleColumn1_Categories_CatList_ctl01_LinkList_ctl01_Link" class="listitem" href="http://www.blogjava.net/sunzhong/category/41054.html">c(13)</a><a id="SingleColumn1_Categories_CatList_ctl01_LinkList_ctl01_RssLink" title="Subscribe to c(13)" class="listitem" href="http://www.blogjava.net/sunzhong/category/41054.html/rss"><img title="Subscribe to c(13)" src="/Skins/rivercast/Images/xml.gif" style="border-width:0px;" /></a></li>\u000a			\u000a				<li class = "catListItem"> <a id="SingleColumn1_Categories_CatList_ctl01_LinkList_ctl02_Link" class="listitem" href="http://www.blogjava.net/sunzhong/category/41914.html">c\u591a\u7ebf\u7a0b\u5b66\u4e60(3)</a><a id="SingleColumn1_Categories_CatList_ctl01_LinkList_ctl02_RssLink" title="Subscribe to c\u591a\u7ebf\u7a0b\u5b66\u4e60(3)" class="listitem" href="http://www.blogjava.net/sunzhong/category/41914.html/rss"><img title="Subscribe to c\u591a\u7ebf\u7a0b\u5b66\u4e60(3)" src="/Skins/rivercast/Images/xml.gif" style="border-width:0px;" /></a></li>\u000a			\u000a				<li class = "catListItem"> <a id="SingleColumn1_Categories_CatList_ctl01_LinkList_ctl03_Link" class="listitem" href="http://www.blogjava.net/sunzhong/category/41975.html">c\u8fdb\u7a0b\u95f4\u901a\u4fe1(8)</a><a id="SingleColumn1_Categories_CatList_ctl01_LinkList_ctl03_RssLink" title="Subscribe to c\u8fdb\u7a0b\u95f4\u901a\u4fe1(8)" class="listitem" href="http://www.blogjava.net/sunzhong/category/41975.html/rss"><img title="Subscribe to c\u8fdb\u7a0b\u95f4\u901a\u4fe1(8)" src="/Skins/rivercast/Images/xml.gif" style="border-width:0px;" /></a></li>\u000a			\u000a				<li class = "catListItem"> <a id="SingleColumn1_Categories_CatList_ctl01_LinkList_ctl04_Link" class="listitem" href="http://www.blogjava.net/sunzhong/category/41209.html">java\u57fa\u672c(4)</a><a id="SingleColumn1_Categories_CatList_ctl01_LinkList_ctl04_RssLink" title="Subscribe to java\u57fa\u672c(4)" class="listitem" href="http://www.blogjava.net/sunzhong/category/41209.html/rss"><img title="Subscribe to java\u57fa\u672c(4)" src="/Skins/rivercast/Images/xml.gif" style="border-width:0px;" /></a></li>\u000a			\u000a				<li class = "catListItem"> <a id="SingleColumn1_Categories_CatList_ctl01_LinkList_ctl05_Link" class="listitem" href="http://www.blogjava.net/sunzhong/category/40529.html">linux(5)</a><a id="SingleColumn1_Categories_CatList_ctl01_LinkList_ctl05_RssLink" title="Subscribe to linux(5)" class="listitem" href="http://www.blogjava.net/sunzhong/category/40529.html/rss"><img title="Subscribe to linux(5)" src="/Skins/rivercast/Images/xml.gif" style="border-width:0px;" /></a></li>\u000a			\u000a				<li class = "catListItem"> <a id="SingleColumn1_Categories_CatList_ctl01_LinkList_ctl06_Link" class="listitem" href="http://www.blogjava.net/sunzhong/category/41042.html">ORCLE(7)</a><a id="SingleColumn1_Categories_CatList_ctl01_LinkList_ctl06_RssLink" title="Subscribe to ORCLE(7)" class="listitem" href="http://www.blogjava.net/sunzhong/category/41042.html/rss"><img title="Subscribe to ORCLE(7)" src="/Skins/rivercast/Images/xml.gif" style="border-width:0px;" /></a></li>\u000a			\u000a				</ul>\u000a			\u000a	\u000a		<h1 class = "catListTitle">\u6587\u7ae0\u6863\u6848</h1>\u000a		\u000a				<ul class = "catList">\u000a			\u000a				<li class = "catListItem"> <a id="SingleColumn1_Categories_CatList_ctl02_LinkList_ctl01_Link" class="listitem" href="http://www.blogjava.net/sunzhong/archives/2010/03.html">2010\u5e743\u6708 (2)</a></li>\u000a			\u000a				<li class = "catListItem"> <a id="SingleColumn1_Categories_CatList_ctl02_LinkList_ctl02_Link" class="listitem" href="http://www.blogjava.net/sunzhong/archives/2009/10.html">2009\u5e7410\u6708 (10)</a></li>\u000a			\u000a				<li class = "catListItem"> <a id="SingleColumn1_Categories_CatList_ctl02_LinkList_ctl03_Link" class="listitem" href="http://www.blogjava.net/sunzhong/archives/2009/09.html">2009\u5e749\u6708 (5)</a></li>\u000a			\u000a				<li class = "catListItem"> <a id="SingleColumn1_Categories_CatList_ctl02_LinkList_ctl04_Link" class="listitem" href="http://www.blogjava.net/sunzhong/archives/2009/08.html">2009\u5e748\u6708 (6)</a></li>\u000a			\u000a				<li class = "catListItem"> <a id="SingleColumn1_Categories_CatList_ctl02_LinkList_ctl05_Link" class="listitem" href="http://www.blogjava.net/sunzhong/archives/2009/07.html">2009\u5e747\u6708 (11)</a></li>\u000a			\u000a				<li class = "catListItem"> <a id="SingleColumn1_Categories_CatList_ctl02_LinkList_ctl06_Link" class="listitem" href="http://www.blogjava.net/sunzhong/archives/2009/06.html">2009\u5e746\u6708 (3)</a></li>\u000a			\u000a				</ul>\u000a			\u000a	\u000a\u000a\u000a<script language="JavaScript">\u000afunction SearchGoogle(key,evt,site)\u000a		{\u000a			if(evt.keyCode==13 || evt.keyCode==0 || evt.type =='click')\u000a			{\u000a				key.focus();\u000a				var keystr = encodeURIComponent(key.value);\u000a				url = "http://www.google.com/search?q=";\u000a				url = url+keystr;\u000a				url += "&ie=UTF-8&oe=GB2312&hl=zh-CN&domains="+site+"&sitesearch="+site;\u000a				window.location=url;\u000a				return false;\u000a			}\u000a		}\u000a</script>\u000a<H3>\u641c\u7d22</H3>\u000a<ul>\u000a	<li>\u000a		<li><input style="WIDTH: 130px" type="text" name="q" id="q" onkeydown="return SearchGoogle(document.getElementById('q'),event,'www.blogjava.net/sunzhong')">&nbsp;<input onclick="SearchGoogle(document.getElementById('q'),event,'www.blogjava.net/sunzhong')" type="button" value="\u641c\u7d22" name="sa">\u000a	</li>\u000a</ul>\u000a\u000a<h3>\u6700\u65b0\u8bc4\u8bba\u000a	<a id="SingleColumn1__2cf8b11_RSSHyperlink1" href="http://www.blogjava.net/sunzhong/CommentsRSS.aspx"><img src="/images/xml.gif" style="border-width:0px;" /></a></h3>\u000a<div class="RecentComment">\u000a	\u000a			<ul>\u000a		\u000a			<li style="word-break:break-all">\u000a				<a id="SingleColumn1__2cf8b11_CommentList_ctl01_Hyperlink1" href="http://www.blogjava.net/sunzhong/archive/2013/03/03/297435.html#396002">1.re: Linux \u8fdb\u7a0b\u95f4\u901a\u4fe1 - \u5171\u4eab\u5185\u5b58shmget\u65b9\u5f0f(\u8f6c)</a>\u000a			</li>\u000a			<li style="word-break:break-all">\u000a				\u5206\u6790\u900f\u5f7b\uff0c\u5f3a\u000a			</li>\u000a			<li style="text-align:right;margin-right:4px">\u000a				--\u8d3a\u4e91\u98de</li>\u000a		\u000a			<li style="word-break:break-all">\u000a				<a id="SingleColumn1__2cf8b11_CommentList_ctl02_Hyperlink1" href="http://www.blogjava.net/sunzhong/archive/2012/10/07/297435.html#389123">2.re: Linux \u8fdb\u7a0b\u95f4\u901a\u4fe1 - \u5171\u4eab\u5185\u5b58shmget\u65b9\u5f0f(\u8f6c)</a>\u000a			</li>\u000a			<li style="word-break:break-all">\u000a				\u5f88\u597d\u000a			</li>\u000a			<li style="text-align:right;margin-right:4px">\u000a				--\u5218\u5fb7\u670b</li>\u000a		\u000a			<li style="word-break:break-all">\u000a				<a id="SingleColumn1__2cf8b11_CommentList_ctl03_Hyperlink1" href="http://www.blogjava.net/sunzhong/archive/2009/12/02/289139.html#304469">3.re: user_constraints \u548cuser_cons_columns\u8868\u5f97\u4f5c\u7528\u53ca\u5176\u8054\u7cfb</a>\u000a			</li>\u000a			<li style="word-break:break-all">\u000a				\u592a\u8c22\u8c22\u4f60\u4e86\uff01\u6b63\u5728\u5f04\u4e0e\u201c\u5173\u7cfb\u201d\u76f8\u5173\u7684\u9879\u76ee\uff01\u4f60\u7684\u6587\u7ae0\u592a\u53ca\u65f6\u4e86\uff01\u000a			</li>\u000a			<li style="text-align:right;margin-right:4px">\u000a				--zmz2008</li>\u000a		\u000a			</ul>\u000a		\u000a</div>\u000a</DIV>\u000a	\u000a</div>\u000a\u000a</div>\u000a\u000a</div>\u000a\u000a    \u000a<script type="text/javascript">\u000a//<![CDATA[\u000avar Page_ValidationSummaries =  new Array(document.getElementById("AjaxHolder_PostComment_ValidationSummary1"));\u000a//]]>\u000a</script>\u000a\u000a<script type="text/javascript">\u000a//<![CDATA[\u000avar AjaxHolder_PostComment_ValidationSummary1 = document.all ? document.all["AjaxHolder_PostComment_ValidationSummary1"] : document.getElementById("AjaxHolder_PostComment_ValidationSummary1");\u000aAjaxHolder_PostComment_ValidationSummary1.showmessagebox = "True";\u000aAjaxHolder_PostComment_ValidationSummary1.showsummary = "False";\u000a//]]>\u000a</script>\u000a\u000a\u000a<script type="text/javascript">\u000a//<![CDATA[\u000a\u000adocument.getElementById('AjaxHolder_PostComment_ValidationSummary1').dispose = function() {\u000a    Array.remove(Page_ValidationSummaries, document.getElementById('AjaxHolder_PostComment_ValidationSummary1'));\u000a}\u000aSys.Application.initialize();\u000a//]]>\u000a</script>\u000a</form>\u000a    <script type="text/javascript" src="/script/ShowHidden.js"></script>\u000a	<script type="text/javascript">\u000a	  var _gaq = _gaq || [];\u000a	  _gaq.push(['_setAccount', 'UA-476124-3']);\u000a	  _gaq.push(['_trackPageview']);\u000a\u000a	  (function() {\u000a		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;\u000a		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';\u000a		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);\u000a	  })();\u000a	</script>\u000a</body>\u000a</html>\u000a
p3
a.