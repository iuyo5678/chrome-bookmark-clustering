(lp0
S'https://live.gnome.org/RhythmboxPlugins/WritingGuide'
p1
aS'RhythmboxPlugins/WritingGuide - GNOME Live!'
p2
aI0
aV<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">\u000a<html>\u000a<head>\u000a<meta content='initial-scale=1.0,width=device-width' name='viewport'><meta http-equiv="Content-Type" content="text/html;charset=utf-8">\u000a<meta name="robots" content="noindex,nofollow">\u000a\u000a<title>Apps/Rhythmbox/Plugins/WritingGuide - GNOME Wiki!</title>\u000a<script type="text/javascript" src="/gnome/common/js/common.js"></script>\u000a\u000a<script type="text/javascript">\u000a<!--\u000avar search_hint = "Search";\u000a//-->\u000a</script>\u000a\u000a\u000a<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/gnome/gnome/css/common.css">\u000a<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="/gnome/gnome/css/screen.css">\u000a<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="/gnome/gnome/css/print.css">\u000a<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="/gnome/gnome/css/projection.css">\u000a\u000a<!-- css only for MS IE6/IE7 browsers -->\u000a<!--[if lt IE 8]>\u000a   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/gnome/gnome/css/msie.css">\u000a<![endif]-->\u000a\u000a\u000a<link rel="alternate" title="GNOME Wiki!: Apps/Rhythmbox/Plugins/WritingGuide" href="/action/rss_rc/Apps/Rhythmbox/Plugins/WritingGuide?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=Apps%2FRhythmbox%2FPlugins%2FWritingGuide&amp;ddiffs=1" type="application/rss+xml">\u000a\u000a\u000a<link rel="Start" href="/Home">\u000a<link rel="Alternate" title="Wiki Markup" href="/Apps/Rhythmbox/Plugins/WritingGuide?action=raw">\u000a<link rel="Alternate" media="print" title="Print View" href="/Apps/Rhythmbox/Plugins/WritingGuide?action=print">\u000a<link rel="Up" href="/Apps/Rhythmbox/Plugins">\u000a<link rel="Search" href="/FindPage">\u000a<link rel="Index" href="/TitleIndex">\u000a<link rel="Glossary" href="/WordIndex">\u000a<link rel="Help" href="/HelpOnFormatting">\u000a</head>\u000a\u000a<body  lang="en" dir="ltr">\u000a\u000a  <div id="container">\u000a  <div id="header">\u000a    <!-- global gnome.org domain bar -->\u000a    <div id="global_domain_bar">\u000a      <div id="header_tabs">\u000a        <div id="user_tab" class="tab">\u000a<ul id="username"><li><span id="pagelocation"><span class="pagepath"><a href="/Apps">Apps</a><span class="sep">/</span><a href="/Apps/Rhythmbox">Rhythmbox</a><span class="sep">/</span><a href="/Apps/Rhythmbox/Plugins">Plugins</a></span><span class="sep">/</span><a href="/Apps/Rhythmbox/Plugins/WritingGuide">WritingGuide</a></span></li><li class="wikilink"><a href="/Home"><span>Home</span></a></li><li class="wikilink"><a href="/RecentChanges"><span>RecentChanges</span></a></li><li class="wikilink"><a href="/Schedule"><span>Schedule</span></a></li><li><a href="/action/login/Apps/Rhythmbox/Plugins/WritingGuide?action=login" id="login" rel="nofollow">Login</a></li></ul>\u000a\u000a        </div>\u000a        <div id="site_tab" class="tab">\u000a          <a class="root" href="https://www.gnome.org/">GNOME.org</a>\u000a        </div>\u000a      </div>\u000a    </div>\u000a  </div>\u000a<!-- end site header -->\u000a  <div id="main_content">\u000a\u000a<div id="message">\u000a<p><div class="info"><strong>Redirected from page "<a href="/RhythmboxPlugins/WritingGuide?action=show">RhythmboxPlugins/WritingGuide</a>"</strong><br></div></p><a class="clear-link" href="/Apps/Rhythmbox/Plugins/WritingGuide">Clear message</a>\u000a</div>\u000a\u000a<div class="body" lang="en" dir="ltr">\u000a<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>\u000a<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>\u000a<a href="#Introduction_to_Rhythmbox_plugins">Introduction to Rhythmbox plugins</a></li><li>\u000a<a href="#What_makes_up_a_plugin">What makes up a plugin</a><ol><li>\u000a<a href="#The_Plugin_Description_File">The Plugin Description File</a></li></ol></li><li>\u000a<a href="#Overview_of_Rhythmbox_internals_-_pieces_of_the_puzzle">Overview of Rhythmbox internals - pieces of the puzzle</a><ol><li>\u000a<a href="#Top_level">Top level</a></li><li>\u000a<a href="#Sources">Sources</a></li><li>\u000a<a href="#Lower-level_database">Lower-level database</a></li><li>\u000a<a href="#Higher-level_database">Higher-level database</a></li></ol></li><li>\u000a<a href="#Plugin_basics_-_turn_it_on.2C_turn_it_off">Plugin basics - turn it on, turn it off</a><ol><li>\u000a<a href="#Activation">Activation</a></li><li>\u000a<a href="#Deactivation">Deactivation</a></li><li>\u000a<a href="#Finding_your_files">Finding your files</a></li></ol></li><li>\u000a<a href="#Database_essentials">Database essentials</a><ol><li>\u000a<a href="#Entries">Entries</a></li><li>\u000a<a href="#Entry_Types">Entry Types</a></li></ol></li><li>\u000a<a href="#Making_your_plugin_do_something_useful">Making your plugin do something useful</a><ol><li>\u000a<a href="#Adding_UI">Adding UI</a></li><li>\u000a<a href="#Creating_a_Source">Creating a Source</a></li><li>\u000a<a href="#Adding_support_for_new_Removable_Media">Adding support for new Removable Media</a></li><li>\u000a<a href="#Controlling_Playback">Controlling Playback</a></li><li>\u000a<a href="#Adding_a_new_tab_to_the_.22Song_Info.22_window">Adding a new tab to the "Song Info" window</a></li><li>\u000a<a href="#Perform_actions_when_a_source_is_first_selected">Perform actions when a source is first selected</a></li></ol></li><li>\u000a<a href="#Doing_things_the_right_way">Doing things the right way</a><ol><li>\u000a<a href="#Using_threads_when_you_don.27t_need_to">Using threads when you don't need to</a></li><li>\u000a<a href="#Using_asynchronous_IO">Using asynchronous IO</a></li><li>\u000a<a href="#Streaming_IO">Streaming IO</a></li><li>\u000a<a href="#Using_idle_callbacks_for_repeated_tasks">Using idle callbacks for repeated tasks</a></li></ol></li><li>\u000a<a href="#Doing_Cool_Things.28tm.29">Doing Cool Things(tm)</a><ol><li>\u000a<a href="#Adding_elements_to_the_GStreamer_playback_pipeline">Adding elements to the GStreamer playback pipeline</a></li></ol></li><li>\u000a<a href="#How_do_I_...">How do I ...</a><ol><li>\u000a<a href="#Get_the_list_of_entries_in_a_source.3F">Get the list of entries in a source?</a></li><li>\u000a<a href="#Filter_by_.27song.27_type">Filter by 'song' type</a></li><li>\u000a<a href="#Disable_a_bad_plugin_from_outside_Rhythmbox.3F">Disable a bad plugin from outside Rhythmbox?</a></li></ol></li><li>\u000a<a href="#Things_to_check_before_checking_into_git">Things to check before checking into git</a></li></ol></div> <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867">\u000a<h1 id="Introduction_to_Rhythmbox_plugins">Introduction to Rhythmbox plugins</h1>\u000a<span class="anchor" id="line-6"></span><p class="line874">Rhythmbox plugins are external pieces of code that can be loaded to provide extra functionality that is not found in the normal "vanilla" Rhythmbox. Plugins can do basically everything that Rhythmbox itself could do, and in fact some "core" features like Audio CD support and Internet Radio are actually plugins (although not displayed to users as such). <span class="anchor" id="line-7"></span><span class="anchor" id="line-8"></span><p class="line874">Rhythmbox plugins can currently be written in two languages, C and Python; although nothing inherently stops you using other languages, it would require someone to invest a large amount of time to add support for that language.  Python plugins are generally easier to write and maintain, unless you are an experienced GObject-based C programmer, so they are recommended for new plugins.  Note that Python plugins must only use pygobject (introspected bindings) to access GObject-based libraries.  If you're importing such a library by doing anything other than 'from gi.repository import Something', your plugin will crash.  Static and introspected bindings do not mix. <span class="anchor" id="line-9"></span><span class="anchor" id="line-10"></span><p class="line874">Most code samples in this document are written in Python, as it is easier to read and can act as pseudo-code for C programmers. In addition Python plugins can be put into your per-user plugin directory and edited there, whereas C plugins must be built inside the source tree (because they need access to the headers).  <span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span><p class="line862">An overview of the components that form Rhythmbox's internals is available on the <a href="/Apps/Rhythmbox/InternalDesign">Internal Design</a> page.  Some distributions ship the generated API documentation, but for those who don't have a local copy, it is available on <a class="http" href="http://library.gnome.org/devel/rhythmbox/unstable/">library.gnome.org</a> too. <span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><p class="line862">If you have any questions, please feel free to ask us in either the IRC channel (#rhythmbox on irc.gnome.org) or the mailing list ( <a class="mailto" href="mailto:rhythmbox-devel@lists.gnome.org">rhythmbox-devel@lists.gnome.org</a> ). The IRC channel is usually better, as you can have a discussion in real-time, but feel free to use the mailing list if you don't get a response - as we may be sleeping/at work/away/etc. <span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span><p class="line867">\u000a<h1 id="What_makes_up_a_plugin">What makes up a plugin</h1>\u000a<span class="anchor" id="line-17"></span><p class="line874">There are two files required for a plugin, a plugin description file (a .plugin file) and some plugin code (a .so for C, or a .py for Python). These files can potentially live in three locations, two of which are found on a user's system and one for developers. <span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><p class="line874">The first place Rhythmbox looks for plugins is in "$libdir/rhythmbox/plugins" (usually /usr/lib/rhythmbox/plugins), and this is where system-installed plugins reside. Normally only "official" plugins that are shipped with Rhythmbox itself are installed here, although other plugins can be, because it's easier to install them in the per-user plugin directory. <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><p class="line874">The second place where Rhythmbox looks is in the per-user plugin directory, $HOME/.local/share/rhythmbox/plugins. Python plugins can simply be dropped into this folder, and C plugins can be installed there. <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line874">The third location (for developers) is active if you passed "--enable-uninstalled-build" to configure, so that Rhythmbox looks in "plugins/" when running uninstalled. This is useful for C plugins, as they are built inside the source tree. <span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line867">\u000a<h2 id="The_Plugin_Description_File">The Plugin Description File</h2>\u000a<span class="anchor" id="line-26"></span><p class="line874">The plugin description file contains the metadata shown in the "Plugins" dialog and the information necessary for Rhythmbox to load your plugin. A sample file can be found in the "plugins/sample/" and "plugins/sample-python/" directories of the source. The basic format is: <span class="anchor" id="line-27"></span><span class="anchor" id="line-28"></span><p class="line867"><span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><pre><span class="anchor" id="line-1"></span>[Plugin]\u000a<span class="anchor" id="line-2"></span>Module=floonitz\u000a<span class="anchor" id="line-3"></span>IAge=2\u000a<span class="anchor" id="line-4"></span>Name=Test plugin\u000a<span class="anchor" id="line-5"></span>Description=A test plugin\u000a<span class="anchor" id="line-6"></span>Authors=Your Name &lt;your email address&gt;\u000a<span class="anchor" id="line-7"></span>Copyright=Copyright © 2007 Your name\u000a<span class="anchor" id="line-8"></span>Website=http://some.website/</pre><span class="anchor" id="line-38"></span><p class="line874">or <span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><p class="line867"><span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><pre><span class="anchor" id="line-1-1"></span>[Plugin]\u000a<span class="anchor" id="line-2-1"></span>Loader=python3\u000a<span class="anchor" id="line-3-1"></span>Module=floonitz\u000a<span class="anchor" id="line-4-1"></span>IAge=2\u000a<span class="anchor" id="line-5-1"></span>Name=Python test plugin\u000a<span class="anchor" id="line-6-1"></span>Description=A python test plugin\u000a<span class="anchor" id="line-7-1"></span>Authors=Your Name &lt;your email address&gt;\u000a<span class="anchor" id="line-8-1"></span>Copyright=Copyright © 2007 Your name\u000a<span class="anchor" id="line-9"></span>Website=http://some.website/</pre><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><p class="line867">\u000a<h3 id="Fields">Fields</h3>\u000a<span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><div><table><tbody><tr>  <td><p class="line862">Loader </td>\u000a  <td><p class="line862">The name of the plugin-loading module to use. If you are writing a C plugin, leave this out. If you are writing a Python plugin, make loader be "python3". </td>\u000a</tr>\u000a<tr>  <td><span class="anchor" id="line-55"></span><p class="line862">Module </td>\u000a  <td><p class="line862">The name of the module to load. If you are writing a C plugin, Rhythmbox will look for "module.so". If you are writing a Python plugin, Rhythmbox will look for a directory called "module" with a <tt class="backtick">__init__.py</tt> file inside, or "module.py" (the former is better). </td>\u000a</tr>\u000a<tr>  <td><span class="anchor" id="line-56"></span><p class="line862">IAge </td>\u000a  <td><p class="line862">Set to 2. </td>\u000a</tr>\u000a<tr>  <td><span class="anchor" id="line-57"></span><p class="line862">Name </td>\u000a  <td><p class="line862">The plugin will be shown as "name" in the list in the plugins dialog. </td>\u000a</tr>\u000a<tr>  <td><span class="anchor" id="line-58"></span><p class="line862">Description </td>\u000a  <td colspan="1" rowspan="4" style="text-align: left;"><p class="line862">These will all be shown in the information section of the plugins dialog when your plugin is selected. </td>\u000a</tr>\u000a<tr>  <td><span class="anchor" id="line-59"></span><p class="line862">Authors </td>\u000a</tr>\u000a<tr>  <td><span class="anchor" id="line-60"></span><p class="line862">Copyright </td>\u000a</tr>\u000a<tr>  <td><span class="anchor" id="line-61"></span><p class="line862">Website </td>\u000a</tr>\u000a</tbody></table></div><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><p class="line862">For Python plugins, best practice is to have a <tt class="backtick">__init__.py</tt> file containing your code, the .plugin file and and other files in a directory called "yourpluginname" in the per-user plugin directory. <span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><p class="line874">For C plugins, you will need to create a directory named after your plugin in the "plugins/" folder of the source tree, and then edit configure.ac and plugins/Makefile.am to add your plugin. Copying the infrastructure from one of the existing C plugins is probably a good idea. <span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><p class="line867">\u000a<h1 id="Overview_of_Rhythmbox_internals_-_pieces_of_the_puzzle">Overview of Rhythmbox internals - pieces of the puzzle</h1>\u000a<span class="anchor" id="line-69"></span><p class="line874">Rhythmbox contains a large number of pieces, which work together to provide the whole program. When first encountering Rhythmbox's internals, it is very easy to try to understand the details of everything all at once, which can become confusing. It is a much better idea to think about what you want to do, and learn about the pieces need to do that, before spreading your wings into the rest of the application. <span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><p class="line874">To further that gradual introduction, an overview of what the pieces are (so you have a general understanding of how things fit together) is provided below, followed by a more detailed explanation of the components. You should not need to follow the detailed explanations to work on a simple plugin, unless the component is relevant to what you are doing. The class names given below are the python variants, but the C versions are the same with the period removed. <span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><p class="line867">\u000a<h2 id="Top_level">Top level</h2>\u000a<span class="anchor" id="line-74"></span><p class="line874">The window you see when you use Rhythmbox is called the "shell" (the single instance of RB.Shell) and it is the glue that binds the application together. Plugins are given a reference to the shell when they start, as you can get access to basically every other useful object by starting with the shell. There are a few other single-instance objects that are accessible from the shell, such as the "removable media manager" and the "playlist manager". <span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><p class="line867">\u000a<h2 id="Sources">Sources</h2>\u000a<span class="anchor" id="line-77"></span><p class="line874">The source list in the side pane contains a list of all the instances of RB.Source, each of the sources controls the sections to the right which usually contains the track list, browsers, et al. Very few sources derive directly from RB.Source, as there are a number of classes implementing common useful functionality. <span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><p class="line862">The "track list" is an instance of the RB.<a class="nonexistent" href="/EntryView">EntryView</a> class which uses a RB.RhythmDBQueryModel as a data store to hold the list of tracks.  To get the entry view for a given source, call source.get_entry_view(). A "browser", such as the artist ones, is an instance of RB.<a class="nonexistent" href="/PropertyView">PropertyView</a> which similarly uses RB.RhythmDBPropertyModel as it's data store. To get a list of the property views for a given source, call source.get_property_views(). More on those data structures later. <span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><p class="line867">\u000a<h2 id="Lower-level_database">Lower-level database</h2>\u000a<span class="anchor" id="line-82"></span><p class="line862">Almost all of the data in Rhythmbox is stored in a database called "RhythmDB". The most important data structure in the database is the <em>entry</em> (RB.RhythmDBEntry) which represents a single track, podcast episode, podcast feed, radio station or similar item. Each entry has a set of properties with associated values, such as "title", "artist", "play count" and so one; one of these properties is special, the "location" which must be unique among all the entries in the database.  Entries are identified with an entry type (RB.RhythmDBEntryType) which defines some aspects of the entry's behaviour. <span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><p class="line867">\u000a<h2 id="Higher-level_database">Higher-level database</h2>\u000a<span class="anchor" id="line-85"></span><p class="line862">A very important higher-level structure is the "query model" mentioned above, which can be thought of as a list of tracks. There are two ways of creating and using a query model, one is to fill in the entries manually, as it done for "static" (non-automatic) playlists. The other is to give the model a <em>query</em> to process, such as "all entries of type SONG, with the title containing an 'a', sorted by artist", and the query model will take care of ensuring the list of entries is up to date and sorted correctly. <span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><p class="line874">The property model is somewhat similar, being given a query model and a property type, it will create and keep up to date a sorted list of all values of that property. For example being given a query model containing all the SONG tracks in the database and the property "artist", it will produce a list of all artists in the music library, which is what is used for the "artist browser". <span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span><p class="line867">\u000a<h1 id="Plugin_basics_-_turn_it_on.2C_turn_it_off">Plugin basics - turn it on, turn it off</h1>\u000a<span class="anchor" id="line-90"></span><p class="line862">Rhythmbox uses <a class="nonexistent" href="/Libpeas">libpeas</a> to manage its plugins.  Accordingly, all plugins must implement the libpeas Activatable interface, which provides methods that are called when the plugin is activated and deactivated.  Activation happens during startup, or when the user enables a plugin in the plugin dialog.  Deactivation happens on shutdown, or when the user disables a plugin in the plugin dialog. <span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><p class="line874">All real work, such as initialization or shutting things down, should be done in these two function, not in a constructor or finalizer. This is because the plugin object may still exist even though it has been deactivated, may be re-activated after being deactivated, and can potentially cause reference cycles if certain things aren't released in the deactivation function. <span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><p class="line874">The plugin class must have a GObject property named "object", which is how it receives a reference to the shell object (an instance of the RBShell class), through which it can access the rest of the application.   <span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><p class="line867">\u000a<h2 id="Activation">Activation</h2>\u000a<span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><p class="line874">This function usually performs such tasks as adding User Interface (UI) items, connecting signal handlers to watch for events, and the like. <span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><p class="line874">The most basic Python plugin with an activation function would be: <span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><p class="line867"><span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><pre><span class="anchor" id="line-1-2"></span>from gi.repository import GObject, RB, Peas\u000a<span class="anchor" id="line-2-2"></span>class FloonitzPlugin (GObject.Object, Peas.Activatable):\u000a<span class="anchor" id="line-3-2"></span>    object = GObject.property(type=GObject.Object)\u000a<span class="anchor" id="line-4-2"></span>\u000a<span class="anchor" id="line-5-2"></span>    def __init__(self):\u000a<span class="anchor" id="line-6-2"></span>        super(FloonitzPlugin, self).__init__()\u000a<span class="anchor" id="line-7-2"></span>\u000a<span class="anchor" id="line-8-2"></span>    def do_activate(self):\u000a<span class="anchor" id="line-9-1"></span>        print("Hello World")</pre><span class="anchor" id="line-113"></span><p class="line874">Note that if you try this, you won't actually see "Hello World" printed to standard output. Why? because print statements in python are re-directed to Rhythmbox's "debug logging" system. <span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><p class="line874">To see the output, you have two options: passing "-d" to rhythmbox from a terminal, or passing "-D filter". If you do the former, you will get all of Rhythmbox debug output printed - which almost certainly isn't what you want, as there is a lot of it. The second option filters the debug output to those lines that are emitting from a file whose pathname or function/method whose name contains "filter". If you plugin is called "floonitz", try "rhythmbox -D floonitz". <span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><p class="line862">The equivalent "simple" plugin in C is a lot longer.  See <a class="http" href="http://git.gnome.org/browse/rhythmbox/tree/sample-plugins/sample/rb-sample-plugin.c">rb-sample-plugin.c</a> in the source tree.  Most of the code should be obvious for anyone who has done some GObject C programming, with the exception of the RB_DEFINE_PLUGIN line which replaces G_DEFINE_TYPE, and using rb_debug instead of g_printf. <span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><p class="line867">\u000a<h2 id="Deactivation">Deactivation</h2>\u000a<span class="anchor" id="line-120"></span><p class="line874">Now that you've gotten your plugin activated, wouldn't you like to know how to turn it off? <span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><p class="line874">The deactivation function is fairly simple, just undo everything what you did in your activation function, or while running. If you added UI, remove it; if you connected to some signals, disconnect them; if you created any objects destroy them. Most importantly, if you stored a reference to the shell object anywhere (or use it with a signal) the reference MUST BE released. If you have a reference to the shell object past the time your plugin's deactivation signal runs, it can make Rhythmbox not exit correctly. This is even more important with Python plugins, as it will cause a cross-runtime reference cycle. <span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><p class="line874">A simple python plugin with deactivation function <span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><p class="line867"><span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><pre><span class="anchor" id="line-1-3"></span>from gi.repository import GObject, RB, Peas\u000a<span class="anchor" id="line-2-3"></span>class FloonitzPlugin (GObject.Object, Peas.Activatable):\u000a<span class="anchor" id="line-3-3"></span>    object = GObject.property(type=GObject.Object)\u000a<span class="anchor" id="line-4-3"></span>\u000a<span class="anchor" id="line-5-3"></span>    def __init__(self):\u000a<span class="anchor" id="line-6-3"></span>        super(FloonitzPlugin, self).__init__()\u000a<span class="anchor" id="line-7-3"></span>\u000a<span class="anchor" id="line-8-3"></span>    def do_activate(self):\u000a<span class="anchor" id="line-9-2"></span>        self.string = "Hello World"\u000a<span class="anchor" id="line-10"></span>        print(self.string)\u000a<span class="anchor" id="line-11"></span>\u000a<span class="anchor" id="line-12"></span>    def do_deactivate(self):\u000a<span class="anchor" id="line-13"></span>        del self.string</pre><span class="anchor" id="line-141"></span><p class="line874">The C version is left as an exercise to the reader - the deactivation function is identical to the activation function, but with the name "deactivate". <span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><p class="line867">\u000a<h2 id="Finding_your_files">Finding your files</h2>\u000a<span class="anchor" id="line-144"></span><p class="line874">Almost all non-trivial plugins have some kind of data files they use, whether UI definitions, icons, or something else - and your plugin will need some way of finding out where they are. <span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><p class="line874">The Rhythmbox core library provides a function called 'rb_find_plugin_data_file' which locates data files for a given plugin instance.  You pass it your plugin instance and a short file name, like "myfile.txt", and it will look in various places to locate it for you, and return the path to the file. <span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span><p class="line867">\u000a<h1 id="Database_essentials">Database essentials</h1>\u000a<span class="anchor" id="line-149"></span><span class="anchor" id="line-150"></span><p class="line867">\u000a<h2 id="Entries">Entries</h2>\u000a<span class="anchor" id="line-151"></span><p class="line874">Database entries have a number of properties, a few of which might not be obvious at first glance <span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><ul><li><p class="line862">LOCATION: this is the unique identifier for an entry. It doesn't have to actually exist (e.g. <a class="file" href="file://">file://</a> URIs for files or <a class="http" href="http://">http://</a> URIs for internet radio), but this will be used as the URI to play from unless you override the entry-type's get_playback_uri method. <span class="anchor" id="line-154"></span></li><li><p class="line862">DATE: this usually represents the recording date of a track, or the year that an album was released, and is stored as a Julian Date. If you just have the year, convert it with something like <tt>&nbsp;julianday&nbsp;=&nbsp;datetime.date(year,&nbsp;1,&nbsp;1).toordinal()&nbsp;</tt> <span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span></li></ul><p class="line867">\u000a<h2 id="Entry_Types">Entry Types</h2>\u000a<span class="anchor" id="line-157"></span><p class="line862">An entry type encapsulates information and behaviour common to a class of entries, and is used for things like determining what entries are shown in a RB.<a class="nonexistent" href="/BrowserSource">BrowserSource</a>. Entry types have the following settable properties: <span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><ul><li>name: this is used for entry types that are saved on disk, and for debugging purposes. It must be set to a non-NULL value <span class="anchor" id="line-160"></span></li><li>entry_type_data_size: this is the amount of extra space that is allocated to each entry, to store extra per-entry data. Currently this isn't usable from Python <span class="anchor" id="line-161"></span></li><li>save_to_disk: a flag which indicates whether the entries should be saved into the on-disk db or not. If set to true entries will persist across sessions; and should be set to false to things that are generated dynamically, such as track on removable media. <span class="anchor" id="line-162"></span></li><li>category: this is used to indicate what behaviour to use for some things, and can be set to rhythmdb.ENTYRY_NORMAL (most things), rhythmdb.ENTYRY_STREAM (endless streams like radio and last.fm), rhythmdb.ENTRY_CONTAINER (podcast feeds) or rhythmdb.ENTRY_VIRTUAL (import errors). You should use rhythmdb.ENTYRY_NORMAL or rhythmdb.ENTYRY_STREAM unless you know otherwise, the difference being that streams aren't sent to last.fm. <span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span></li></ul><p class="line874">Entry types also have a few methods: <span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><ul><li>post_entry_create: run after an entry is created, which is useful to set up things stored in the extra data area (of size entry_type_data_size), or add to mapping tabled. <span class="anchor" id="line-167"></span></li><li>pre_entry_destroy: run before an entry is destroyed, usually used to do the reverse of post_entry_create. <span class="anchor" id="line-168"></span></li><li>get_playback_uri: run when the entry is about to be played, and should return the URI to play, or NULL to indicate that it is unplayable. If there is no method set, the default is to use the LOCATION property for the playback URI. <span class="anchor" id="line-169"></span></li><li>can_sync_metadata: run to determine whether the entries metadata can be changed. If this returns false it cannot be edited, and if it returns true sync_metadata will probably be called later. <span class="anchor" id="line-170"></span></li><li>sync_metadata: run when the metadata of an entry has changed. For file-backed entries this may write the changes to disk, but if not set it will default to do nothing and just change the RB database. <span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span></li></ul><p class="line867">\u000a<h1 id="Making_your_plugin_do_something_useful">Making your plugin do something useful</h1>\u000a<span class="anchor" id="line-173"></span><p class="line867">\u000a<h2 id="Adding_UI">Adding UI</h2>\u000a<span class="anchor" id="line-174"></span><p class="line862">There are several methods of adding and removing widgets to the various parts of the Rhythmbox UI. We will explore the three most useful methods for use in a plugin. The first method uses a GTK tool called <a class="http" href="http://www.pygtk.org/docs/pygtk/class-gtkuimanager.html">UIManager</a>. This method is used to modify the menus and tool-bars. The second method is using shell.add_widget(). This method is used to add new widgets to various different areas of the main Rhythmbox UI. The other method is to add a new source page which is covered in the next section. <span class="anchor" id="line-175"></span><span class="anchor" id="line-176"></span><p class="line867">\u000a<h3 id="Adding_to_menus_and_toolbars_.28UIManager.29">Adding to menus and toolbars (UIManager)</h3>\u000a<span class="anchor" id="line-177"></span><p class="line874">UIManager uses an XML document to map a set of gtk.Actions to a location in a toolbar or menu. This file is called rhythmbox-ui.xml and resides inside the installed source tree ('data/ui/rhythmbox-ui.xml') or in your installed directory (e.g. /usr/share/rhythmbox/rhythmbox-ui.xml).The XML file is written in terms of the Action names and its structure determines a widget and location to bind to the corresponding action. The file which defines all of the Rhythmbox UI elements is /doc/ui/rhythmbox-ui.xml. You can conceptually think of each item in the UI as having a unique path which defines where it is displayed.  <span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span><p class="line874">As an example, suppose you wanted to add a new item to the Playlist submenu of the Music menu. The "path" to that location in the UI is /ui/MenuBar/MusicMenu/PlaylistMenu/NewItem <span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span><ul><li style="list-style-type:none">Thus to add a new menu item in that location, you have to build an XML document who's structure matches that of the "path". The file which corresponds to the previous path is shown in below:  <span class="anchor" id="line-182"></span></li></ul><p class="line867"><span class="anchor" id="line-183"></span><span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span><span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span><span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span><pre><span class="anchor" id="line-1-4"></span>&lt;ui&gt; \u000a<span class="anchor" id="line-2-4"></span>  &lt;menubar name="MenuBar"&gt; \u000a<span class="anchor" id="line-3-4"></span>    &lt;menu name="MusicMenu" action="Music"&gt; \u000a<span class="anchor" id="line-4-4"></span>        &lt;menu name="PlaylistMenu" action="Playlist"&gt;\u000a<span class="anchor" id="line-5-4"></span>         &lt;menuitem name="NewItem" action="NewAction"/&gt;\u000a<span class="anchor" id="line-6-4"></span>        &lt;/menu&gt;\u000a<span class="anchor" id="line-7-4"></span>    &lt;/menu&gt;\u000a<span class="anchor" id="line-8-4"></span>  &lt;/menubar&gt;\u000a<span class="anchor" id="line-9-3"></span>&lt;/ui&gt;</pre><span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><p class="line874">As mentioned earlier, the XML file describes the positioning of items but it also specifies an Action which determines the item's behavior. The Action specified can either be defined by the programmer or connected to one of the existing Actions which are defined in various locations throughout the Rhythmbox core code. Some useful core Actions are shown in below along with the files they are located in.  <span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><div><table><tbody><tr>  <td><p class="line862"> File </td>\u000a  <td><p class="line862"> Action </td>\u000a  <td><p class="line862"> Description </td>\u000a</tr>\u000a<tr>  <td><span class="anchor" id="line-197"></span><p class="line862"> /shell/rb-shell.c </td>\u000a  <td><p class="line862"> <a class="nonexistent" href="/MusicQuit">MusicQuit</a> </td>\u000a  <td><p class="line862"> Quit the music player </td>\u000a</tr>\u000a<tr>  <td><span class="anchor" id="line-198"></span><p class="line862"> </td>\u000a  <td><p class="line862"> <a class="nonexistent" href="/ViewJumpToPlaying">ViewJumpToPlaying</a> </td>\u000a  <td><p class="line862"> Scroll the view to the currently playing song </td>\u000a</tr>\u000a<tr>  <td><span class="anchor" id="line-199"></span><p class="line862"> /shell/rb-shell-player.c </td>\u000a  <td><p class="line862"> <a class="nonexistent" href="/ControlPrevious">ControlPrevious</a> </td>\u000a  <td><p class="line862"> Start playing the previous song </td>\u000a</tr>\u000a<tr>  <td><span class="anchor" id="line-200"></span><p class="line862">  </td>\u000a  <td><p class="line862"> <a class="nonexistent" href="/ControlNext">ControlNext</a> </td>\u000a  <td><p class="line862"> Start playing the next song </td>\u000a</tr>\u000a<tr>  <td><span class="anchor" id="line-201"></span><p class="line862">  </td>\u000a  <td><p class="line862"> <a class="nonexistent" href="/ControlPlay">ControlPlay</a> </td>\u000a  <td><p class="line862"> Start playback </td>\u000a</tr>\u000a<tr>  <td><span class="anchor" id="line-202"></span><p class="line862">  </td>\u000a  <td><p class="line862"> <a class="nonexistent" href="/ControlShuffle">ControlShuffle</a> </td>\u000a  <td><p class="line862"> Play songs in a random order </td>\u000a</tr>\u000a<tr>  <td><span class="anchor" id="line-203"></span><p class="line862">  </td>\u000a  <td><p class="line862"> <a class="nonexistent" href="/ControlRepeat">ControlRepeat</a> </td>\u000a  <td><p class="line862"> Play first song again after all songs are played </td>\u000a</tr>\u000a<tr>  <td><span class="anchor" id="line-204"></span><p class="line862"> /shell/rb-shell-playlist.c </td>\u000a  <td><p class="line862"> <a class="nonexistent" href="/MusicPlaylistNewPlaylist">MusicPlaylistNewPlaylist</a> </td>\u000a  <td><p class="line862"> Create a new playlist </td>\u000a</tr>\u000a<tr>  <td><span class="anchor" id="line-205"></span><p class="line862">  </td>\u000a  <td><p class="line862"> <a class="nonexistent" href="/MusicPlaylistDeletePlaylist">MusicPlaylistDeletePlaylist</a> </td>\u000a  <td><p class="line862"> Delete playlist </td>\u000a</tr>\u000a<tr>  <td><span class="anchor" id="line-206"></span><p class="line862">  </td>\u000a  <td><p class="line862"> <a class="nonexistent" href="/QueuePlaylist">QueuePlaylist</a> </td>\u000a  <td><p class="line862"> Add all tracks in this playlist to the queue </td>\u000a</tr>\u000a</tbody></table></div><span class="anchor" id="line-207"></span><span class="anchor" id="line-208"></span><p class="line874">If you do not want to use one of the predefined Action, you will have to define your own. The code below shows the procedure for creating and adding a new Action to the UIManager. The action shown corresponds to the XML layout defined in above. <span class="anchor" id="line-209"></span><span class="anchor" id="line-210"></span><p class="line867"><span class="anchor" id="line-211"></span><span class="anchor" id="line-212"></span><span class="anchor" id="line-213"></span><span class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span><span class="anchor" id="line-217"></span><span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><pre><span class="anchor" id="line-1-5"></span>action = gtk.Action ('NewAction', \u000a<span class="anchor" id="line-2-5"></span>                     _('New _Action'), \u000a<span class="anchor" id="line-3-5"></span>                     _('This is a new Action!'),\u000a<span class="anchor" id="line-4-5"></span>                     "")\u000a<span class="anchor" id="line-5-5"></span>action.connect ('activate', self.new_action, shell)\u000a<span class="anchor" id="line-6-5"></span>action_group = gtk.ActionGroup ('NewActionGroup')\u000a<span class="anchor" id="line-7-5"></span>action_group.add_action (action)\u000a<span class="anchor" id="line-8-5"></span>shell.get_ui_manager().insert_action_group (action_group)</pre><span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span><p class="line862">Once your Actions are set up, you have to merge corresponding XML layout file with the existing UI layout. Suppose the string new_menu_item held the contents of the string defining <a class="nonexistent" href="/NewAction">NewAction</a> shown above. Then the following code shows how to merge a new UI listing into the current Rhythmbox UI. This first retrieves the main Rhythmbox UIManager, and then merges the new elements described in the string new_menu_item into their proper locations.  <span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span><span class="anchor" id="line-224"></span><span class="anchor" id="line-225"></span><pre><span class="anchor" id="line-1-6"></span>ui_manager = shell.get_ui_manager()\u000a<span class="anchor" id="line-2-6"></span>ui_manager.add_ui_from_string (new_menu_item)</pre><span class="anchor" id="line-226"></span><span class="anchor" id="line-227"></span><p class="line867">\u000a<h3 id="Adding_UI_somewhere_other_than_toolbars_and_menus">Adding UI somewhere other than toolbars and menus</h3>\u000a<span class="anchor" id="line-228"></span><span class="anchor" id="line-229"></span><p class="line874">The add_widget() method is useful when you want to add a new widget somewhere other than a menu or toolbar. This method is also much easier than using UIManager, but can be somewhat inflexible. This is because there are limited areas where widgets can be added. Although the placement options are limited, the options of what type of widget you add is not. You can use this method to add anything that subclasses GTK.Widget. The method signature is add_widget (widget, area, expand=False, fill=True) <span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><p class="line874">These four areas are made available to plugins:  <span class="anchor" id="line-232"></span><ul><li>RB.ShellUILocation.MAIN_BOTTOM <span class="anchor" id="line-233"></span></li><li>RB.ShellUILocation.MAIN_TOP <span class="anchor" id="line-234"></span></li><li>RB.ShellUILocation.RIGHT_SIDEBAR <span class="anchor" id="line-235"></span></li><li>RB.ShellUILocation.SIDEBAR <span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span></li></ul><p class="line867">\u000a<h2 id="Creating_a_Source">Creating a Source</h2>\u000a<span class="anchor" id="line-238"></span><p class="line874">Creating a new source is fairly simple with Python, but before doing so you need to determine what kind of source it is. Source fall into two main groups: those that contain all the entries of a particular type (e.g. the Radio source showing all stations, and the Magnatune source showing songs from the Magnatune catalogue), and those that contain particular entries (e.g. the play queue or a static playlist). <span class="anchor" id="line-239"></span><span class="anchor" id="line-240"></span><p class="line862">For the former, Rhythmbox has a base class, called <a class="nonexistent" href="/BrowserSource">BrowserSource</a>, which takes care of much of the work and also provides things like the album/artist browsers for free. To use it, do something like the following <span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span><p class="line867"><span class="anchor" id="line-243"></span><span class="anchor" id="line-244"></span><span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span><span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><span class="anchor" id="line-249"></span><span class="anchor" id="line-250"></span><span class="anchor" id="line-251"></span><span class="anchor" id="line-252"></span><span class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span><span class="anchor" id="line-255"></span><span class="anchor" id="line-256"></span><span class="anchor" id="line-257"></span><span class="anchor" id="line-258"></span><span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span><span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span><span class="anchor" id="line-264"></span><span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><span class="anchor" id="line-267"></span><span class="anchor" id="line-268"></span><span class="anchor" id="line-269"></span><pre><span class="anchor" id="line-1-7"></span>from gi.repository import GObject, Peas, RB\u000a<span class="anchor" id="line-2-7"></span>\u000a<span class="anchor" id="line-3-6"></span>class MyPlugin (GObject.Object, Peas.Activatable):\u000a<span class="anchor" id="line-4-6"></span>    object = GObject.Property(type=GObject.Object)\u000a<span class="anchor" id="line-5-6"></span>    def __init__(self):\u000a<span class="anchor" id="line-6-6"></span>        super(MyPlugin, self).__init__()\u000a<span class="anchor" id="line-7-6"></span>\u000a<span class="anchor" id="line-8-6"></span>    def do_activate(self):\u000a<span class="anchor" id="line-9-4"></span>        print("Plugin activated")\u000a<span class="anchor" id="line-10-1"></span>        \u000a<span class="anchor" id="line-11-1"></span>        shell = self.object\u000a<span class="anchor" id="line-12-1"></span>        db = shell.props.db\u000a<span class="anchor" id="line-13-1"></span>        entry_type = MyEntryType()\u000a<span class="anchor" id="line-14"></span>        db.register_entry_type(entry_type)\u000a<span class="anchor" id="line-15"></span>        mysource = GObject.new (MySource, shell=shell, name=_("My Source"), entry_type=entry_type)\u000a<span class="anchor" id="line-16"></span>        group = RB.DisplayPageGroup.get_by_id ("shared")\u000a<span class="anchor" id="line-17"></span>        shell.append_display_page (mysource, group)\u000a<span class="anchor" id="line-18"></span>        shell.register_entry_type_for_source(mysource, entry_type)\u000a<span class="anchor" id="line-19"></span>\u000a<span class="anchor" id="line-20"></span>class MyEntryType(RB.RhythmDBEntryType):\u000a<span class="anchor" id="line-21"></span>    def __init__(self):\u000a<span class="anchor" id="line-22"></span>        RB.RhythmDBEntryType.__init__(self, name='my-entry-type')\u000a<span class="anchor" id="line-23"></span>\u000a<span class="anchor" id="line-24"></span>class MySource(RB.BrowserSource):\u000a<span class="anchor" id="line-25"></span>    def __init__(self):\u000a<span class="anchor" id="line-26"></span>        RB.BrowserSource.__init__(self)\u000a<span class="anchor" id="line-27"></span>GObject.type_register(MySource)</pre><span class="anchor" id="line-270"></span><span class="anchor" id="line-271"></span><p class="line862">which creates a new entry type for tracks, and creates a source to display them, and asks the shell to add it to the source list in the 'shared' group. Strictly, you don't need to create a new class in the above example and could used <a class="nonexistent" href="/BrowserSource">BrowserSource</a> directly, but creating a new class would be required as soon as you want to do anything "interesting" with it. <span class="anchor" id="line-272"></span><span class="anchor" id="line-273"></span><p class="line867">\u000a<h4 id="Adding_an_icon_to_your_source">Adding an icon to your source</h4>\u000a<span class="anchor" id="line-274"></span><p class="line867"><span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span><span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span><span class="anchor" id="line-279"></span><span class="anchor" id="line-280"></span><pre><span class="anchor" id="line-1-8"></span># The following code sets the correct size for your source icon,\u000a<span class="anchor" id="line-2-8"></span># finds it by its filename and adds it to a pixbuf.\u000a<span class="anchor" id="line-3-7"></span>width, height = gtk.icon_size_lookup(gtk.ICON_SIZE_LARGE_TOOLBAR)\u000a<span class="anchor" id="line-4-7"></span>icon = gtk.gdk.pixbuf_new_from_file_at_size(self.find_file("myicon.png"), width, height)\u000a<span class="anchor" id="line-5-7"></span># The following code sets the sources "icon" property to the image stored in the pixbuf created above.\u000a<span class="anchor" id="line-6-7"></span>self.mysource.set_property("pixbuf", icon)</pre><span class="anchor" id="line-281"></span><p class="line867">\u000a<h2 id="Adding_support_for_new_Removable_Media">Adding support for new Removable Media</h2>\u000a<span class="anchor" id="line-282"></span><p class="line874">TODO <span class="anchor" id="line-283"></span><span class="anchor" id="line-284"></span><p class="line867">\u000a<h2 id="Controlling_Playback">Controlling Playback</h2>\u000a<span class="anchor" id="line-285"></span><p class="line874">This is very Simple.  Each of these examples will return a True if there are no problems. Here are some examples in Python: Pauses Playback.  To restart use "play()" <span class="anchor" id="line-286"></span><span class="anchor" id="line-287"></span><p class="line867"><span class="anchor" id="line-288"></span><pre><span class="anchor" id="line-1-9"></span>shell.props.shell_player.pause()</pre><span class="anchor" id="line-289"></span><p class="line874">Speaks for itself.  Plays the current song. <span class="anchor" id="line-290"></span><span class="anchor" id="line-291"></span><p class="line867"><span class="anchor" id="line-292"></span><pre><span class="anchor" id="line-1-10"></span>shell.props.shell_player.play()</pre><span class="anchor" id="line-293"></span><p class="line874">Stops Playback.  Restarting using "play()" starts from beginning. <span class="anchor" id="line-294"></span><span class="anchor" id="line-295"></span><p class="line867"><span class="anchor" id="line-296"></span><pre><span class="anchor" id="line-1-11"></span>shell.props.shell_player.stop()</pre><span class="anchor" id="line-297"></span><p class="line874">This Toggles Playback.  If its playing it will be paused, and if its paused it will play. <span class="anchor" id="line-298"></span><span class="anchor" id="line-299"></span><p class="line867"><span class="anchor" id="line-300"></span><pre><span class="anchor" id="line-1-12"></span>shell.props.shell_player.playpause()</pre><span class="anchor" id="line-301"></span><p class="line874">To go to previous/next song, use these: <span class="anchor" id="line-302"></span><span class="anchor" id="line-303"></span><p class="line867"><span class="anchor" id="line-304"></span><span class="anchor" id="line-305"></span><pre><span class="anchor" id="line-1-13"></span>shell.props.shell_player.do_previous()\u000a<span class="anchor" id="line-2-9"></span>shell.props.shell_player.do_next() </pre><span class="anchor" id="line-306"></span><p class="line874">Add to and remove from "Play Queue".  Both take 1 argument, the songs URI. <span class="anchor" id="line-307"></span><span class="anchor" id="line-308"></span><p class="line867"><span class="anchor" id="line-309"></span><span class="anchor" id="line-310"></span><span class="anchor" id="line-311"></span><pre><span class="anchor" id="line-1-14"></span>shell.add_to_queue("file://awesome_song.ogg")\u000a<span class="anchor" id="line-2-10"></span>shell.remove_from_queue("file://awesome_song.ogg")</pre><span class="anchor" id="line-312"></span><p class="line867">\u000a<h2 id="Adding_a_new_tab_to_the_.22Song_Info.22_window">Adding a new tab to the "Song Info" window</h2>\u000a<span class="anchor" id="line-313"></span><p class="line874">The shell emits a signal whenever a song info window has been constructed, to allow plugins to add new things to it (such as the lyrics tab). To use it, do something like the following in your activate method <span class="anchor" id="line-314"></span><span class="anchor" id="line-315"></span><p class="line867"><span class="anchor" id="line-316"></span><span class="anchor" id="line-317"></span><pre><span class="anchor" id="line-1-15"></span>self.csi_id = shell.connect('create_song_info', self.create_song_info)</pre><span class="anchor" id="line-318"></span><p class="line874">the following in your deactivate method <span class="anchor" id="line-319"></span><span class="anchor" id="line-320"></span><p class="line867"><span class="anchor" id="line-321"></span><span class="anchor" id="line-322"></span><span class="anchor" id="line-323"></span><pre><span class="anchor" id="line-1-16"></span>shell.disconnect (self.csi_id)\u000a<span class="anchor" id="line-2-11"></span>del self.csi_id</pre><span class="anchor" id="line-324"></span><p class="line874">and define the create_song_info method <span class="anchor" id="line-325"></span><span class="anchor" id="line-326"></span><p class="line867"><span class="anchor" id="line-327"></span><span class="anchor" id="line-328"></span><span class="anchor" id="line-329"></span><span class="anchor" id="line-330"></span><span class="anchor" id="line-331"></span><pre><span class="anchor" id="line-1-17"></span>def create_song_info (self, shell, song_info, is_multiple):\u000a<span class="anchor" id="line-2-12"></span>    if is_multiple is False:\u000a<span class="anchor" id="line-3-8"></span>        pane = MyWidget(song_info.props.current_entry)\u000a<span class="anchor" id="line-4-8"></span>        song_info.append_page(_("My Tab"), pane)</pre><span class="anchor" id="line-332"></span><p class="line874">is_multiple will be True if the song-info window is for multiple entries, and false if it's for just one. If you're adding something to the single-entry version, you'll want to connect to the "notify::current-entry" signal, to update when the user uses the back and forwards buttons. <span class="anchor" id="line-333"></span>For multiple-entry song-info windows, use song_info.props.entry_view.get_selected_entries() to get the list of entries to process. <span class="anchor" id="line-334"></span><span class="anchor" id="line-335"></span><p class="line867">\u000a<h2 id="Perform_actions_when_a_source_is_first_selected">Perform actions when a source is first selected</h2>\u000a<span class="anchor" id="line-336"></span><p class="line874">There are many circumstances when you may want to do some work when your source is first clicked on, rather than when the plugin loads, usually when they involve connection to remote machines. Examples include downloading the catalogue from an online store and connection to DAAP shares. <span class="anchor" id="line-337"></span><span class="anchor" id="line-338"></span><p class="line862">RB.<a class="nonexistent" href="/BrowserSource">BrowserSource</a> has a virtual function called "do_selected" which lets you implement this; the function is called whenever the source is selected (i.e. clicked on). To do something when the source is first activated (and not every time), add something like the following to your source's class <span class="anchor" id="line-339"></span><span class="anchor" id="line-340"></span><p class="line867"><span class="anchor" id="line-341"></span><span class="anchor" id="line-342"></span><span class="anchor" id="line-343"></span><span class="anchor" id="line-344"></span><span class="anchor" id="line-345"></span><pre><span class="anchor" id="line-1-18"></span>def do_selected(self):\u000a<span class="anchor" id="line-2-13"></span>    if not self.activated:\u000a<span class="anchor" id="line-3-9"></span>        self.activated = True\u000a<span class="anchor" id="line-4-9"></span>        # do your stuff here</pre><span class="anchor" id="line-346"></span><p class="line867">\u000a<h1 id="Doing_things_the_right_way">Doing things the right way</h1>\u000a<span class="anchor" id="line-347"></span><p class="line874">There are some things that many usually do when programming which can either suck or cause problems, some of which are specific to Rhythmbox and some of which aren't. This includes doing synchronous IO, using threads when you don't need to, and the like. This section describes some of these, and how to do them in a better way. <span class="anchor" id="line-348"></span><span class="anchor" id="line-349"></span><p class="line867">\u000a<h2 id="Using_threads_when_you_don.27t_need_to">Using threads when you don't need to</h2>\u000a<span class="anchor" id="line-350"></span><p class="line874">There are many valid uses for threads in programming, but many people use them when they don't need to and there is a perfectly good way of doing their task without threads - usually because they don't know about the other way. The main reason is that they don't want to block the UI while they perform a long task, with the usual candidate being some IO (especially network IO) or performing a long computation. Those two cases can usually be done without threads, and the associated things like locking, watching out for race conditions and the headaches that they can introduce. If you want to do IO, use asynchronous IO instead of a thread, and if you have a long computation which is actually a small computation done many times, you can do it in an idle callback. <span class="anchor" id="line-351"></span><span class="anchor" id="line-352"></span><p class="line867">\u000a<h2 id="Using_asynchronous_IO">Using asynchronous IO</h2>\u000a<span class="anchor" id="line-353"></span><p class="line874">Synchronous IO, that is using functions which load data from somewhere and then return it, are bad because if it takes a non-trivial amount of time it will block the user interface and make Rhythmbox appear to lock up. Getting data over the network is the obvious example of this, but it it also happens with local file IO to, because it might be sitting on a NFS share, the hard disc could be busy with copying data, or a number of other things. So you should never use synchronous IO. <span class="anchor" id="line-354"></span><span class="anchor" id="line-355"></span><p class="line874">Now that I've convinced you to use asynchronous IO, the question is how to do it.  If you're doing more than just fetching URLs into memory, use GIO.  If all you want to do is retrieve a small amount of data from a remote location, the rb.Loader class may be suitable. <span class="anchor" id="line-356"></span><span class="anchor" id="line-357"></span><p class="line867"><span class="anchor" id="line-358"></span><span class="anchor" id="line-359"></span><span class="anchor" id="line-360"></span><span class="anchor" id="line-361"></span><span class="anchor" id="line-362"></span><pre><span class="anchor" id="line-1-19"></span>def mycallback(self, data):\u000a<span class="anchor" id="line-2-14"></span>        print data\u000a<span class="anchor" id="line-3-10"></span>loader = rb.Loader()\u000a<span class="anchor" id="line-4-10"></span>loader.get_url("http://www.rhythmbox.org/", self.mycallback)</pre><span class="anchor" id="line-363"></span><p class="line874">The above code retrieves the main Rhythmbox website, and prints it out. One things to note is that you can pass extra parameters to rb.Loader.get_url(), which are passed to your callback. <span class="anchor" id="line-364"></span><span class="anchor" id="line-365"></span><p class="line867">\u000a<h2 id="Streaming_IO">Streaming IO</h2>\u000a<span class="anchor" id="line-366"></span><p class="line874">TODO <span class="anchor" id="line-367"></span><span class="anchor" id="line-368"></span><p class="line867">\u000a<h2 id="Using_idle_callbacks_for_repeated_tasks">Using idle callbacks for repeated tasks</h2>\u000a<span class="anchor" id="line-369"></span><p class="line874">Many times when some code has to perform a long computation or task, it is actually a small task which is repeated many times. For example loading the track database from an iPod isn't one long task, it's the process of loading one track from the iPod DB repeated over and over. This kind of task can be reworked to use Glib's "idle callback" mechanism, which allows you do the work without blocking the user interface and without a thread. <span class="anchor" id="line-370"></span><span class="anchor" id="line-371"></span><p class="line874">Conceptually, the long task looks like this: <span class="anchor" id="line-372"></span><span class="anchor" id="line-373"></span><p class="line867"><span class="anchor" id="line-374"></span><span class="anchor" id="line-375"></span><span class="anchor" id="line-376"></span><span class="anchor" id="line-377"></span><span class="anchor" id="line-378"></span><span class="anchor" id="line-379"></span><pre><span class="anchor" id="line-1-20"></span>finished = False\u000a<span class="anchor" id="line-2-15"></span>initialise()\u000a<span class="anchor" id="line-3-11"></span>while not finished:\u000a<span class="anchor" id="line-4-11"></span>        finished = do_piece_of_work()\u000a<span class="anchor" id="line-5-8"></span>cleanup()</pre><span class="anchor" id="line-380"></span><p class="line874">which can be transformed into: <span class="anchor" id="line-381"></span><span class="anchor" id="line-382"></span><p class="line867"><span class="anchor" id="line-383"></span><span class="anchor" id="line-384"></span><span class="anchor" id="line-385"></span><span class="anchor" id="line-386"></span><span class="anchor" id="line-387"></span><span class="anchor" id="line-388"></span><span class="anchor" id="line-389"></span><span class="anchor" id="line-390"></span><span class="anchor" id="line-391"></span><pre><span class="anchor" id="line-1-21"></span>def idle_cb(self):\u000a<span class="anchor" id="line-2-16"></span>        finished = do_piece_of_work()\u000a<span class="anchor" id="line-3-12"></span>        if not finished:\u000a<span class="anchor" id="line-4-12"></span>                return True\u000a<span class="anchor" id="line-5-9"></span>        cleanup()\u000a<span class="anchor" id="line-6-8"></span>        return False\u000a<span class="anchor" id="line-7-7"></span>initialise()\u000a<span class="anchor" id="line-8-7"></span>Gdk.threads_add_idle(self.idle_cb)</pre><span class="anchor" id="line-392"></span><p class="line874">If your code looks somewhat like the first one, it should be fairly easy to re-write in the second form. Once you've done this, your plugin will be much nicer as it doesn't block the UI while doing the task. <span class="anchor" id="line-393"></span><span class="anchor" id="line-394"></span><p class="line867">\u000a<h3 id="Chunking_idle_callbacks">Chunking idle callbacks</h3>\u000a<span class="anchor" id="line-395"></span><p class="line874">If the small piece of work you're doing is actually fairly small, and repeated a large number of times, the above method can reduce performance a fair bit due to the overhead of running the idle callback that many times. The solution to this is to do more work in each callback; rather than calling do_piece_of_work() once, call it a greater number of times, i.e. <span class="anchor" id="line-396"></span><span class="anchor" id="line-397"></span><p class="line867"><span class="anchor" id="line-398"></span><span class="anchor" id="line-399"></span><span class="anchor" id="line-400"></span><span class="anchor" id="line-401"></span><span class="anchor" id="line-402"></span><span class="anchor" id="line-403"></span><span class="anchor" id="line-404"></span><span class="anchor" id="line-405"></span><span class="anchor" id="line-406"></span><span class="anchor" id="line-407"></span><span class="anchor" id="line-408"></span><span class="anchor" id="line-409"></span><span class="anchor" id="line-410"></span><pre><span class="anchor" id="line-1-22"></span>def idle_cb(self):\u000a<span class="anchor" id="line-2-17"></span>        finished = False\u000a<span class="anchor" id="line-3-13"></span>        count = 0\u000a<span class="anchor" id="line-4-13"></span>        while not finished and count &lt; SOME_NUMBER:\u000a<span class="anchor" id="line-5-10"></span>                finished = do_piece_of_work()\u000a<span class="anchor" id="line-6-9"></span>                count++\u000a<span class="anchor" id="line-7-8"></span>        if not finished:\u000a<span class="anchor" id="line-8-8"></span>                return True\u000a<span class="anchor" id="line-9-5"></span>        cleanup()\u000a<span class="anchor" id="line-10-2"></span>        return False\u000a<span class="anchor" id="line-11-2"></span>initialise()\u000a<span class="anchor" id="line-12-2"></span>Gdk.threads_add_idle(self.idle_cb)</pre><span class="anchor" id="line-411"></span><p class="line874">The choice of SOME_NUMBER is fairly important, but could be completely different depending on what you're doing - it might be 10, 100, 1000 or something else. Larger numbers will give you better performance but will block the UI for longer, a happy value will give a bit of a performance increase over 1 (what the non-chunking version is equivalent to) but not take too long even with older/busy computers. <span class="anchor" id="line-412"></span><span class="anchor" id="line-413"></span><p class="line867">\u000a<h1 id="Doing_Cool_Things.28tm.29">Doing Cool Things(tm)</h1>\u000a<span class="anchor" id="line-414"></span><p class="line867">\u000a<h2 id="Adding_elements_to_the_GStreamer_playback_pipeline">Adding elements to the GStreamer playback pipeline</h2>\u000a<span class="anchor" id="line-415"></span><p class="line874">Plugins can add elements to the GStreamer pipeline, to do interesting things with the audio. You can add "filtering" elements, which alter the audio the user hears (such as for and equalizer, or other special effects) and "tee" elements which get a copy of the audio (e.g. to send across the network, to another application, or convert to a different format). <span class="anchor" id="line-416"></span><span class="anchor" id="line-417"></span><p class="line874">In either case, what you need to do is create a GStreamer element, and then ask the playback backend to insert it. Later, either when it is finished or your plugin is being deactivated, you need to ask the playback backend to remove it. Inserted elements will transparently be moved to the correct place if the pipeline changes. If you need multiple elements to do what you want, put them in a Bin and add that. <span class="anchor" id="line-418"></span><span class="anchor" id="line-419"></span><p class="line874">You should check that the playback backend implements the functionality before trying to use it, since not all backends may implement all the different types of elements. In C, you should check the object implements the appropriate GObject interface, an in Python you should check the methods exist. <span class="anchor" id="line-420"></span><span class="anchor" id="line-421"></span><p class="line874">As an example, here is how you add a "poor mans's visualisation" using Python (it can be run in the python console). <span class="anchor" id="line-422"></span><span class="anchor" id="line-423"></span><p class="line867"><span class="anchor" id="line-424"></span><span class="anchor" id="line-425"></span><span class="anchor" id="line-426"></span><span class="anchor" id="line-427"></span><span class="anchor" id="line-428"></span><span class="anchor" id="line-429"></span><span class="anchor" id="line-430"></span><span class="anchor" id="line-431"></span><span class="anchor" id="line-432"></span><span class="anchor" id="line-433"></span><span class="anchor" id="line-434"></span><pre><span class="anchor" id="line-1-23"></span>from gi.repository import Gst\u000a<span class="anchor" id="line-2-18"></span>goom = Gst.element_factory_make ("goom")\u000a<span class="anchor" id="line-3-14"></span>sink = Gst.element_factory_make ("ximagesink")\u000a<span class="anchor" id="line-4-14"></span>colour = Gst.element_factory_make ("ffmpegcolorspace")\u000a<span class="anchor" id="line-5-11"></span>b = Gst.Bin()\u000a<span class="anchor" id="line-6-10"></span>b.add (goom, colour, sink)\u000a<span class="anchor" id="line-7-9"></span>b.add_pad(Gst.GhostPad("sink", goom.get_pad("sink")))\u000a<span class="anchor" id="line-8-9"></span>goom.link(colour)\u000a<span class="anchor" id="line-9-6"></span>colour.link(sink)\u000a<span class="anchor" id="line-10-3"></span>shell.get_player().props.player.add_tee(b)</pre><span class="anchor" id="line-435"></span><p class="line874">and remove it <span class="anchor" id="line-436"></span><span class="anchor" id="line-437"></span><p class="line867"><span class="anchor" id="line-438"></span><span class="anchor" id="line-439"></span><pre><span class="anchor" id="line-1-24"></span>shell.get_player().props.player.remove_tee(b)</pre><span class="anchor" id="line-440"></span><p class="line867">\u000a<h1 id="How_do_I_...">How do I ...</h1>\u000a<span class="anchor" id="line-441"></span><p class="line867">\u000a<h2 id="Get_the_list_of_entries_in_a_source.3F">Get the list of entries in a source?</h2>\u000a<span class="anchor" id="line-442"></span><p class="line862">Sources have a "query-model" property, which lets you access the RB.RhythmDBQueryModel (which is a Gtk.<a class="nonexistent" href="/TreeModel">TreeModel</a>) which backs the track list. You can simply iterate over the rows in the model, getting each of the entries in turn (a reference is stored in the zeroeth column). For example <span class="anchor" id="line-443"></span><span class="anchor" id="line-444"></span><p class="line867"><span class="anchor" id="line-445"></span><span class="anchor" id="line-446"></span><span class="anchor" id="line-447"></span><span class="anchor" id="line-448"></span><pre><span class="anchor" id="line-1-25"></span>for row in mysource.props.query_model:\u000a<span class="anchor" id="line-2-19"></span>        entry = row[0]\u000a<span class="anchor" id="line-3-15"></span>        print db.entry_get(entry, RB.RhythmDBPropType.PROP_TITLE)</pre><span class="anchor" id="line-449"></span><p class="line867">\u000a<h2 id="Filter_by_.27song.27_type">Filter by 'song' type</h2>\u000a<span class="anchor" id="line-450"></span><p class="line867"><span class="anchor" id="line-451"></span><span class="anchor" id="line-452"></span><span class="anchor" id="line-453"></span><span class="anchor" id="line-454"></span><span class="anchor" id="line-455"></span><span class="anchor" id="line-456"></span><span class="anchor" id="line-457"></span><span class="anchor" id="line-458"></span><span class="anchor" id="line-459"></span><span class="anchor" id="line-460"></span><span class="anchor" id="line-461"></span><span class="anchor" id="line-462"></span><pre><span class="anchor" id="line-1-26"></span>    def on_entry_added(self, _tree, entry):\u000a<span class="anchor" id="line-2-20"></span>        """\u000a<span class="anchor" id="line-3-16"></span>        'entry-added' signal handler\u000a<span class="anchor" id="line-4-15"></span>        """\u000a<span class="anchor" id="line-5-12"></span>        ### place the following in an 'init' section so\u000a<span class="anchor" id="line-6-11"></span>        ### it doesn't get repeated on each signal\u000a<span class="anchor" id="line-7-10"></span>        self.type_song=self.db.entry_type_get_by_name("song")\u000a<span class="anchor" id="line-8-10"></span>        type=entry.get_entry_type()\u000a<span class="anchor" id="line-9-7"></span>        if type==self.type_song:\u000a<span class="anchor" id="line-10-4"></span>            id=self.db.entry_get(entry, RB.RhythmDBPropType.ENTRY_ID)\u000a<span class="anchor" id="line-11-3"></span>            self.song_entries.append(int(id))</pre><span class="anchor" id="line-463"></span><span class="anchor" id="line-464"></span><p class="line867">\u000a<h2 id="Disable_a_bad_plugin_from_outside_Rhythmbox.3F">Disable a bad plugin from outside Rhythmbox?</h2>\u000a<span class="anchor" id="line-465"></span><p class="line874">If you've written a plugin that crashes Rhythmbox, instead of moving the plugin to a different directory you can disable it in GSettings. <span class="anchor" id="line-466"></span>I find that when I activate a bad plugin from inside Rhythmbox, it provides more useful output than if you have started Rhythmbox with the plugin activated. <span class="anchor" id="line-467"></span><span class="anchor" id="line-468"></span><p class="line867">\u000a<h1 id="Things_to_check_before_checking_into_git">Things to check before checking into git</h1>\u000a<span class="anchor" id="line-469"></span><ul><li>all necessary files are installed (don't just run uninstalled) <span class="anchor" id="line-470"></span></li><li>works correctly across enable/disable cycles <span class="anchor" id="line-471"></span></li><li>any plugin-specific UI is split out to a separate file in the plugin directory <span class="anchor" id="line-472"></span></li><li>copyright/license headers for all files (with a compatible license..) <span class="anchor" id="line-473"></span><span class="anchor" id="line-474"></span></li></ul><p class="line862">See also <a href="/Apps/Rhythmbox/Plugins/Python%20Plugin%20Examples">Apps/Rhythmbox/Plugins/Python Plugin Examples</a> <span class="anchor" id="line-475"></span><span class="anchor" id="bottom"></span></div><p id="pageinfo" class="info" lang="en" dir="ltr">Apps/Rhythmbox/Plugins/WritingGuide  (last edited 2015-04-12 21:47:45 by <span title="JonathanMatthew @ c110-23-13-133.rochd7.qld.optusnet.com.au[110.23.13.133]"><a href="/JonathanMatthew" title="JonathanMatthew @ c110-23-13-133.rochd7.qld.optusnet.com.au[110.23.13.133]">JonathanMatthew</a></span>)</p>\u000a\u000a<div id="pagebottom"></div>\u000a</div>\u000a\u000a\u000a\u000a  <!-- end of main content -->\u000a  </div>\u000a  <!-- site footer -->\u000a  <div id="footer">\u000a    <!-- footer image -->\u000a    <div id="footer_image">\u000a      &nbsp;\u000a    </div>\u000a    <!-- footer grass -->\u000a    <div id="footer_grass">\u000a      &nbsp;\u000a    </div>\u000a    <div id="footer_container">\u000a      <div id="footer_content">\u000a\u000a\u000a        <div id="search">\u000a\u000a<form id="searchform" method="get" action="/Apps/Rhythmbox/Plugins/WritingGuide">\u000a<div>\u000a<input type="hidden" name="action" value="fullsearch">\u000a<input type="hidden" name="context" value="180">\u000a<label for="searchinput">Search:</label>\u000a<input id="searchinput" type="text" name="value" value="" size="20"\u000a    onfocus="searchFocus(this)" onblur="searchBlur(this)"\u000a    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">\u000a<input id="titlesearch" name="titlesearch" type="submit"\u000a    value="Titles" alt="Search Titles">\u000a<input id="fullsearch" name="fullsearch" type="submit"\u000a    value="Text" alt="Search Full Text">\u000a</div>\u000a</form>\u000a<script type="text/javascript">\u000a<!--// Initialize search form\u000avar f = document.getElementById('searchform');\u000af.getElementsByTagName('label')[0].style.display = 'none';\u000avar e = document.getElementById('searchinput');\u000asearchChange(e);\u000asearchBlur(e);\u000a//-->\u000a</script>\u000a\u000a\u000a        </div>\u000a        <div id="copyright">\u000a        Copyright &copy; 2005 - <span id="current-year"></span> <a href="https://www.gnome.org/">The GNOME Project</a>.\u000a        Hosted by <a href="http://www.redhat.com/">Red Hat</a>.\u000a        </div>\u000a      </div>\u000a    </div>\u000a  </div>\u000a  <!-- End of footer -->\u000a\u000a  <script type="text/javascript">document.getElementById('current-year').innerHTML = new Date().getFullYear();</script>\u000a  </div>\u000a  <!-- End of container --></body>\u000a</html>\u000a\u000a
p3
a.