(lp0
S'http://wklken.me/posts/2013/03/25/python-tool-fabric.html'
p1
aS'Python fabric\xe5\xae\x9e\xe7\x8e\xb0\xe8\xbf\x9c\xe7\xa8\x8b\xe6\x93\x8d\xe4\xbd\x9c\xe5\x92\x8c\xe9\x83\xa8\xe7\xbd\xb2'
p2
aI0
aV<!DOCTYPE html>\u000a<html lang="en">\u000a\u000a<!--[if IE 8]> <html class="no-js lt-ie9" lang="en"> <![endif]-->\u000a<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->\u000a\u000a<head>\u000a    <meta name="google-site-verification" content="SzE6WCs23qFevgBzRIuG9vcfLU0lW_Vd5hFT-cJOLBE" />\u000a    <title>Python fabric\u5b9e\u73b0\u8fdc\u7a0b\u64cd\u4f5c\u548c\u90e8\u7f72</title>\u000a    <meta charset="utf-8" />\u000a    <meta name="description" content="">\u000a    <meta name="keywords" content="" />\u000a    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>\u000a    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">\u000a\u000a        <link rel="shortcut icon" href="/favicon.ico"/>\u000a        <link rel="stylesheet" href="/theme/css/styles.css" media="all" />\u000a        <link rel="stylesheet" href="/theme/css/monokai.css" media="all" />\u000a        <link rel="stylesheet" href="/theme/css/tab.min.css" media="all" />\u000a        <link rel="stylesheet" href="/theme/css/jquery-ui.min.css" media="all" />\u000a\u000a        <link rel="stylesheet" href="/theme/css/font-awesome.min.css">\u000a        <!--\u000a        <link rel="stylesheet" href="http://apps.bdimg.com/libs/fontawesome/4.2.0/css/font-awesome.min.css">\u000a        -->\u000a        <!--[if IE 7]>\u000a            <link rel="stylesheet" href="/theme/css/font-awesome-ie7.min.css">\u000a        <![endif]-->\u000a\u000a        <link href="/" type="application/atom+xml" rel="alternate" title="wklken's blog ATOM Feed" />\u000a        <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="wklken's blog RSS Feed" />\u000a\u000a</head>\u000a\u000a<body>\u000a    <div id="page" class="row">\u000a        <div class="large-9 large-centered columns">\u000a\u000a        <header id="header">\u000a            <div class="constraint">\u000a                <div class="o">\u000a                    <a href="/"><h1 class="banner">Wklken <span class="blue"> Building </span></h1></a>\u000a\u000a                <div class="social">\u000a                            <a href="https://github.com/wklken" target='_blank'><i class="icon-github-sign icon-2x"></i></a>\u000a                            <a href="http://weibo.com/wklken" target='_blank'><i class="icon-weibo icon-2x"></i></a>\u000a                            <a href="mailto:wklken@yeah.net"><i class="icon-envelope icon-2x"></i></a>\u000a                            <a href="http://www.wklken.me/feed.xml" target='_blank'><i class="icon-rss-sign icon-2x"></i></a>\u000a                </div>\u000a                <div class="nav">\u000a                            <a href="/">\u9996\u9875</a>\u000a                            <a href="/categories.html">\u5206\u7c7b</a>\u000a                            <a href="/archives.html">\u5f52\u6863</a>\u000a                            <a href="/pages/projects.html">\u9879\u76ee</a>\u000a                            <a href="/pages/links.html">\u53cb\u94fe</a>\u000a                            <a href="/pages/aboutme.html">\u5173\u4e8e</a>\u000a\u000a                </div>\u000a\u000a                </div>\u000a            </div>\u000a        </header><!-- /#banner -->\u000a\u000a        <section id="main">\u000a\u000a\u000a<article id="article">\u000a    <section id="header">\u000a        <!--\u000a        <div class="meta">2013\u5e7403\u670825\u65e5</div>\u000a        <h1 id="title"> Python fabric\u5b9e\u73b0\u8fdc\u7a0b\u64cd\u4f5c\u548c\u90e8\u7f72 </h1>\u000a        -->\u000a        <div class="meta"> &nbsp; </div>\u000a        <h1> Python fabric\u5b9e\u73b0\u8fdc\u7a0b\u64cd\u4f5c\u548c\u90e8\u7f72 </h1>\u000a    </section>\u000a\u000a        <section id="toc">\u000a            <div id="toc"><ul><li><a class="toc-href" href="#" title="Python fabric\u5b9e\u73b0\u8fdc\u7a0b\u64cd\u4f5c\u548c\u90e8\u7f72">Python fabric\u5b9e\u73b0\u8fdc\u7a0b\u64cd\u4f5c\u548c\u90e8\u7f72</a><ul><li><a class="toc-href" href="#fabric" title="fabric">fabric</a><ul><li><a class="toc-href" href="#_1" title="\u4f5c\u7528">\u4f5c\u7528</a></li><li><a class="toc-href" href="#_2" title="\u73af\u5883\u914d\u7f6e">\u73af\u5883\u914d\u7f6e</a></li><li><a class="toc-href" href="#hello-world" title="hello world">hello world</a></li><li><a class="toc-href" href="#_3" title="\u6267\u884c\u672c\u673a\u64cd\u4f5c">\u6267\u884c\u672c\u673a\u64cd\u4f5c</a></li><li><a class="toc-href" href="#_4" title="\u6df7\u642d\u6574\u5408\u8fdc\u7aef\u64cd\u4f5c">\u6df7\u642d\u6574\u5408\u8fdc\u7aef\u64cd\u4f5c</a></li><li><a class="toc-href" href="#_5" title="\u591a\u670d\u52a1\u5668\u6df7\u642d">\u591a\u670d\u52a1\u5668\u6df7\u642d</a></li><li><a class="toc-href" href="#_6" title="\u6269\u5c55">\u6269\u5c55</a></li></ul></li></ul></li></ul></div>\u000a        </section>\u000a    <section id="content">\u000a        <h2 id="fabric">fabric</h2>\u000a<p>title\u662f\u5f00\u53d1\uff0c\u4f46\u662f\u540c\u65f6\u8981\u5e72\u5f00\u53d1\u6d4b\u8bd5\u8fd8\u6709\u8fd0\u7ef4\u7684\u6d3b (o(\u256f\u25a1\u2570)o)</p>\u000a<p>\u8fd1\u671f\u63a5\u624b\u8d8a\u6765\u8d8a\u591a\u7684\u4e1c\u897f\uff0c\u53d1\u5e03\u548c\u8fd0\u7ef4\u7684\u5de5\u4f5c\u76f8\u5f53\u673a\u68b0\uff0c\u52a0\u4e0a\u9891\u7387\u8fd8\u86ee\u9ad8\uff0c\u5bfc\u81f4\u65f6\u95f4\u6d6a\u8d39\u8fd8\u662f\u4f18\u70b9\u591a\u3002</p>\u000a<p>\u4fee\u590dbug\u4ec0\u4e48\u7684\uff0c\u6d4b\u8bd5\uff0c\u63d0\u4ea4\u7248\u672c\u5e93(2\u5206\u949f)\uff0cssh\u5230\u6d4b\u8bd5\u73af\u5883pull\u90e8\u7f72\uff082\u5206\u949f\uff09\uff0crsync\u5230\u7ebf\u4e0a\u673a\u5668A,B,C,D,E\uff081\u5206\u949f\uff09\uff0c\u5206\u522bssh\u5230ABCDE\u4e94\u53f0\u673a\u5668\uff0c\u9010\u4e00\u91cd\u542f(8-10\u5206\u949f) =  13-15\u5206\u949f</p>\u000a<p>\u5176\u4e2d\u90c1\u95f7\u7684\u662f\uff0c\u6bcf\u6b21\u64cd\u4f5c\u90fd\u662f\u76f8\u540c\u7684\uff0c\u547d\u4ee4\u4e00\u6837\uff0c\u8981\u547d\u7684\u662f\u5728\u591a\u4e2a\u673a\u5668\u4e0a\uff0c\u5f88\u96be\u5728\u672c\u673a\u4e00\u4e2a\u811a\u672c\u641e\u5b9a\uff0c\u4e3b\u8981\u65f6\u95f4\u90fd\u6d6a\u8d39\u5728ssh\uff0c\u6572\u547d\u4ee4\u4e0a\u4e86\uff0c\u5199\u6210\u811a\u672c\uff0c\u5b8c\u5168\u53ef\u4ee5\u4e00\u952e\u6267\u884c\uff0c\u82b1\u4e24\u5206\u949f\u770b\u4e0b\u6267\u884c\u7ed3\u679c</p>\u000a<p>\u76f4\u5230\uff0c\u53d1\u73b0\u4e86fabric\u8fd9\u8d27</p>\u000a<p>\u5b98\u65b9\u6587\u6863 <a href="http://fabric.readthedocs.org/">\u5165\u53e3</a></p>\u000a<h3 id="_1">\u4f5c\u7528</h3>\u000a<p>\u5f88\u5f3a\u5927\u7684\u5de5\u5177</p>\u000a<p>\u53ef\u4ee5\u5c06\u81ea\u52a8\u5316\u90e8\u7f72\u6216\u8005\u591a\u673a\u64cd\u4f5c\u7684\u547d\u4ee4\u56fa\u5316\u5230\u4e00\u4e2a\u811a\u672c\u91cc</p>\u000a<p>\u548c\u67d0\u4e9b\u8fd0\u7ef4\u5de5\u5177\u5f88\u50cf\uff0c\u7528\u5b83\u4e3b\u8981\u662f\u56e0\u4e3a\uff0cpython&hellip;..</p>\u000a<p>\u7b80\u5355\u597d\u7528\u6613\u4e0a\u624b</p>\u000a<p>\u5f53\u7136\uff0cshell\u5404\u79cd\u547d\u4ee4\u7ec4\u5408\u8d77\u6765\u4e5f\u53ef\u4ee5\uff0c\u4e0a\u53e4\u795e\u5668\u548c\u73b0\u4ee3\u5175\u5668\u7684\u533a\u522b</p>\u000a<h3 id="_2">\u73af\u5883\u914d\u7f6e</h3>\u000a<p>\u5728\u672c\u673a\u548c\u76ee\u6807\u673a\u5668\u5b89\u88c5\u5bf9\u5e94\u5305\uff08\u6ce8\u610f\uff0c\u90fd\u8981\u6709\uff09</p>\u000a<div class="monokai"><pre><span></span>sudo easy_install fabric\u000a</pre></div>\u000a<p>\u76ee\u524d\u662f1.8\u7248\u672c</p>\u000a<p>\u5b89\u88c5\u5b8c\u540e\uff0c\u53ef\u4ee5\u67e5\u770b\u662f\u5426\u5b89\u88c5\u6210\u529f</p>\u000a<div class="monokai"><pre><span></span>[ken@~$] which fab\u000a/usr/local/bin/fab\u000a</pre></div>\u000a<p>\u88c5\u5b8c\u4e4b\u540e\uff0c\u53ef\u4ee5\u6d4f\u89c8\u4e0b<a href="http://docs.fabfile.org/en/1.8/">\u5b98\u65b9\u6587\u6863</a></p>\u000a<p>\u7136\u540e\uff0c\u53ef\u4ee5\u52a8\u624b\u4e86</p>\u000a<h3 id="hello-world">hello world</h3>\u000a<p>\u5148\u8fdb\u884c\u672c\u673a\u7b80\u5355\u64cd\u4f5c\uff0c\u6709\u4e00\u4e2a\u521d\u6b65\u8ba4\u8bc6\uff0c\u4f8b\u5b50\u6765\u6e90\u4e0e\u5b98\u7f51</p>\u000a<p>\u65b0\u5efa\u4e00\u4e2apy\u811a\u672c: fabfile.py</p>\u000a<div class="monokai"><pre><span></span><span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>\u000a    <span class="k">print</span><span class="p">(</span><span class="s2">"Hello world!"</span><span class="p">)</span>\u000a</pre></div>\u000a<p>\u547d\u4ee4\u884c\u6267\u884c\uff1a</p>\u000a<div class="monokai"><pre><span></span>[ken@~/tmp/fab$] fab hello\u000aHello world!\u000a\u000aDone.\u000a</pre></div>\u000a<p>\u6ce8\u610f\uff0c\u8fd9\u91cc\u53ef\u4ee5\u4e0d\u7528fabfile\u4f5c\u4e3a\u6587\u4ef6\u540d\uff0c\u4f46\u662f\u5728\u6267\u884c\u65f6\u9700\u6307\u5b9a\u6587\u4ef6</p>\u000a<div class="monokai"><pre><span></span>[ken@~/tmp/fab$] mv fabfile.py test.py\u000afabfile.py -&gt; test.py\u000a[ken@~/tmp/fab$] fab hello\u000a\u000aFatal error: Couldn't find any fabfiles!\u000a\u000aRemember that -f can be used to specify fabfile path, and use -h for help.\u000a\u000aAborting.\u000a[ken@~/tmp/fab$] fab -f test.py hello\u000aHello world!\u000a\u000aDone.\u000a</pre></div>\u000a<p>\u5e26\u53c2\u6570\uff1a</p>\u000a<p>\u4fee\u6539fabfile.py\u811a\u672c\uff1a</p>\u000a<div class="monokai"><pre><span></span><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>\u000a    <span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">!"</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>\u000a</pre></div>\u000a<p>\u6267\u884c</p>\u000a<div class="monokai"><pre><span></span>[ken@~/tmp/fab$] fab hello:name=age,value=20\u000aage = 20!\u000a\u000aDone.\u000a[ken@~/tmp/fab$] fab hello:age,20\u000aage = 20!\u000a\u000aDone.\u000a</pre></div>\u000a<h3 id="_3">\u6267\u884c\u672c\u673a\u64cd\u4f5c</h3>\u000a<p>\u7b80\u5355\u7684\u672c\u5730\u64cd\u4f5c:</p>\u000a<div class="monokai"><pre><span></span><span class="kn">from</span> <span class="nn">fabric.api</span> <span class="kn">import</span> <span class="n">local</span><span class="p">,</span> <span class="n">lcd</span>\u000a\u000a<span class="k">def</span> <span class="nf">lsfab</span><span class="p">():</span>\u000a    <span class="k">with</span> <span class="n">lcd</span><span class="p">(</span><span class="s1">'~/tmp/fab'</span><span class="p">):</span>\u000a        <span class="n">local</span><span class="p">(</span><span class="s1">'ls'</span><span class="p">)</span>\u000a</pre></div>\u000a<p>\u7ed3\u679c\uff1a</p>\u000a<div class="monokai"><pre><span></span>[ken@~/tmp/fab$] pwd;ls\u000a/Users/ken/tmp/fab\u000afabfile.py   fabfile.pyc  test.py      test.pyc\u000a[ken@~/tmp/fab$] fab -f test.py lsfab\u000a[localhost] local: cd ~/tmp/fab\u000a[localhost] local: ls\u000afabfile.py  fabfile.pyc test.py     test.pyc\u000a\u000aDone.\u000a</pre></div>\u000a<p>\u5b9e\u6218\u5f00\u59cb\uff1a</p>\u000a<p>\u5047\u8bbe\uff0c\u4f60\u6bcf\u5929\u8981\u63d0\u4ea4\u4e00\u4efd\u914d\u7f6e\u6587\u4ef6settings.py\u5230\u7248\u672c\u5e93\uff08\u8fd9\u91cc\u6ca1\u6709\u8003\u8651\u51b2\u7a81\u7684\u60c5\u51b5\uff09</p>\u000a<p>\u5982\u679c\u662f\u624b\u5de5\u64cd\u4f5c\uff1a</p>\u000a<div class="monokai"><pre><span></span>cd /home/project/test/conf/\u000agit add settings.py\u000agit commit -m 'daily update settings.py'\u000agit pull origin\u000agit push origin\u000a</pre></div>\u000a<p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u51e0\u4e2a\u547d\u4ee4\u4f60\u6bcf\u5929\u90fd\u8981\u624b\u52a8\u6572\u4e00\u6b21\uff0c\u6240\u8c13daily job\uff0c\u5c31\u662f\u6bcf\u5929\u90fd\u8981\u91cd\u590d\u7684\uff0c\u673a\u68b0\u5316\u7684\u5de5\u4f5c\uff0c\u8ba9\u6211\u4eec\u770b\u770b\u7528fabric\u600e\u4e48\u5b9e\u73b0\u4e00\u952e\u641e\u5b9a\uff1a(\u5176\u5b9e\u7528shell\u811a\u672c\u53ef\u4ee5\u76f4\u63a5\u641e\u5b9a\uff0c\u4f46\u662ffab\u7684\u4f18\u52bf\u4e0d\u662f\u5728\u8fd9\u91cc\uff0c\u8fd9\u91cc\u4e3b\u8981\u4f4d\u540e\u9762\u672c\u5730+\u8fdc\u7aef\u64cd\u4f5c\u505a\u51c6\u5907\uff0c\u6bd5\u7adf\u4e24\u4e2a\u5730\u65b9\u7684\u64cd\u4f5c\u5199\u4e00\u79cd\u811a\u672c\u4fbf\u4e8e\u7ef4\u62a4)</p>\u000a<div class="monokai"><pre><span></span><span class="kn">from</span> <span class="nn">fabric.api</span> <span class="kn">import</span> <span class="n">local</span><span class="p">,</span> <span class="n">lcd</span>\u000a\u000a<span class="k">def</span> <span class="nf">setting_ci</span><span class="p">():</span>\u000a    <span class="k">with</span> <span class="n">lcd</span><span class="p">(</span><span class="s1">'/home/project/test/conf/'</span><span class="p">):</span>\u000a        <span class="n">local</span><span class="p">(</span><span class="s2">"git add settings.py"</span><span class="p">)</span>\u000a        <span class="c1">#\u540e\u9762\u4f60\u61c2\u7684\uff0c\u61d2\u5f97\u6572\u4e86&hellip;..</span>\u000a</pre></div>\u000a<h3 id="_4">\u6df7\u642d\u6574\u5408\u8fdc\u7aef\u64cd\u4f5c</h3>\u000a<p>\u8fd9\u65f6\u5019\uff0c\u5047\u8bbe\uff0c\u4f60\u8981\u5230\u673a\u5668A\u7684/home/ken/project\u5bf9\u5e94\u9879\u76ee\u76ee\u5f55\u628a\u914d\u7f6e\u6587\u4ef6\u66f4\u65b0\u4e0b\u6765</p>\u000a<div class="monokai"><pre><span></span><span class="ch">#!/usr/bin/env python</span>\u000a<span class="c1"># encoding: utf-8</span>\u000a\u000a<span class="kn">from</span> <span class="nn">fabric.api</span> <span class="kn">import</span> <span class="n">local</span><span class="p">,</span><span class="n">cd</span><span class="p">,</span><span class="n">run</span><span class="p">,</span> <span class="n">env</span>\u000a\u000a<span class="n">env</span><span class="o">.</span><span class="n">hosts</span><span class="o">=</span><span class="p">[</span><span class="s1">'user@ip:port'</span><span class="p">,]</span> <span class="c1">#ssh\u8981\u7528\u5230\u7684\u53c2\u6570</span>\u000a<span class="n">env</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="s1">'pwd'</span>\u000a\u000a\u000a<span class="k">def</span> <span class="nf">setting_ci</span><span class="p">():</span>\u000a    <span class="n">local</span><span class="p">(</span><span class="s1">'echo "add and commit settings in local"'</span><span class="p">)</span>\u000a    <span class="c1">#\u521a\u624d\u7684\u64cd\u4f5c\u6362\u5230\u8fd9\u91cc\uff0c\u4f60\u61c2\u7684</span>\u000a\u000a<span class="k">def</span> <span class="nf">update_setting_remote</span><span class="p">():</span>\u000a    <span class="k">print</span> <span class="s2">"remote update"</span>\u000a    <span class="k">with</span> <span class="n">cd</span><span class="p">(</span><span class="s1">'~/temp'</span><span class="p">):</span>   <span class="c1">#cd\u7528\u4e8e\u8fdb\u5165\u67d0\u4e2a\u76ee\u5f55</span>\u000a        <span class="n">run</span><span class="p">(</span><span class="s1">'ls -l | wc -l'</span><span class="p">)</span>  <span class="c1">#\u8fdc\u7a0b\u64cd\u4f5c\u7528run</span>\u000a\u000a<span class="k">def</span> <span class="nf">update</span><span class="p">():</span>\u000a    <span class="n">setting_ci</span><span class="p">()</span>\u000a    <span class="n">update_setting_remote</span><span class="p">()</span>\u000a</pre></div>\u000a<p>\u7136\u540e\uff0c\u6267\u884c\u4e4b\uff1a</p>\u000a<div class="monokai"><pre><span></span>[ken@~/tmp/fab$] fab -f deploy.py update\u000a[user@ip:port] Executing task 'update'\u000a[localhost] local: echo "add and commit settings in local"\u000aadd and commit settings in local\u000aremote update\u000a[user@ip:port] run: ls -l | wc -l\u000a[user@ip:port] out: 12\u000a[user@ip:port] out:\u000a\u000a\u000aDone.\u000a</pre></div>\u000a<p>\u6ce8\u610f\uff0c\u5982\u679c\u4e0d\u58f0\u660eenv.password\uff0c\u6267\u884c\u5230\u5bf9\u5e94\u673a\u5668\u65f6\u4f1a\u8df3\u51fa\u8981\u6c42\u8f93\u5165\u5bc6\u7801\u7684\u4ea4\u4e92</p>\u000a<h3 id="_5">\u591a\u670d\u52a1\u5668\u6df7\u642d</h3>\u000a<p>\u64cd\u4f5c\u591a\u4e2a\u670d\u52a1\u5668\uff0c\u9700\u8981\u914d\u7f6e\u591a\u4e2ahost</p>\u000a<div class="monokai"><pre><span></span><span class="ch">#!/usr/bin/env python</span>\u000a<span class="c1"># encoding: utf-8</span>\u000a\u000a<span class="kn">from</span> <span class="nn">fabric.api</span> <span class="kn">import</span> <span class="o">*</span>\u000a\u000a<span class="c1">#\u64cd\u4f5c\u4e00\u81f4\u7684\u670d\u52a1\u5668\u53ef\u4ee5\u653e\u5728\u4e00\u7ec4\uff0c\u540c\u4e00\u7ec4\u7684\u6267\u884c\u540c\u4e00\u5957\u64cd\u4f5c</span>\u000a<span class="n">env</span><span class="o">.</span><span class="n">roledefs</span> <span class="o">=</span> <span class="p">{</span>\u000a            <span class="s1">'testserver'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'user1@host1:port1'</span><span class="p">,],</span>\u000a            <span class="s1">'realserver'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'user2@host2:port2'</span><span class="p">,</span> <span class="p">]</span>\u000a            <span class="p">}</span>\u000a\u000a<span class="c1">#env.password = '\u8fd9\u91cc\u4e0d\u8981\u7528\u8fd9\u79cd\u914d\u7f6e\u4e86\uff0c\u4e0d\u53ef\u80fd\u8981\u6c42\u5bc6\u7801\u90fd\u4e00\u81f4\u7684\uff0c\u660e\u6587\u7f16\u5199\u4e5f\u4e0d\u5408\u9002\u3002\u6253\u901a\u6240\u6709ssh\u5c31\u884c\u4e86'</span>\u000a\u000a<span class="nd">@roles</span><span class="p">(</span><span class="s1">'testserver'</span><span class="p">)</span>\u000a<span class="k">def</span> <span class="nf">task1</span><span class="p">():</span>\u000a    <span class="n">run</span><span class="p">(</span><span class="s1">'ls -l | wc -l'</span><span class="p">)</span>\u000a\u000a<span class="nd">@roles</span><span class="p">(</span><span class="s1">'realserver'</span><span class="p">)</span>\u000a<span class="k">def</span> <span class="nf">task2</span><span class="p">():</span>\u000a    <span class="n">run</span><span class="p">(</span><span class="s1">'ls ~/temp/ | wc -l'</span><span class="p">)</span>\u000a\u000a<span class="k">def</span> <span class="nf">dotask</span><span class="p">():</span>\u000a    <span class="n">execute</span><span class="p">(</span><span class="n">task1</span><span class="p">)</span>\u000a    <span class="n">execute</span><span class="p">(</span><span class="n">task2</span><span class="p">)</span>\u000a</pre></div>\u000a<p>\u7ed3\u679c\uff1a</p>\u000a<div class="monokai"><pre><span></span>[ken@~/tmp/fab$] fab -f mult.py dotask\u000a[user1@host1:port1] Executing task 'task1'\u000a[user1@host1:port1] run: ls -l | wc -l\u000a[user1@host1:port1] out: 9\u000a[user1@host1:port1] out:\u000a\u000a[user2@host2:port2] Executing task 'task2'\u000a[user2@host2:port2] run: ls ~/temp/ | wc -l\u000a[user2@host2:port2] out: 11\u000a[user2@host2:port2] out:\u000a\u000a\u000aDone.\u000a</pre></div>\u000a<h3 id="_6">\u6269\u5c55</h3>\u000a<p>1.\u989c\u8272</p>\u000a<p>\u53ef\u4ee5\u6253\u5370\u989c\u8272\uff0c\u5728\u67e5\u770b\u64cd\u4f5c\u7ed3\u679c\u4fe1\u606f\u7684\u65f6\u5019\u66f4\u4e3a\u9192\u76ee\u548c\u65b9\u4fbf</p>\u000a<div class="monokai"><pre><span></span><span class="kn">from</span> <span class="nn">fabric.colors</span> <span class="kn">import</span> <span class="o">*</span>\u000a\u000a<span class="k">def</span> <span class="nf">show</span><span class="p">():</span>\u000a    <span class="k">print</span> <span class="n">green</span><span class="p">(</span><span class="s1">'success'</span><span class="p">)</span>\u000a    <span class="k">print</span> <span class="n">red</span><span class="p">(</span><span class="s1">'fail'</span><span class="p">)</span>\u000a    <span class="k">print</span> <span class="n">yellow</span><span class="p">(</span><span class="s1">'yellow'</span><span class="p">)</span>\u000a<span class="c1">#fab -f color.py show</span>\u000a</pre></div>\u000a<p>2.\u9519\u8bef\u548c\u5f02\u5e38</p>\u000a<p>\u5173\u4e8e<a href="http://docs.fabfile.org/en/1.6/usage/execution.html#failures">\u9519\u8bef\u5904\u7406</a></p>\u000a<p>\u9ed8\u8ba4\uff0c\u4e00\u7ec4\u547d\u4ee4\uff0c\u4e0a\u4e00\u4e2a\u547d\u4ee4\u6267\u884c\u5931\u8d25\u540e\uff0c\u4e0d\u4f1a\u63a5\u7740\u5f80\u4e0b\u6267\u884c</p>\u000a<p>\u5931\u8d25\u540e\u4e5f\u53ef\u4ee5\u8fdb\u884c\u4e0d\u4e00\u6837\u7684\u5904\u7406\uff0c <a href="http://docs.fabfile.org/en/1.6/tutorial.html#failure-handling">\u6587\u6863</a></p>\u000a<p>\u76ee\u524d\u6ca1\u7528\u5230\uff0c\u540e\u7eed\u7528\u5230\u518d\u770b\u4e86</p>\u000a<p>3.\u5bc6\u7801\u7ba1\u7406</p>\u000a<p>\u770b<a href="http://docs.fabfile.org/en/1.6/usage/execution.html#password-management">\u6587\u6863</a></p>\u000a<p>\u66f4\u597d\u7684\u5bc6\u7801\u7ba1\u7406\u65b9\u5f0f\uff0c\u54e5\u6bd4\u8f83\u571f\uff0c\u6ca1\u6253\u901a\uff0c\u4e3b\u8981\u662f\u670d\u52a1\u5668\u5217\u8868\u53d8\u5316\u9891\u7e41\uff0c\u6211\u7684\u5904\u7406\u65b9\u5f0f\u662f\uff1a</p>\u000a<p>3.1 host,user,port,password\u914d\u7f6e\u5217\u8868\uff0c\u6240\u6709\u7684\u90fd\u5199\u5728\u4e00\u4e2a\u6587\u4ef6</p>\u000a<p>\u6216\u8005\u76f4\u63a5\u641e\u5230\u811a\u672c\u91cc\uff0c\u5f53\u7136\u8fd9\u4e2a\u66f4........</p>\u000a<div class="monokai"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">hosts</span> <span class="o">=</span> <span class="p">[</span>\u000a        <span class="s1">'host1'</span><span class="p">,</span>\u000a        <span class="s1">'host2'</span>\u000a<span class="p">]</span>\u000a<span class="c1"># \u6ce8\u610f: \u8981\u4f7fenv.passwords\u751f\u6548, host\u683c\u5f0f\u5fc5\u987b\u662f  user@ip:port \u7aef\u53e3\u53f7\u4e00\u5b9a\u8981\u663e\u5f0f\u5199\u51fa\u6765,\u5373\u4f7f\u662f\u4f7f\u7528\u7684\u9ed8\u8ba422\u7aef\u53e3</span>\u000a<span class="n">env</span><span class="o">.</span><span class="n">passwords</span> <span class="o">=</span> <span class="p">{</span>\u000a    <span class="s1">'host1'</span><span class="p">:</span> <span class="s2">"pwdofhost1"</span><span class="p">,</span>\u000a    <span class="s1">'host2'</span><span class="p">:</span> <span class="s2">"pwdofhost2"</span><span class="p">,</span>\u000a<span class="p">}</span>\u000a\u000a<span class="err">\u6216\u8005</span>\u000a<span class="n">env</span><span class="o">.</span><span class="n">roledefs</span> <span class="o">=</span> <span class="p">{</span>\u000a<span class="s1">'testserver'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'host1:22'</span><span class="p">,</span> <span class="s1">'host2:22'</span><span class="p">],</span>\u000a<span class="s1">'realserver'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'host3:22'</span><span class="p">,</span> <span class="p">]</span>\u000a<span class="p">}</span>\u000a<span class="c1"># \u6ce8\u610f: \u8981\u4f7fenv.passwords\u751f\u6548, host\u683c\u5f0f\u5fc5\u987b\u662f  user@ip:port \u7aef\u53e3\u53f7\u4e00\u5b9a\u8981\u663e\u5f0f\u5199\u51fa\u6765,\u5373\u4f7f\u662f\u4f7f\u7528\u7684\u9ed8\u8ba422\u7aef\u53e3</span>\u000a<span class="n">env</span><span class="o">.</span><span class="n">passwords</span> <span class="o">=</span> <span class="p">{</span>\u000a    <span class="s1">'host1:22'</span><span class="p">:</span> <span class="s2">"pwdofhost1"</span><span class="p">,</span>\u000a    <span class="s1">'host2:22'</span><span class="p">:</span> <span class="s2">"pwdofhost2"</span><span class="p">,</span>\u000a    <span class="s1">'host3:22'</span><span class="p">:</span> <span class="s2">"pwdofhost3"</span><span class="p">,</span>\u000a<span class="p">}</span>\u000a</pre></div>\u000a<p>3.2 \u6839\u636ekey\u89e3\u6790\u6210map\u5d4c\u5957\uff0c\u653e\u5230deploy\u4e2d</p>\u000a<p>\u53e6\u5916\u547d\u4ee4\u5176\u5b9e\u4e5f\u53ef\u4ee5\u56fa\u5316\u6210\u4e00\u4e2acmds\u5217\u8868\u7684&hellip;..</p>\u000a<p>\u7c97\u7565\u5c31\u7528\u5230\u8fd9\u4e9b\uff0c\u540e\u7eed\u6709\u66f4\u591a\u9700\u6c42\u7684\u65f6\u5019\u518d\u53bb\u635e\u6587\u6863\u4e86\uff0c\u8bdd\u8bf4\u6587\u6863\u91cc\u597d\u4e1c\u897f\u771f\u591a\uff0c\u5c31\u662f\u592a\u591a\u4e86\uff0c\u770b\u4e86\u6655\u3002\u3002\u3002</p>\u000a<p>TODO:</p>\u000a<div class="monokai"><pre><span></span>\u88c5\u9970\u5668\u4f5c\u7528\uff1f\u000a@task\u000a@parallel\u000a\u000a\u547d\u4ee4\u884c\u5e38\u7528\uff1a fab --help\u000afab -l             -- \u663e\u793a\u53ef\u7528\u7684task\uff08\u547d\u4ee4\uff09\u000afab -H             -- \u6307\u5b9ahost\uff0c\u652f\u6301\u591ahost\u9017\u53f7\u5206\u5f00\u000afab -R             -- \u6307\u5b9arole\uff0c\u652f\u6301\u591a\u4e2a\u000afab -P             -- \u5e76\u53d1\u6570\uff0c\u9ed8\u8ba4\u662f\u4e32\u884c\u000afab -w             -- warn_only\uff0c\u9ed8\u8ba4\u662f\u78b0\u5230\u5f02\u5e38\u76f4\u63a5abort\u9000\u51fa\u000afab -f             -- \u6307\u5b9a\u5165\u53e3\u6587\u4ef6\uff0cfab\u9ed8\u8ba4\u5165\u53e3\u6587\u4ef6\u662f\uff1afabfile/fabfile.py\u000a\u000a\u72b6\u6001\u786e\u8ba4\u53ca\u9519\u8bef\u5904\u7406\u000a\u000a\u66f4\u590d\u6742\u7684\u64cd\u4f5c\u000a</pre></div>\u000a<hr/>\u000a<p>update log</p>\u000a<div class="monokai"><pre><span></span>2014-10-26 fix error of local/lcd\u000a</pre></div>\u000a<hr/>\u000a<p>The end!</p>\u000a<p>To be continue&hellip;.</p>\u000a<p>wklken</p>\u000a<p>Email: wklken@yeah.net</p>\u000a<p>Blog:  http://www.wklken.com</p>\u000a<p>2013-03-25</p>\u000a<p>\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\uff0c\u8c22\u8c22</p>\u000a    </section>\u000a\u000a    <section id="copyright">\u000a        <div class="copyright">\u000a            \u7248\u6743\u58f0\u660e\uff1a\u81ea\u7531\u8f6c\u8f7d-\u975e\u5546\u7528-\u975e\u884d\u751f-\u4fdd\u6301\u7f72\u540d | <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank" >Creative Commons BY-NC-ND 3.0</a>\u000a        </div>\u000a\u000a        <div class="donation">\u000a            <center>\u000a                <div style="width: 70%;">\u000a                    <img src="/imgs/life/donation_w.png" style=""/>\u000a                    <strong>\u000a                        <div style="text-align:center;">\u000a                            \u5982\u679c\u6211\u7684\u6587\u7ae0\u6216\u9879\u76ee\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9, \u53ef\u4ee5\u626b\u7801\u8fdb\u884c\u5c0f\u989d\u6350\u8d60<br>\u000a                            \u5982\u679c\u6709\u4e3b\u673a\u9700\u6c42, \u53ef\u70b9\u4e0b\u65b9vultr\u8fdb\u5165\u6ce8\u518c, \u5e26\u5c0f\u5c3e\u5df4:)<br>\u000a                            \u5982\u679c\u8981\u52a0\u5e7f\u544a\u4f4d, \u8bf7\u90ae\u4ef6\u8054\u7cfb<br>\u000a                        </ol>\u000a                    </strong>\u000a                </div>\u000a            </center>\u000a\u000a        </div>\u000a    </section>\u000a\u000a\u000a    <section id="neighbors">\u000a        <div>\u000a                        <a class="left" href="http://www.wklken.me/posts/2013/03/16/python-base-builtins.html">\u000a                            \u4e0a\u4e00\u7bc7:  Python-\u57fa\u7840-\u5185\u7f6e\u51fd\u6570\u5c0f\u7ed3\u000a                        </a>\u000a                        <a class="right" href="http://www.wklken.me/posts/2013/05/17/shell-cheat-sheet.html">\u000a                            \u4e0b\u4e00\u7bc7: shell\u4e0b\u5c0f\u6284\u901f\u67e5\u5de5\u5177cmdcheatsheet[python\u5b9e\u73b0]\u000a                        </a>\u000a        </div>\u000a    </section>\u000a\u000a    <section id="ad">\u000a        <!-- <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> -->\u000a        <!-- [> blog_ad_003 <] -->\u000a        <!-- <ins class="adsbygoogle" -->\u000a            <!-- style="display:block" -->\u000a            <!-- data-ad-client="ca-pub-7635941258020589" -->\u000a            <!-- data-ad-slot="7030416955" -->\u000a            <!-- data-ad-format="auto"></ins> -->\u000a        <!-- <script> -->\u000a        <!-- (adsbygoogle = window.adsbygoogle || []).push({}); -->\u000a        <!-- </script> -->\u000a\u000a        <a href='http://www.vultr.com/?ref=6847203' target="_blank">\u000a        <img src="/imgs/ads/vultr.png"> </img>\u000a        </a>\u000a    </section>\u000a\u000a\u000a\u000a<section id="comments">\u000a        <div class="comments">\u000a            <div id="disqus_thread"></div>\u000a            <script type="text/javascript">\u000a                var disqus_identifier = "posts/2013/03/25/python-tool-fabric.html";\u000a                (function() {\u000a                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;\u000a                dsq.src = 'http://wklken.disqus.com/embed.js';\u000a                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);\u000a                })();\u000a            </script>\u000a            </div>\u000a</section>\u000a\u000a\u000a\u000a</article>\u000a        </section><!--end #main-->\u000a\u000a            <footer class="row">\u000a                <div class="large-12 columns">\u000a                    <p>\u000a                            Copyright © 2015 wklken <br>\u000a                            Hosted on <a href="http://www.vultr.com/?ref=6954153-3B"> vultr </a>. Powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Social Icons by <a href="http://fortawesome.github.io/Font-Awesome/">Font-Awesome</a>.\u000a                            <!-- Hosted on <a href="http://www.vultr.com/?ref=6847203"> vultr </a> Also <a href="https://www.digitalocean.com/?refcode=8ee73f2c47ce"> DigitalOcean </a>. Powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Social Icons by <a href="http://fortawesome.github.io/Font-Awesome/">Font-Awesome</a>. -->\u000a                    </p>\u000a                </div>\u000a            </footer>\u000a\u000a            </div>\u000a        </div>\u000a\u000a        <section id="extras" class="body">\u000a        </section><!-- /#extras -->\u000a\u000a\u000a\u000a<script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>\u000a<script src="http://apps.bdimg.com/libs/jquery-scrollUp/2.1.0/jquery.scrollUp.min.js"></script>\u000a<script src="http://apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>\u000a<script>\u000a    $(function(){\u000a        $.scrollUp({\u000a              scrollText: '', // Text for element, can contain HTML\u000a            });\u000a    });\u000a</script>\u000a\u000a\u000a<script type="text/javascript">\u000a  /* var Swiftype = window.Swiftype || {}; */\u000a  /* Swiftype.searchSearchFields = { */\u000a    /* "page": ["title^10", "body"] */\u000a  /* }; */\u000a\u000a  /* (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){ */\u000a  /* (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t); */\u000a  /* e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e); */\u000a  /* })(window,document,'script','//s.swiftypecdn.com/install/v1/st.js','_st'); */\u000a\u000a  /* _st('install','v6K-_DamCeHvwX6z3o2F'); */\u000a</script>\u000a\u000a\u000a\u000a    <script type="text/javascript">\u000a    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");\u000a    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));\u000a    </script>\u000a    <script type="text/javascript">\u000a    try {\u000a        var pageTracker = _gat._getTracker("UA-42275748-1");\u000a    pageTracker._trackPageview();\u000a    } catch(err) {}</script>\u000a\u000a\u000a\u000a\u000a<div id="share">\u000a<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":["mshare","tsina","weixin","douban","meilishuo","mogujie","youdao","sdo","mail","twi","copy","print"],"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"5","bdPos":"right","bdTop":"96.5"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>\u000a</div>\u000a\u000a\u000a\u000a<script  src="http://www.wklken.me/theme/js/scroll-header.js" type="text/javascript"></script>\u000a\u000a\u000a\u000a\u000a</body>\u000a</html>
p3
a.