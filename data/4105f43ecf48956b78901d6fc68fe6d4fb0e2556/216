(lp0
S'https://cwiki.apache.org/confluence/display/SPARK/PySpark+Internals'
p1
aS'PySpark Internals - Spark - Apache Software Foundation'
p2
aI0
aV<!DOCTYPE html>\u000a<html>\u000a<head>\u000a    <title>PySpark Internals - Spark - Apache Software Foundation</title>\u000a\u000a        \u000a\u000a                        \u000a    \u000a                        \u000a    \u000a                        \u000a    \u000a\u000a    <meta http-equiv="X-UA-Compatible" content="IE=EDGE,chrome=IE7">\u000a<meta charset="UTF-8">\u000a<meta id="confluence-context-path" name="confluence-context-path" content="/confluence">\u000a<meta id="confluence-base-url" name="confluence-base-url" content="https://cwiki.apache.org/confluence">\u000a\u000a<meta id="atlassian-token" name="atlassian-token" content="bbfbe3688a119472b93f15e2bb51e9e1a4890f34">\u000a\u000a\u000a<meta id="confluence-space-key" name="confluence-space-key" content="SPARK">\u000a<script type="text/javascript">\u000a        var contextPath = '/confluence';\u000a</script>\u000a\u000a    \u000a\u000a    <meta name="confluence-request-time" content="1482320130936">\u000a        \u000a    \u000a        \u000a            <meta name="ajs-is-space-admin" content=""> <meta name="ajs-has-space-config" content="">\u000a            <meta name="ajs-use-keyboard-shortcuts" content="true">\u000a            <meta name="ajs-discovered-plugin-features" content="$discoveredList">\u000a            <meta name="stp-license-product-name" content="Confluence"/> <meta name="stp-license-days-to-expiry" content="126"/> <meta name="stp-license-is-admin" content="false"/> <meta name="stp-license-should-keep-banner-hidden" content="true"/>\u000a            <meta name="ajs-keyboardshortcut-hash" content="74156a8ddf18f51f7fadc228db8013dc">\u000a            <meta name="ajs-is-confluence-admin" content="false">\u000a            <meta name="ajs-connection-timeout" content="10000">\u000a            <meta name="gliffy-license-type" content="LicenseType&lt;COMMUNITY&gt;">\u000a<meta name="gliffy-license-quantity" content="${pluginLicenseManager.userCount}">\u000a\u000a            <script type="text/x-template" title="gliffy-webpanel-footer">\u000a        <div class="gliffy-webpanel-footer"><span>This Confluence installation runs a Free Gliffy License - Evaluate the <a href="http://www.gliffy.com/products/confluence-plugin/">Gliffy Confluence Plugin</a> for your Wiki!</span></div>\u000a</script>\u000a\u000a\u000a            \u000a    \u000a    \u000a            <meta name="ajs-page-id" content="34837410">\u000a            <meta name="ajs-latest-page-id" content="34837410">\u000a            <meta name="ajs-content-type" content="page">\u000a            <meta name="ajs-page-title" content="PySpark Internals">\u000a            <meta name="ajs-parent-page-title" content="Spark Internals">\u000a            <meta name="ajs-parent-page-id" content="34837371">\u000a            <meta name="ajs-space-key" content="SPARK">\u000a            <meta name="ajs-space-name" content="Spark">\u000a            <meta name="ajs-from-page-title" content="">\u000a            <meta name="ajs-can-remove-page" content="false">\u000a            <meta name="ajs-context-path" content="/confluence">\u000a            <meta name="ajs-base-url" content="https://cwiki.apache.org/confluence">\u000a            <meta name="ajs-version-number" content="5.8.4">\u000a            <meta name="ajs-build-number" content="5982">\u000a            <meta name="ajs-remote-user" content="">\u000a            <meta name="ajs-remote-user-key" content="">\u000a            <meta name="ajs-current-user-fullname" content="">\u000a            <meta name="ajs-current-user-avatar-url" content="">\u000a            <meta name="ajs-static-resource-url-prefix" content="/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_">\u000a            <meta name="ajs-global-settings-attachment-max-size" content="20971520">\u000a            <meta name="ajs-user-locale" content="en_GB">\u000a            <meta name="ajs-enabled-dark-features" content="confluence-inline-comments-resolved,notification.plugin.api.enabled.com.atlassian.confluence.plugins.sharepage.api.ShareContentEvent,notification.plugin.api.enabled.com.atlassian.confluence.plugins.mentions.api.ConfluenceMentionEvent,notification.plugin.api.enabled.com.atlassian.confluence.event.events.security.ForgotPasswordEvent,pdf-preview,notification.plugin.api.enabled.com.atlassian.confluence.plugins.tasklist.event.SendTaskEmailEvent,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.page.async.PageMovedEvent,previews.sharing,previews.versions,notification.plugin.api.enabled.com.atlassian.confluence.plugins.files.notifications.event.FileContentUpdateEvent,file-annotations,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.attachment.AttachmentBatchUploadCompletedEvent,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.comment.CommentCreateEvent,notification.plugin.api.enabled.com.atlassian.confluence.efi.emails.events.OnboardingLessUsersEvent,notification.plugin.api.enabled.com.atlassian.confluence.plugins.files.notifications.event.FileContentRemoveEvent,atlassian.aui.raphael.disabled,previews.conversion-service,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.comment.CommentUpdateEvent,notification.plugin.api.enabled.com.atlassian.confluence.event.events.follow.FollowEvent,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.page.async.PageEditedEvent,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.blogpost.BlogPostCreateEvent,previews.trigger-all-file-types,notification.plugin.api.enabled.com.atlassian.confluence.plugins.inlinecomments.events.InlineCommentResolveEvent,notification.plugin.api.enabled.com.atlassian.confluence.event.events.like.LikeCreatedEvent,notification.plugin.api.enabled.com.atlassian.confluence.plugins.inlinecomments.events.InlineCommentCreateEvent,previews.sharing.pushstate,confluence-inline-comments-rich-editor,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.blogpost.BlogPostUpdateEvent,file-annotations.likes,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.page.async.PageCreatedEvent,notification.plugin.api.enabled.com.atlassian.confluence.plugins.files.notifications.event.FileContentMentionUpdateEvent,notification.plugin.api.enabled.com.atlassian.confluence.efi.emails.events.OnboardingNoSpaceCreatedEvent,notification.plugin.api.enabled.com.atlassian.confluence.plugins.hipchat.api.events.HipChatUserMapped,notification.plugin.api.enabled.com.atlassian.confluence.plugins.sharepage.api.ShareAttachmentEvent,confluence-inline-comments,confluence-inline-comments-dangling-comment,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.blogpost.BlogPostMovedEvent">\u000a            <meta name="ajs-atl-token" content="bbfbe3688a119472b93f15e2bb51e9e1a4890f34">\u000a            <meta name="ajs-confluence-flavour" content="VANILLA">\u000a            <meta name="ajs-user-date-pattern" content="dd MMM yyyy">\u000a            <meta name="ajs-date.format" content="MMM dd, yyyy">\u000a    \u000a    <link rel="shortcut icon" href="/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/favicon.ico">\u000a    <link rel="icon" type="image/x-icon" href="/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/favicon.ico">\u000a\u000a<link rel="search" type="application/opensearchdescription+xml" href="/confluence/opensearch/osd.action" title="Apache Software Foundation"/>\u000a\u000a<script>\u000awindow.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};\u000aWRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\u005c"/confluence\u005c"";\u000aWRM._unparsedData["com.atlassian.plugins.atlassian-nps-plugin:atlassian-nps-plugin-resources.is-server-instance-data-provider"]="true";\u000aWRM._unparsedData["com.atlassian.plugins.browser.metrics.browser-metrics-plugin:browser-metrics.feature-data-provider-legacy"]="true";\u000aWRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager.resource-base-url-pattern"]="\u005c"(?:/confluence(?:/s/.*?/_)?/download)\u005c"";\u000aWRM._unparsedData["com.atlassian.confluence.plugins.confluence-license-banner:confluence-license-banner-resources.license-details"]="{\u005c"daysBeforeLicenseExpiry\u005c":0,\u005c"daysBeforeMaintenanceExpiry\u005c":0,\u005c"showLicenseExpiryBanner\u005c":false,\u005c"showMaintenanceExpiryBanner\u005c":false,\u005c"renewUrl\u005c":null,\u005c"salesEmail\u005c":null}";\u000aWRM._unparsedData["com.atlassian.confluence.plugins.confluence-hipchat-integration-plugin:discovery-javascript-data.link-active"]="{\u005c"linkActive\u005c":false,\u005c"conditionsMet\u005c":false,\u005c"admin\u005c":false}";\u000aWRM._unparsedData["com.atlassian.plugins.atlassian-nps-plugin:nps-acknowledgement-resources.analytics-enabled-data-provider"]="\u005c"true\u005c"";\u000aWRM._unparsedData["com.atlassian.plugins.atlassian-nps-plugin:nps-acknowledgement-resources.sen-data-provider"]="\u005c"SEN-2015076\u005c"";\u000aWRM._unparsedData["com.atlassian.confluence.plugins.confluence-feature-discovery-plugin:confluence-feature-discovery-plugin-resources.test-mode"]="false";\u000aWRM._unparsedData["com.atlassian.plugins.browser.metrics.browser-metrics-plugin:api.feature-data-provider"]="true";\u000a</script>\u000a<link type="text/css" rel="stylesheet" href="/confluence/s/66a63f4a88483cfd25bf9fba08c897ff-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/76/_/download/superbatch/css/batch.css?build-number=5982" media="all">\u000a<!--[if lt IE 9]>\u000a<link type="text/css" rel="stylesheet" href="/confluence/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/76/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">\u000a<![endif]-->\u000a<!--[if lte IE 9]>\u000a<link type="text/css" rel="stylesheet" href="/confluence/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/76/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">\u000a<![endif]-->\u000a<link type="text/css" rel="stylesheet" href="/confluence/s/a7716d232ff896a91341582581426804-T/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/21e1e35dadb1bb62e2db78bd4280398b/_/download/contextbatch/css/atl.confluence.plugins.pagetree-desktop,main,page,viewcontent,atl.general,atl.comments/batch.css?highlightactions=true&amp;flavour=VANILLA&amp;locale=en-GB" media="all">\u000a<!--[if lt IE 9]>\u000a<link type="text/css" rel="stylesheet" href="/confluence/s/6c0981174e94142364564819dc0d1413-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/21e1e35dadb1bb62e2db78bd4280398b/_/download/contextbatch/css/atl.confluence.plugins.pagetree-desktop,main,page,viewcontent,atl.general,atl.comments/batch.css?conditionalComment=lt+IE+9&amp;locale=en-GB" media="all">\u000a<![endif]-->\u000a<link type="text/css" rel="stylesheet" href="/confluence/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/aa0fc0bf2d8f6e9feff4e0a53dd0bfcb/_/download/contextbatch/css/theme.doc/batch.css" media="all">\u000a<link type="text/css" rel="stylesheet" href="/confluence/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/2.1.5/_/download/batch/com.atlassian.confluence.ext.newcode-macro-plugin:syntaxhighlighter/com.atlassian.confluence.ext.newcode-macro-plugin:syntaxhighlighter.css" media="all">\u000a<link type="text/css" rel="stylesheet" href="/confluence/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/2.1.5/_/download/batch/com.atlassian.confluence.ext.newcode-macro-plugin:sh-theme-default/com.atlassian.confluence.ext.newcode-macro-plugin:sh-theme-default.css" media="all">\u000a<link type="text/css" rel="stylesheet" href="/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/15/_/styles/colors.css?spaceKey=SPARK" media="all">\u000a<script type="text/javascript" src="/confluence/s/b71a10269e27a22c38ec390c9ce2d4cc-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/76/_/download/superbatch/js/batch.js?atlassian.aui.raphael.disabled=true&amp;locale=en-GB&amp;build-number=5982" ></script>\u000a<script type="text/javascript" src="/confluence/s/0b59aac6e225a616061920911d2ae160-T/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/21e1e35dadb1bb62e2db78bd4280398b/_/download/contextbatch/js/atl.confluence.plugins.pagetree-desktop,main,page,viewcontent,atl.general,atl.comments/batch.js?analytics-uploadable=true&amp;highlightactions=true&amp;flavour=VANILLA&amp;nps-acknowledged=true&amp;analytics-enabled=true&amp;locale=en-GB&amp;anonymous-access-enabled=true&amp;is-server-instance=true&amp;hostenabled=true" ></script>\u000a<script type="text/javascript" src="/confluence/s/6c0981174e94142364564819dc0d1413-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/2.1.5/_/download/batch/com.atlassian.confluence.ext.newcode-macro-plugin:syntaxhighlighter/com.atlassian.confluence.ext.newcode-macro-plugin:syntaxhighlighter.js?locale=en-GB" ></script>\u000a<script type="text/javascript" src="/confluence/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/2.1.5/_/download/batch/com.atlassian.confluence.ext.newcode-macro-plugin:syntaxhighlighter-brushes/com.atlassian.confluence.ext.newcode-macro-plugin:syntaxhighlighter-brushes.js" ></script>\u000a\u000a\u000a        \u000a            <meta name="stp-license-product-name" content="Confluence"/> <meta name="stp-license-days-to-expiry" content="126"/> <meta name="stp-license-is-admin" content="false"/> <meta name="stp-license-should-keep-banner-hidden" content="true"/>\u000a    \u000a\u000a        \u000a        <meta name="ajs-site-title" content="Apache Software Foundation" />\u000a\u000a    \u000a    \u000a\u000a    \u000a                <link rel="canonical" href="https://cwiki.apache.org/confluence/display/SPARK/PySpark+Internals">\u000a        <link rel="shortlink" href="https://cwiki.apache.org/confluence/x/opMTAg">\u000a    <meta name="wikilink" content="[SPARK:PySpark Internals]">\u000a    <meta name="page-version" content="16">\u000a\u000a</head>\u000a\u000a<body             onload="placeFocus()"\u000a     id="com-atlassian-confluence" class="theme-documentation  aui-theme-default aui-layout">\u000a\u000a        \u000a            <div id='stp-licenseStatus-banner'></div>\u000a    <div id="full-height-container">\u000a    <div id="header-precursor">\u000a        <style type="text/css">\u000a#preview #previewArea iframe {\u000a\u000a   overflow: visible;\u000a}\u000a</style>\u000a\u000a                    </div>\u000a\u000a\u000a\u000a\u000a\u000a\u000a<header id="header" role="banner">\u000a    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation"><div class="aui-header-inner"><div class="aui-header-before"><a class=" aui-dropdown2-trigger app-switcher-trigger" aria-owns="app-switcher" aria-controls="app-switcher" aria-haspopup="true" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a><div id="app-switcher" class="aui-dropdown2 aui-style-default"><div class="app-switcher-loading">Loading&hellip;</div></div><script>\u000a            (function (NL) {\u000a                var initialise = function () {\u000a                    // For some milestones of AUI, the atlassian soy namespace was renamed to aui. Handle that here by ensuring that window.atlassian is defined.\u000a                    window.atlassian = window.atlassian || window.aui;\u000a                    new NL.AppSwitcher({\u000a                        dropdownContents: '#app-switcher'\u000a                    });\u000a                };\u000a                if (NL.AppSwitcher) {\u000a                    initialise();\u000a                } else {\u000a                    NL.onInit = initialise;\u000a                }\u000a            }(window.NL = (window.NL || {})));\u000a            window.NL.isUserAdmin = false</script></div><div class="aui-header-primary"><h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="/confluence/"><img src="/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/images/logo/confluence-logo.png" alt="Apache Software Foundation" /></a></h1><ul class="aui-nav">\u000a                            <li>\u000a            \u000a        \u000a        \u000a<a  id="space-directory-link" href="/confluence/spacedirectory/view.action"  class=" aui-nav-imagelink"   title="Spaces">\u000a            <span>Spaces</span>\u000a    </a>\u000a        </li>\u000a                            <li id="browseMenu" role="menu">\u000a            \u000a    \u000a        <a id="browse-menu-link" class="aui-nav-link aui-dropdown2-trigger" href="#" aria-haspopup="true" aria-owns="browse-menu-link-content" title="Browse">\u000a        <span class="browse">Browse</span>\u000a    </a>\u000a    <nav id="browse-menu-link-content" class="aui-dropdown2 aui-style-default" aria-hidden="true">\u000a                    <div class="aui-dropdown2-section">\u000a                                <ul  id="browse-menu-link-leading" class="aui-list-truncate section-leading first">\u000a                                            <li>\u000a    \u000a            \u000a<a  id="space-pages-link" href="/confluence/pages/listpages.action?key=SPARK" class="    "      title="Browse pages in the Spark space" >\u000a        Pages\u000a</a>\u000a</li>\u000a                                            <li>\u000a    \u000a            \u000a<a  id="space-blogposts-link" href="/confluence/pages/viewrecentblogposts.action?key=SPARK" class="    "      title="Browse blogs in the Spark space" >\u000a        Blog\u000a</a>\u000a</li>\u000a                                            <li>\u000a    \u000a            \u000a<a  id="space-labels-link" href="/confluence/labels/listlabels-heatmap.action?key=SPARK" class="    "      title="Browse labels in the Spark space" >\u000a        Labels\u000a</a>\u000a</li>\u000a                                            <li>\u000a    \u000a            \u000a<a  id="space-mail-link" href="/confluence/mail/archive/viewmailarchive.action?key=SPARK" class="    "      title="Browse mail in the Spark space" >\u000a        Mail\u000a</a>\u000a</li>\u000a                                            <li>\u000a    \u000a            \u000a<a  id="space-advanced-link" href="/confluence/spaces/viewspacesummary.action?key=SPARK" class="    "      title="Browse additional space functions in the Spark space" >\u000a        Space Operations\u000a</a>\u000a</li>\u000a                                    </ul>\u000a            </div>\u000a            </nav>\u000a    \u000a        </li>\u000a        </ul>\u000a</div><div class="aui-header-secondary"><ul class="aui-nav">\u000a            <li>\u000a        \u000a    \u000a        \u000a<a  id="doctheme-anchor" href="/confluence"  class=" aui-nav-imagelink"   title="">\u000a            <span></span>\u000a    </a>\u000a    </li>\u000a                    <li>\u000a        <form id="quick-search" class="aui-quicksearch dont-default-focus header-quicksearch" action="/confluence/dosearchsite.action" method="get"><fieldset><label for="quick-search-query" class="assistive">Quick Search</label><input id="quick-search-query" class="text app-search search quick-search-query" type="text" accessKey="q" autocomplete="off" name="queryString" title="Quick Search" placeholder="Search" /><input id="quick-search-submit" class="quick-search-submit" type="submit" value="Search"/><div class="aui-dd-parent quick-nav-drop-down"></div></fieldset></form>\u000a    </li>\u000a        <li>\u000a            \u000a        <a id="help-menu-link" class="aui-nav-link aui-dropdown2-trigger" href="#" aria-haspopup="true" aria-owns="help-menu-link-content" title="Help">\u000a        <span class="aui-icon aui-icon-small aui-iconfont-help">Help</span>\u000a    </a>\u000a    <nav id="help-menu-link-content" class="aui-dropdown2 aui-style-default" aria-hidden="true">\u000a                    <div class="aui-dropdown2-section">\u000a                                <ul  id="help-menu-link-leading" class="aui-list-truncate section-leading first">\u000a                                            <li>\u000a        \u000a            \u000a<a  id="confluence-help-link" href="https://docs.atlassian.com/confluence/docs-58/Getting+Help+And+Support" class="    "      title="Visit the Confluence documentation home"  target="_blank"\u000a>\u000a        Online Help\u000a</a>\u000a</li>\u000a                                            <li>\u000a    \u000a            \u000a<a  id="keyboard-shortcuts-link" href="/confluence" class="    "      title="View available keyboard shortcuts" >\u000a        Keyboard Shortcuts\u000a</a>\u000a</li>\u000a                                            <li>\u000a    \u000a            \u000a<a  id="feed-builder-link" href="/confluence/dashboard/configurerssfeed.action" class="    "      title="Create your custom RSS feed." >\u000a        Feed Builder\u000a</a>\u000a</li>\u000a                                            <li>\u000a    \u000a            \u000a<a  id="whats-new-menu-link" href="https://docs.atlassian.com/confluence/docs-58/whatsnew/iframe" class="    "      title="" >\u000a        What\u2019s new\u000a</a>\u000a</li>\u000a                                            <li>\u000a    \u000a            \u000a<a  id="whats-new-menu-link" href="https://docs.atlassian.com/confluence/docs-58/whatsnew/iframe" class="    "      title="" >\u000a        What\u2019s new\u000a</a>\u000a</li>\u000a                                            <li>\u000a    \u000a            \u000a<a  id="gadget-directory-link" href="/confluence" class="   user-item administration-link "      title="Browse gadgets provided by Confluence" >\u000a        Available Gadgets\u000a</a>\u000a</li>\u000a                                            <li>\u000a    \u000a            \u000a<a  id="confluence-about-link" href="/confluence/aboutconfluencepage.action" class="    "      title="Get more information about Confluence" >\u000a        About Confluence\u000a</a>\u000a</li>\u000a                                    </ul>\u000a            </div>\u000a            </nav>\u000a    \u000a    </li>\u000a        <li>\u000a                \u000a    \u000a    </li>\u000a        <li>\u000a            \u000a    </li>\u000a        <li>\u000a                                            <li>\u000a        \u000a            \u000a<a  id="login-link" href="/confluence/login.action?os_destination=%2Fdisplay%2FSPARK%2FPySpark%2BInternals" class="   user-item login-link "      title="" >\u000a        Log in\u000a</a>\u000a</li>\u000a                        <li>\u000a    \u000a            \u000a<a  id="signup-link" href="/confluence/signup.action" class="   user-item signup-link "      title="" >\u000a        Sign up\u000a</a>\u000a</li>\u000a                        \u000a    </li>\u000a    </ul>\u000a</div></div><!-- .aui-header-inner--></nav><!-- .aui-header -->\u000a    <br class="clear">\u000a</header>\u000a\u000a    <div id="splitter">\u000a    <div id="splitter-sidebar" >\u000a        \u000a\u000a                    \u000a    \u000a\u000a\u000a<div class="plugin_pagetree">\u000a\u000a                        <div id="pagetreesearch">\u000a            <form method="POST" class="aui" action="/confluence/plugins/pagetreesearch/pagetreesearch.action" name="pagetreesearchform">\u000a                                    <input type="hidden" name="ancestorId" value="33293106">\u000a                                <input type="hidden" name="spaceKey" value="SPARK">\u000a                <input type="text"  class="text medium-field" size="20" name="queryString">\u000a                <input type="submit" class="aui-button" value="Search">\u000a            </form>\u000a        </div>\u000a            \u000a        \u000a    <ul class="plugin_pagetree_children_list plugin_pagetree_children_list_noleftspace">\u000a        <div class="plugin_pagetree_children">\u000a        </div>\u000a    </ul>\u000a\u000a    <fieldset class="hidden">\u000a        <input type="hidden" name="treeId" value="">\u000a        <input type="hidden" name="treeRequestId" value="/confluence/plugins/pagetree/naturalchildren.action?decorator=none&amp;excerpt=false&amp;sort=position&amp;reverse=false&amp;disableLinks=false&amp;expandCurrent=false">\u000a        <input type="hidden" name="treePageId" value="34837410">\u000a\u000a        <input type="hidden" name="noRoot" value="false">\u000a        <input type="hidden" name="rootPageId" value="33293106">\u000a\u000a        <input type="hidden" name="rootPage" value="">\u000a        <input type="hidden" name="startDepth" value="0">\u000a        <input type="hidden" name="spaceKey" value="SPARK" >\u000a\u000a        <input type="hidden" name="i18n-pagetree.loading" value="Loading...">\u000a        <input type="hidden" name="i18n-pagetree.error.permission" value="Unable to load page tree. It seems that you do not have permission to view the root page.">\u000a        <input type="hidden" name="i18n-pagetree.eeror.general" value="There was a problem retrieving the page tree. Please check the server log file for more information.">\u000a        <input type="hidden" name="loginUrl" value="/confluence/login.action?os_destination=%2Fpages%2Fviewpage.action%3FspaceKey%3DSPARK%26title%3DPySpark%2BInternals">\u000a        <input type="hidden" name="mobile" value="false">\u000a\u000a                <fieldset class="hidden">\u000a                                                <input type="hidden" name="ancestorId" value="34837371">\u000a                                    <input type="hidden" name="ancestorId" value="33293106">\u000a                                    </fieldset>\u000a    </fieldset>\u000a</div>\u000a\u000a\u000a\u000a            </div>\u000a    <div id="splitter-content">\u000a\u000a                    <script type="text/javascript" src="/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/5.8.4/_/download/resources/com.atlassian.confluence.plugins.doctheme:resources/doc-theme.js"></script>\u000a    \u000a                        \u000a            \u000a<div id="main"  class="aui-page-panel" >\u000a    <div id="main-header">\u000a        \u000a        \u000a    <div id="navigation" class="content-navigation view">\u000a                    <ul class="ajs-menu-bar">\u000a                                                        \u000a                    \u000a        <li class="normal ajs-menu-item">\u000a        <a id="action-menu-link" class="action aui-dropdown2-trigger-arrowless aui-button aui-button-subtle ajs-menu-title aui-dropdown2-trigger" href="#" aria-haspopup="true" aria-owns="action-menu" data-container="#navigation">\u000a            <span>\u000a                                    <span class="aui-icon aui-icon-small aui-iconfont-more"></span>\u000a                                \u000a            </span>\u000a        </a>         <div id="action-menu" class="aui-dropdown2 aui-style-default">\u000a                            <ul  id="action-menu-primary"                     class="section-primary first aui-dropdown2-section">\u000a                                            <li>\u000a\u000a    \u000a        \u000a                                            \u000a    \u000a    \u000a    <a  id="view-attachments-link" href="/confluence/pages/viewpageattachments.action?pageId=34837410" rel="nofollow" class="action-view-attachments"  accessKey="t"  title="View Attachments">\u000a                <span>\u000a                        A<u>t</u>tachments (0)\u000a        </span>    </a>\u000a</li>\u000a                                        <li>\u000a\u000a    \u000a        \u000a                                            \u000a    \u000a    \u000a    <a  id="action-view-history-link" href="/confluence/pages/viewpreviousversions.action?pageId=34837410" rel="nofollow" class="action-view-history"   title="">\u000a                <span>\u000a                        Page History\u000a        </span>    </a>\u000a</li>\u000a                                        <li>\u000a\u000a    \u000a        \u000a                                            \u000a    \u000a    \u000a    <a  id="action-page-permissions-link" href="/confluence/pages/viewinfo.action?pageId=34837410" rel="nofollow" class="action-page-permissions"   title="Edit restrictions">\u000a                <span>\u000a                        Restrictions\u000a        </span>    </a>\u000a</li>\u000a                                </ul>\u000a                            <ul  id="action-menu-secondary"                     class="section-secondary aui-dropdown2-section">\u000a                                            <li>\u000a\u000a    \u000a        \u000a                                            \u000a    \u000a    \u000a    <a  id="view-page-info-link" href="/confluence/pages/viewinfo.action?pageId=34837410" rel="nofollow" class="action-view-info"   title="">\u000a                <span>\u000a                        Page Information\u000a        </span>    </a>\u000a</li>\u000a                                        <li>\u000a\u000a    \u000a        \u000a                                            \u000a    \u000a    \u000a    <a  id="view-resolved-comments" href="/confluence" rel="nofollow" class=""   title="">\u000a                <span>\u000a                        Resolved comments\u000a        </span>    </a>\u000a</li>\u000a                                        <li>\u000a\u000a    \u000a        \u000a                                            \u000a    \u000a    \u000a    <a  id="link-to-page-link" href="/confluence/pages/viewinfo.action?pageId=34837410" rel="nofollow" class=""   title="Link to this Page">\u000a                <span>\u000a                        Link to this Page\u2026\u000a        </span>    </a>\u000a</li>\u000a                                        <li>\u000a\u000a    \u000a        \u000a                                            \u000a    \u000a    \u000a    <a  id="view-in-hierarchy-link" href="/confluence/pages/listpages-dirview.action?key=SPARK&amp;openId=34837410#selectedPageInHierarchy" rel="nofollow" class=""   title="">\u000a                <span>\u000a                        View in Hierarchy\u000a        </span>    </a>\u000a</li>\u000a                                        <li>\u000a\u000a    \u000a        \u000a                                            \u000a    \u000a    \u000a    <a  id="delete-all-comments-link-link" href="/confluence/plugins/aptis/deleteAllComments/ask-user.action?pageId=34837410" rel="nofollow" class=""   title="">\u000a                <span>\u000a                        Delete comments\u000a        </span>    </a>\u000a</li>\u000a                                        <li>\u000a\u000a    \u000a        \u000a                                            \u000a    \u000a    \u000a    <a  id="action-view-source-link" href="/confluence/plugins/viewsource/viewpagesrc.action?pageId=34837410" rel="nofollow" class="action-view-source popup-link"   title="">\u000a                <span>\u000a                        View Source\u000a        </span>    </a>\u000a</li>\u000a                                        <li>\u000a\u000a    \u000a        \u000a                                            \u000a    \u000a    \u000a    <a  id="action-export-pdf-link" href="/confluence/spaces/flyingpdf/pdfpageexport.action?pageId=34837410" rel="nofollow" class=""   title="">\u000a                <span>\u000a                        Export to PDF\u000a        </span>    </a>\u000a</li>\u000a                                        <li>\u000a\u000a    \u000a        \u000a                                            \u000a    \u000a    \u000a    <a  id="com-k15t-confluence-scroll-epub-launcher" href="/confluence/pages/viewpage.action?pageId=34837410" rel="nofollow" class=""   title="">\u000a                <span>\u000a                        Export to EPUB\u000a        </span>    </a>\u000a</li>\u000a                                        <li>\u000a\u000a    \u000a        \u000a                                            \u000a    \u000a    \u000a    <a  id="action-export-word-link" href="/confluence/exportword?pageId=34837410" rel="nofollow" class="action-export-word"   title="">\u000a                <span>\u000a                        Export to Word\u000a        </span>    </a>\u000a</li>\u000a                                </ul>\u000a                            <ul  id="action-menu-modify"                     class="section-modify aui-dropdown2-section">\u000a                                            <li>\u000a\u000a    \u000a        \u000a                                            \u000a    \u000a    \u000a    <a  id="treecopy-action" href="/confluence/plugins/treecopy/setnames.action?pageId=34837410" rel="nofollow" class=""   title="">\u000a                <span>\u000a                        Copy Page Tree\u000a        </span>    </a>\u000a</li>\u000a                                        <li>\u000a\u000a    \u000a        \u000a                                            \u000a    \u000a    \u000a    <a  id="tree-delete-action" href="/confluence/plugins/tree-delete/preparing-delete.action?pageId=34837410" rel="nofollow" class=""   title="">\u000a                <span>\u000a                        Delete Page Tree\u000a        </span>    </a>\u000a</li>\u000a                                </ul>\u000a                    </div>\u000a    </li>\u000a            </ul>\u000a    </div>\u000a\u000a        \u000a                <div id="title-heading" class="pagetitle with-breadcrumbs">\u000a        \u000a                            <div class="space-logo " data-key="SPARK" data-name="Spark" data-entity-type="confluence.space">\u000a            <a><img class="logo space custom" src="/confluence/download/attachments/33293105/SPARK?version=6&amp;modificationDate=1465582929000&amp;api=v2" alt=""></a>\u000a        </div>            \u000a                            <div id="breadcrumb-section">\u000a                    \u000a    \u000a    \u000a    <ol id="breadcrumbs">\u000a                                        \u000a                        \u000a        <li class="first" >\u000a                        \u000a                            <span class=""><a href="/confluence/display/SPARK">Spark</a></span>\u000a                                                                    \u000a                        \u000a        <li>\u000a                        \u000a                            <span class=""><a href="/confluence/display/SPARK/Wiki+Homepage">Wiki Homepage</a></span>\u000a                                                                    \u000a                        \u000a        <li>\u000a                        \u000a                            <span class=""><a href="/confluence/display/SPARK/Spark+Internals">Spark Internals</a></span>\u000a                                                    </ol>\u000a\u000a\u000a                </div>\u000a            \u000a            <h1 id="title-text" class="with-breadcrumbs">\u000a                                        <a href="/confluence/display/SPARK/PySpark+Internals">PySpark Internals</a>\u000a                            </h1>\u000a        </div>\u000a    </div>\u000a\u000a    \u000a\u000a    \u000a    \u000a    \u000a    \u000a    \u000a\u000a        \u000a\u000a\u000a\u000a\u000a        \u000a\u000a\u000a\u000a\u000a\u000a\u000a\u000a\u000a\u000a\u000a\u000a\u000a\u000a    \u000a    \u000a        \u000a    \u000a    \u000a                    \u000a    \u000a\u000a    \u000a\u000a\u000a<div id="content" class="page view">\u000a    \u000a\u000a\u000a<div id="action-messages">\u000a                        </div>\u000a\u000a\u000a\u000a        <script type="text/x-template" title="searchResultsGrid">\u000a    <table class="aui">\u000a        <thead>\u000a            <tr class="header">\u000a                <th class="search-result-title">Page Title</th>\u000a                <th class="search-result-space">Space</th>\u000a                <th class="search-result-date">Updated</th>\u000a            </tr>\u000a        </thead>\u000a    </table>\u000a</script>\u000a<script type="text/x-template" title="searchResultsGridCount">\u000a    <p class="search-result-count">{0}</p>\u000a</script>\u000a<script type="text/x-template" title="searchResultsGridRow">\u000a    <tr class="search-result">\u000a        <td class="search-result-title"><a href="{1}" class="content-type-{2}"><span>{0}</span></a></td>\u000a        <td class="search-result-space"><a class="space" href="/confluence/display/{4}/" title="{3}">{3}</a></td>\u000a        <td class="search-result-date"><span class="date" title="{6}">{5}</span></td>\u000a    </tr>\u000a</script>\u000a        \u000a    \u000a    \u000a        <fieldset class="hidden parameters">\u000a            <input type="hidden" title="parentPageId" value="34837371">\u000a        </fieldset>\u000a\u000a                            \u000a    \u000a\u000a                    \u000a\u000a        \u000a        <a href="#page-metadata-end" class="assistive">Skip to end of metadata</a>\u000a<div id="page-metadata-start" class="assistive"></div>\u000a\u000a    <div class="page-metadata">\u000a        <ul>\u000a                            <li class="page-metadata-item noprint">\u000a\u000a    \u000a            \u000a                                            \u000a    \u000a    \u000a    <a  id="content-metadata-page-restrictions" href="#" rel="nofollow" class="hidden"   title="Restrictions apply">\u000a                    <img alt="" src="/confluence/download/resources/com.atlassian.confluence.plugins.confluence-page-banner:page-banner-resources/images/red_padlock.png" height="16" width="16" title="">\u000a                <span>\u000a                        \u000a        </span>    </a>\u000a</li>\u000a                        <li class="page-metadata-modification-info">\u000a                \u000a        \u000a    \u000a        \u000a    \u000a        \u000a        \u000a            Created by <span class='author'>     <a href="    /confluence/display/~joshrosen\u000a"\u000a                       class="url fn"\u000a                            >Joshua Rosen</a></span>, last modified by <span class='editor'>     <a href="    /confluence/display/~srowen@gmail.com\u000a"\u000a                       class="url fn"\u000a                            >Sean Owen</a></span> on <a class='last-modified' title='Nov 22, 2016 14:03' href='/confluence/pages/diffpagesbyversion.action?pageId=34837410&amp;selectedPageVersions=15&amp;selectedPageVersions=16'>Nov 22, 2016</a>\u000a                </li>\u000a        </ul>\u000a    </div>\u000a\u000a\u000a<a href="#page-metadata-start" class="assistive">Go to start of metadata</a>\u000a<div id="page-metadata-end" class="assistive"></div>\u000a\u000a        \u000a        <fieldset class="hidden parameters">\u000a                        <input type="hidden" title="browsePageTreeMode" value="view">\u000a        </fieldset>\u000a\u000a        <div id="main-content" class="wiki-content">\u000a                           \u000a        <h2 id="PySparkInternals-NOTE:ThisWikiisobsoleteasofNovember2016andisretainedforreferenceonly."><span style="color: rgb(128,0,0);">NOTE: This Wiki is obsolete as of November 2016 and is retained for reference only.</span></h2><div><span style="color: rgb(128,0,0);"><br /></span></div><h1 id="PySparkInternals-Overview">Overview</h1><p>PySpark is built on top of Spark's Java API. Data is processed in Python and cached / shuffled in the JVM:</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource confluence-content-image-border image-center" width="300" src="http://i.imgur.com/YlI8AqEl.png" data-image-src="http://i.imgur.com/YlI8AqEl.png"></span></p><p>In the Python driver program, SparkContext uses <a href="http://py4j.sourceforge.net/" class="external-link" rel="nofollow">Py4J</a> to launch a JVM and create a JavaSparkContext. Py4J is only used on the driver for local communication between the Python and Java SparkContext objects; large data transfers are performed through a different mechanism.</p><p>RDD transformations in Python are mapped to transformations on PythonRDD objects in Java. On remote worker machines, PythonRDD objects launch Python subprocesses and communicate with them using pipes, sending the user's code and the data to be processed.</p><p> </p><h1 id="PySparkInternals-TipsforcontributingtoPySpark">Tips for contributing to PySpark</h1><h3 id="PySparkInternals-UnitTesting">Unit Testing</h3><p>PySpark's tests are a mixture of <a href="https://docs.python.org/2/library/doctest.html" class="external-link" rel="nofollow">doctests</a> and <a href="https://docs.python.org/2/library/unittest.html" class="external-link" rel="nofollow">unittests</a>.  The doctests serve as simple usage examples and are a lightweight way to test new RDD transformations and actions.  The unittests are used for more involved testing, such as testing job cancellation.</p><p>To run the entire PySpark test suite, run <code>./python/run-tests</code>.  When adding a new file that contains doctests or unittests, make sure to update <code>run-tests</code> so that the new tests are automatically executed by Jenkins.</p><p><span style="line-height: 1.4285715;background-color: transparent;">To run individual test suites:</span></p><ul><li>For <code>unittest</code> suites run <code>SPARK_TESTING=1 ./bin/pyspark python/pyspark/my_file.py</code>.  <span style="line-height: 1.4285715;background-color: transparent;">Some of our </span><code style="line-height: 1.4285715;background-color: transparent;">doctest</code><span style="line-height: 1.4285715;background-color: transparent;"> suites (such as the tests in </span><code style="line-height: 1.4285715;background-color: transparent;">rdd.py</code><span style="line-height: 1.4285715;background-color: transparent;">) have a custom </span><code style="line-height: 1.4285715;background-color: transparent;">__main__</code><span style="line-height: 1.4285715;background-color: transparent;"> method that sets up a global SparkContext that's shared among the tests.  These suites should be also be run with this command.</span></li><li>For pure-<code>doctest</code> suites (without special <code>__main__</code> setup code), run <code>SPARK_TESTING=1 ./bin/pyspark python/pyspark/my_file.py</code>.</li></ul><h1 id="PySparkInternals-Shippingcodeacrossthecluster">Shipping code across the cluster</h1><p>User-defined functions (e.g. lambdas or functions passed to map, flatMap) are serialized using PiCloud's <a href="https://github.com/apache/incubator-spark/blob/master/python/pyspark/cloudpickle.py" class="external-link" rel="nofollow">cloudpickle</a> library and shipped to remote Python workers. Serializing arbitrary functions / closures is tricky, but this library handles most common cases (including referencing objects in enclosing scopes).</p><p>In a few cases, PySpark's internal code needs take care to avoid including unserializable objects in function closures. For example, consider this excerpt from rdd.py that wraps a user-defined function to batch its output:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">\u000a<script type="syntaxhighlighter" class="brush: python; gutter: false; theme: Default"><![CDATA[            oldfunc = self.func\u000a            batchSize = self.ctx.batchSize\u000a            def batched_func(split, iterator):\u000a                return batched(oldfunc(split, iterator), batchSize)\u000a            func = batched_func\u000a]]></script>\u000a</div></div><p>In this example, <code>batched_func</code> refers to <code>oldfunc</code> instead of <code>self.func</code> in order to avoid including <code>self</code> in the function closure.</p><p>To ship libraries, PySpark uses Spark's <code>SparkContext.addFile()</code> method to distribute the libraries to the workers, where they're added to the workers' PYTHONPATHs.</p><h1 id="PySparkInternals-Serializingdata">Serializing data</h1><p>Data is currently serialized using the Python cPickle serializer. PySpark uses cPickle for serializing data because it's reasonably fast and supports nearly any Python data structure.</p><p><em>TODO: discuss why you didn't use JSON, BSON, ProtoBuf, MsgPack, etc.</em></p><h2 id="PySparkInternals-Bulkpicklingoptimizations">Bulk pickling optimizations</h2><p>As an optimization, we store and serialize objects in small batches. Batching amortizes fixed serialization costs and allows pickle to employ compression techniques (like run-length encoding or storing pointers to repeated objects).</p><p>Interestingly, there are <a href="https://gist.github.com/JoshRosen/3401373" class="external-link" rel="nofollow">some cases</a> where a set of pickles can be combined to be decoded faster, even though this requires manipulation of the pickle bytecode. Although this is a fun result, this bulk de-pickling technique isn't used in PySpark.</p><h2 id="PySparkInternals-Customserializerscustom-serializers">Custom serializers <span class="confluence-anchor-link" id="PySparkInternals-custom-serializers"></span></h2><p>Pluggable serialization of Python objects was added in <a href="https://github.com/apache/incubator-spark/pull/146" class="external-link" rel="nofollow">spark/146</a>, which should be included in a future Spark 0.9 release.</p><p>The first prototype of custom serializers allowed serializers to be chosen on a per-RDD basis. The current implementation only allows one serializer to be used for all data serialization; this serializer is configured when constructing SparkContext.</p><p>Even with only one serializer, there are still some subtleties here due to how PySpark handles text files. PySpark implements <code>SparkContext.textFile()</code> by directly calling its Java equivalent. This produces a <code>JavaRDD[String]</code> instead of a <code>JavaRDD[byte[]]</code>. JavaRDD transfers these strings to Python workers using UTF-8 encoding (For 0.9.0 only, this used MUTF-8 encoding, but that was fixed for 0.9.1; see <a href="https://issues.apache.org/jira/browse/SPARK-1043" class="external-link" rel="nofollow">SPARK-1043</a>).</p><p>Prior to the custom serializers pull request, JavaRDD would send strings to Python as pickled UTF-8 strings by prepending the appropriate pickle opcodes. From the worker's point of view, all of its incoming data was in the same pickled format. The pull request removed all Python-pickle-specific code from JavaRDD.</p><p>To handle these cases, PySpark allows a stage's input deserialization and output serialization functions to come from different serializers. For example, in <code>sc.textFile(..).map(lambda x: ...).groupByKey()</code> the first pipeline stage would use a MUTF8Deserializer and PickleSerializer, and subsequent stages would use PickleSerializers for their inputs and outputs. PySpark uses the lineage graph to perform the bookkeeping to select the appropriate deserializers.</p><p>At the moment, union() requires that its inputs were serialized with the same serializer. When unioning an untransformed RDD created with sc.textFile() with a transformed RDD, cartesian() product, or RDD created with parallelize(), PySpark will force some of the RDDs to be re-serialized using the default serializer. We might be able to add code to avoid this re-serialization, but it would add extra complexity and these particular union() usages seem uncommon.</p><p>In the long run, it would be nice to refactor the Java-side serialization logic so that it can apply different interpretations to the bytes that it receives from Python (e.g. unpack them into UTF-8 strings or MsgPack objects). We could also try to remove the assumption that Python sends framed input back to Java, but this this might require a separate socket for sending control messages and exceptions). In the very long term, we might be able to generalize PythonRDD's protocol to a point where we can use the same code to support backends written in other languages (this would effectively be like pipe(), but with a more complicated binary protocol).</p><h1 id="PySparkInternals-Executionandpipelining">Execution and pipelining</h1><p>PySpark pipelines transformations by composing their functions. When using PySpark, there's a one-to-one correspondence between PySpark stages and Spark scheduler stages. Each PySpark stage corresponds to a PipelinedRDD instance.</p><p><em>TODO: describe PythonRDD</em></p><p><em>TODO: this section could benefit from an end-to-end example tracing the execution of an operation like</em> <code><em>reduceByKey()</em></code></p><h1 id="PySparkInternals-Daemonforlaunchingworkerprocesses">Daemon for launching worker processes</h1><p>Many JVMs use fork/exec to launch child processes in ProcessBuilder or Runtime.exec. These child processes initially have the same memory footprint as their parent. When the Spark worker JVM has a large heap and spawns many child processes, this can cause memory exhaustion, leading to &quot;Cannot allocate memory&quot; errors. In Spark, this <a href="https://issues.apache.org/jira/browse/SPARK-671" class="external-link" rel="nofollow">affects both pipe() and PySpark</a>.</p><p>Other developers have run into the same problem and discovered a <a href="https://gist.github.com/pmahoney/1970815" class="external-link" rel="nofollow">variety of workarounds</a>, including adding extra swap space or telling the kernel to overcommit memory. We can't use the <a href="https://github.com/axiak/java_posix_spawn" class="external-link" rel="nofollow">java_posix_spawn</a> library to solve this problem because it's too difficult to package due to its use of platform-specific native binaries.</p><p>For PySpark, we resolved this problem by <a href="https://github.com/mesos/spark/pull/563" class="external-link" rel="nofollow">forking a daemon</a> when the JVM heap is small and using that daemon to launch and manage a pool of Python worker processes. Since the daemon uses very little memory, it won't exhaust the memory during fork().</p><h1 id="PySparkInternals-Misc.designnotes">Misc. design notes</h1><h2 id="PySparkInternals-WhynotperformmoreoftheprocessinginJava?">Why not perform more of the processing in Java?</h2><p>The first (unpublished) PySpark prototype was implemented in terms of PipedRDD. This prototype represented each Python RDD as a <code>JavaRDD[String]</code> of base64-encoded, pickled Python objects. The goal of this approach was to allow functions like join(), distinct(), union(), cogroup(), and groupByKey() to be implemented by directly calling the Java versions.</p><p>This approach required some complicated tricks in order to convert the results of Java operations back into pickled data. For example, a leftOuterJoin might produce an <code>JavaRDD[(String, (String, Option[String])]</code>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">\u000a<script type="syntaxhighlighter" class="brush: python; gutter: false; theme: Default"><![CDATA[&gt;&gt;&gt; x = sc.parallelizePairs([(&quot;a&quot;, 1), (&quot;b&quot;, 4)|(&quot;a&quot;, 1), (&quot;b&quot;, 4)])\u000a&gt;&gt;&gt; y = sc.parallelizePairs([(&quot;a&quot;, 2)|(&quot;a&quot;, 2)])\u000a&gt;&gt;&gt; print x.leftOuterJoin(y) ._jrdd.collect().toString()\u000a[(UydiJwou,(STQKLg==,None)), (UydhJwou,(STEKLg==,Some(STIKLg==)))|(UydiJwou,(STQKLg==,None)), (UydhJwou,(STEKLg==,Some(STIKLg==)))]\u000a]]></script>\u000a</div></div><p>To handle these cases, JavaRDD contained routines to <a href="https://gist.github.com/JoshRosen/3384191" class="external-link" rel="nofollow">flatten nested data structures containing pickled objects</a>.</p><p>This approach's correctness relied on serialized data equality being equivalent to Python object equality. However, there are some cases where <a href="http://stackoverflow.com/questions/7501577/cpickle-different-results-pickling-the-same-object" class="external-link" rel="nofollow">logically identical objects can produce different pickles</a>. This doesn't happen in most cases, but it can easily occur with dictionaries:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">\u000a<script type="syntaxhighlighter" class="brush: python; gutter: false; theme: Default"><![CDATA[&gt;&gt;&gt; import pickle\u000a&gt;&gt;&gt; a = {1: 0, 9: 0}\u000a&gt;&gt;&gt; b = {9: 0, 1: 0}\u000a&gt;&gt;&gt; a == b\u000aTrue\u000a&gt;&gt;&gt; pickle.dumps(a) == pickle.dumps(b)\u000aFalse\u000a]]></script>\u000a</div></div><p>There are Python serializers that can guarantee the equality properties needed by this approach, but they were either slower than cPickle or supported fewer data types.</p>\u000a\u000a                \u000a        \u000a    \u000a        </div>\u000a\u000a        <!--\u000a<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\u000a         xmlns:dc="http://purl.org/dc/elements/1.1/"\u000a         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">\u000a         <rdf:Description\u000a    rdf:about="https://cwiki.apache.org/confluence/display/SPARK/PySpark+Internals"\u000a    dc:identifier="https://cwiki.apache.org/confluence/display/SPARK/PySpark+Internals"\u000a    dc:title="PySpark Internals"\u000a    trackback:ping="https://cwiki.apache.org/confluence/rpc/trackback/34837410"/>\u000a</rdf:RDF>\u000a-->\u000a\u000a            \u000a    \u000a\u000a\u000a\u000a<div id="labels-section" class="pageSection group">\u000a    <div class="labels-section-content content-column" entityid="34837410" entitytype="page">\u000a	<div class="labels-content">\u000a		\u000a    <ul class="label-list label-list-right ">\u000a            <li class="no-labels-message">\u000a            No labels\u000a        </li>\u000a            </ul>\u000a\u000a    </div>\u000a</div>\u000a</div>\u000a\u000a            \u000a            \u000a\u000a\u000a\u000a\u000a            \u000a    \u000a\u000a\u000a\u000a\u000a\u000a\u000a\u000a\u000a                        \u000a    \u000a<div id="comments-section" class="pageSection group">\u000a        \u000a    \u000a\u000a\u000a\u000a</div>\u000a\u000a\u000a            \u000a</div>\u000a\u000a\u000a    \u000a\u000a\u000a\u000a\u000a    \u000a    \u000a\u000a    \u000a    \u000a    \u000a\u000a\u000a\u000a\u000a\u000a\u000a\u000a\u000a</div>\u000a  \u000a    </div>\u000a</div>\u000a\u000a\u000a        \u000a            \u000a            \u000a\u000a<div id="footer" role="contentinfo">\u000a    <section class="footer-body">\u000a\u000a                                                            <p class="license license-opensource">\u000a                    Powered by a free <b>Atlassian Confluence Open Source Project License</b> granted to Apache Software Foundation. <a href="http://www.atlassian.com/c/conf/11461">Evaluate Confluence today</a>.<br>\u000a                </p>\u000a                    \u000a        \u000a\u000a        <ul id="poweredby">\u000a            <li class="noprint">Powered by <a href="http://www.atlassian.com/software/confluence" class="hover-footer-link">Atlassian Confluence</a> <span id='footer-build-information'>5.8.4</span>, <a href="http://www.atlassian.com/software/confluence/overview/team-collaboration-software?utm_source=confluence-footer" class="hover-footer-link">Team Collaboration Software</a></li>\u000a            <li class="print-only">Printed by Atlassian Confluence 5.8.4, Team Collaboration Software.</li>\u000a            <li class="noprint"><a href="https://jira.atlassian.com/browse/CONF" class="hover-footer-link">Report a bug</a></li>\u000a            <li class="noprint"><a href="http://www.atlassian.com/about/connected.jsp?s_kwcid=Confluence-stayintouch" class="hover-footer-link">Atlassian News</a></li>\u000a        </ul>\u000a\u000a        \u000a\u000a        <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>\u000a\u000a                    \u000a        \u000a    </section>\u000a</div>\u000a\u000a    </div>\u000a</body>\u000a</html>\u000a
p3
a.